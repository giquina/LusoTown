4ecf52c3c489c4e8612600f9a6ae1c3c
"use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    SubscriptionProvider: function() {
        return SubscriptionProvider;
    },
    useSubscription: function() {
        return useSubscription;
    }
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _stripejs = require("@stripe/stripe-js");
const _LanguageContext = require("./LanguageContext");
const _auth = require("../lib/auth");
const _supabase = require("../lib/supabase");
const _reacthottoast = /*#__PURE__*/ _interop_require_default(require("react-hot-toast"));
const _routes = require("../config/routes");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// Initialize Stripe - with fallback for development
const stripePromise = (0, _stripejs.loadStripe)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY || "pk_test_placeholder");
const SubscriptionContext = /*#__PURE__*/ (0, _react.createContext)(undefined);
function SubscriptionProvider({ children }) {
    const { language, t } = (0, _LanguageContext.useLanguage)();
    const [subscription, setSubscription] = (0, _react.useState)(null);
    const [trial, setTrial] = (0, _react.useState)(null);
    const [usage, setUsage] = (0, _react.useState)(null);
    const [isLoading, setIsLoading] = (0, _react.useState)(true);
    const [stripe, setStripe] = (0, _react.useState)(null);
    // Initialize Stripe
    (0, _react.useEffect)(()=>{
        const initializeStripe = async ()=>{
            const stripeInstance = await stripePromise;
            setStripe(stripeInstance);
        };
        initializeStripe();
    }, []);
    // Load subscription status when user changes
    (0, _react.useEffect)(()=>{
        const checkUserSubscription = async ()=>{
            const user = _auth.authService.getCurrentUser();
            if (user && !_auth.authService.isDemoUser()) {
                await checkSubscriptionStatus();
            } else {
                setSubscription(null);
                setTrial(null);
                setIsLoading(false);
            }
        };
        checkUserSubscription();
        // Listen for auth state changes
        const unsubscribe = _auth.authService.onAuthStateChange(checkUserSubscription);
        return unsubscribe;
    }, []);
    const checkSubscriptionStatus = async ()=>{
        setIsLoading(true);
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || _auth.authService.isDemoUser()) {
                setSubscription(null);
                setTrial(null);
                return;
            }
            // Check for active subscription
            const { data: subscriptionData, error: subError } = await _supabase.supabase.from("subscriptions").select("*").eq("user_id", user.id).eq("status", "active").single();
            if (subError && subError.code !== "PGRST116") {
                console.error("Error fetching subscription:", subError);
            } else if (subscriptionData) {
                setSubscription(subscriptionData);
            }
            // Check for trial status
            const { data: trialData, error: trialError } = await _supabase.supabase.from("subscription_trials").select("*").eq("user_id", user.id).single();
            if (trialError && trialError.code !== "PGRST116") {
                console.error("Error fetching trial:", trialError);
            } else if (trialData) {
                setTrial(trialData);
            }
        } catch (error) {
            console.error("Error checking subscription status:", error);
        } finally{
            setIsLoading(false);
        }
    };
    const createSubscription = async (tier = "community", planType = "monthly")=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || _auth.authService.isDemoUser()) {
                throw new Error("User must be logged in to create subscription");
            }
            // Call your backend API to create Stripe checkout session
            const response = await fetch("/api/create-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    userId: user.id,
                    userEmail: user.email,
                    userName: user.name,
                    tier: tier,
                    planType: planType
                })
            });
            if (!response.ok) {
                throw new Error("Failed to create subscription");
            }
            const { sessionId } = await response.json();
            if (!stripe) {
                throw new Error("Stripe not initialized");
            }
            // Redirect to Stripe Checkout
            const { error } = await stripe.redirectToCheckout({
                sessionId
            });
            if (error) {
                console.error("Stripe checkout error:", error);
                _reacthottoast.default.error(language === "pt" ? "Erro ao processar pagamento. Tente novamente." : "Payment processing error. Please try again.");
                return null;
            }
            return sessionId;
        } catch (error) {
            console.error("Error creating subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao criar subscri\xe7\xe3o. Tente novamente." : "Error creating subscription. Please try again.");
            return null;
        }
    };
    const cancelSubscription = async ()=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) {
                return false;
            }
            const response = await fetch("/api/cancel-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    subscriptionId: subscription.stripe_subscription_id
                })
            });
            if (!response.ok) {
                throw new Error("Failed to cancel subscription");
            }
            // Refresh subscription status
            await checkSubscriptionStatus();
            _reacthottoast.default.success(language === "pt" ? "Subscri\xe7\xe3o cancelada com sucesso" : "Subscription cancelled successfully");
            return true;
        } catch (error) {
            console.error("Error cancelling subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao cancelar subscri\xe7\xe3o" : "Error cancelling subscription");
            return false;
        }
    };
    const redirectToSubscription = ()=>{
        window.location.href = _routes.ROUTES.subscription;
    };
    const upgradeSubscription = async (newTier)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) {
                return false;
            }
            const response = await fetch("/api/upgrade-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    subscriptionId: subscription.stripe_subscription_id,
                    newTier: newTier
                })
            });
            if (!response.ok) {
                throw new Error("Failed to upgrade subscription");
            }
            // Refresh subscription status
            await checkSubscriptionStatus();
            _reacthottoast.default.success(language === "pt" ? "Subscri\xe7\xe3o atualizada com sucesso" : "Subscription upgraded successfully");
            return true;
        } catch (error) {
            console.error("Error upgrading subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao atualizar subscri\xe7\xe3o" : "Error upgrading subscription");
            return false;
        }
    };
    const markTrialAsUsed = async ()=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !trial) return;
            const { error } = await _supabase.supabase.from("subscription_trials").update({
                is_used: true
            }).eq("user_id", user.id);
            if (error) {
                console.error("Error marking trial as used:", error);
            } else {
                setTrial((prev)=>prev ? {
                        ...prev,
                        is_used: true
                    } : null);
            }
        } catch (error) {
            console.error("Error marking trial as used:", error);
        }
    };
    const trackMembershipUsage = async (benefitType, serviceType, discountApplied = 0, amountSaved = 0)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) return;
            const { error } = await _supabase.supabase.from("membership_usage").insert({
                user_id: user.id,
                subscription_id: subscription.id,
                benefit_type: benefitType,
                service_type: serviceType,
                discount_applied: discountApplied,
                amount_saved: amountSaved
            });
            if (error) {
                console.error("Error tracking membership usage:", error);
            }
        } catch (error) {
            console.error("Error tracking membership usage:", error);
        }
    };
    const trackFeatureUsage = async (feature)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user) return false;
            // Check current usage limits
            if (!canUseFeature(feature)) {
                return false;
            }
            // Update usage counts
            const today = new Date().toISOString().split("T")[0];
            const currentMonth = new Date().toISOString().substring(0, 7);
            // Start from a strongly-typed baseline and then copy forward allowed counters
            let updatedUsage = {
                dailyMatchesUsed: 0,
                monthlyMessagesUsed: usage?.lastResetDate?.substring(0, 7) === currentMonth ? usage.monthlyMessagesUsed : 0,
                premiumEventsUsed: 0,
                livestreamHoursUsed: 0,
                lastResetDate: today
            };
            // If same day, carry forward today's counters
            if (usage && usage.lastResetDate === today) {
                updatedUsage.dailyMatchesUsed = usage.dailyMatchesUsed;
                updatedUsage.premiumEventsUsed = usage.premiumEventsUsed;
                updatedUsage.livestreamHoursUsed = usage.livestreamHoursUsed;
            }
            // Increment the specific counter
            switch(feature){
                case "match":
                    updatedUsage.dailyMatchesUsed++;
                    break;
                case "message":
                    updatedUsage.monthlyMessagesUsed++;
                    break;
                case "premium_event":
                    updatedUsage.premiumEventsUsed++;
                    break;
                case "livestream":
                    updatedUsage.livestreamHoursUsed++;
                    break;
            }
            // Save to database
            const { error } = await _supabase.supabase.from("subscription_usage").upsert({
                user_id: user.id,
                ...updatedUsage
            });
            if (error) {
                console.error("Error tracking feature usage:", error);
                return false;
            }
            setUsage(updatedUsage);
            return true;
        } catch (error) {
            console.error("Error tracking feature usage:", error);
            return false;
        }
    };
    const validateStudentStatus = async (studentEmail, universityId)=>{
        try {
            const response = await fetch("/api/validate-student", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    email: studentEmail,
                    universityId: universityId
                })
            });
            if (!response.ok) {
                return false;
            }
            const { isValid } = await response.json();
            return isValid;
        } catch (error) {
            console.error("Error validating student status:", error);
            return false;
        }
    };
    // Helper function to check feature usage
    const canUseFeature = (feature)=>{
        if (usageLimits.hasUnlimitedAccess) return true;
        if (!usage) return true // First time usage
        ;
        const today = new Date().toISOString().split("T")[0];
        const currentMonth = new Date().toISOString().substring(0, 7);
        // Reset counters if needed
        const dailyReset = usage.lastResetDate !== today;
        const monthlyReset = usage.lastResetDate.substring(0, 7) !== currentMonth;
        switch(feature){
            case "match":
                const dailyMatches = dailyReset ? 0 : usage.dailyMatchesUsed;
                return dailyMatches < usageLimits.dailyMatches;
            case "message":
                const monthlyMessages = monthlyReset ? 0 : usage.monthlyMessagesUsed;
                return monthlyMessages < usageLimits.monthlyMessages;
            case "premium_event":
                return usage.premiumEventsUsed < usageLimits.premiumEvents;
            case "livestream":
                return usage.livestreamHoursUsed < usageLimits.livestreamHours;
            default:
                return false;
        }
    };
    // Computed values
    const hasActiveSubscription = Boolean(subscription && subscription.status === "active" && subscription.current_period_end && new Date(subscription.current_period_end) > new Date());
    const isInTrial = Boolean(trial && !trial.is_used && new Date(trial.trial_end) > new Date());
    const trialDaysRemaining = trial && !trial.is_used ? Math.max(0, Math.ceil((new Date(trial.trial_end).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))) : 0;
    // Subscription is required for all users except demo users
    const subscriptionRequired = !_auth.authService.isDemoUser() && !hasActiveSubscription && !isInTrial;
    // Get current membership tier
    const membershipTier = hasActiveSubscription && subscription?.tier ? subscription.tier : "none";
    // Normalize to an effective tier for limits/discounts
    const effectiveTier = membershipTier === "none" ? "free" : membershipTier;
    // Calculate service discount based on tier - Portuguese-speaking community optimized
    const serviceDiscount = (()=>{
        switch(effectiveTier){
            case "community":
                return 10 // 10% member discount
                ;
            case "ambassador":
                return 20 // 20% ambassador discount  
                ;
            case "familia":
                return 15 // 15% family discount
                ;
            default:
                return 0;
        }
    })();
    // Usage limits based on tier - Optimized for Portuguese-speaking community conversion
    const usageLimits = (()=>{
        switch(effectiveTier){
            case "free":
                return {
                    dailyMatches: 2,
                    monthlyMessages: 3,
                    premiumEvents: 0,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
            case "community":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
            case "ambassador":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 5,
                    hasUnlimitedAccess: false // Limited streaming hours, not unlimited
                };
            case "familia":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 3,
                    hasUnlimitedAccess: false // Family-appropriate limitations
                };
            default:
                return {
                    dailyMatches: 2,
                    monthlyMessages: 3,
                    premiumEvents: 0,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
        }
    })();
    // Feature access functions
    const canSendMessage = ()=>{
        return canUseFeature("message");
    };
    const canCreateMatch = ()=>{
        return canUseFeature("match");
    };
    const canAccessPremiumEvent = ()=>{
        return canUseFeature("premium_event");
    };
    const canAccessLivestream = ()=>{
        return canUseFeature("livestream");
    };
    const getRemainingMatches = ()=>{
        if (usageLimits.hasUnlimitedAccess || usageLimits.dailyMatches === -1) return -1;
        const today = new Date().toISOString().split("T")[0];
        const dailyUsed = usage?.lastResetDate === today ? usage.dailyMatchesUsed : 0;
        return Math.max(0, usageLimits.dailyMatches - dailyUsed);
    };
    const getRemainingMessages = ()=>{
        if (usageLimits.hasUnlimitedAccess || usageLimits.monthlyMessages === -1) return -1;
        const currentMonth = new Date().toISOString().substring(0, 7);
        const monthlyUsed = usage?.lastResetDate?.substring(0, 7) === currentMonth ? usage.monthlyMessagesUsed : 0;
        return Math.max(0, usageLimits.monthlyMessages - monthlyUsed);
    };
    const value = {
        subscription,
        trial,
        usage,
        isLoading,
        hasActiveSubscription,
        isInTrial,
        trialDaysRemaining,
        subscriptionRequired,
        stripe,
        membershipTier,
        serviceDiscount,
        usageLimits,
        canSendMessage,
        canCreateMatch,
        canAccessPremiumEvent,
        canAccessLivestream,
        getRemainingMatches,
        getRemainingMessages,
        checkSubscriptionStatus,
        createSubscription,
        upgradeSubscription,
        cancelSubscription,
        redirectToSubscription,
        markTrialAsUsed,
        trackMembershipUsage,
        trackFeatureUsage,
        validateStudentStatus
    };
    return /*#__PURE__*/ (0, _jsxruntime.jsx)(SubscriptionContext.Provider, {
        value: value,
        children: children
    });
}
function useSubscription() {
    const context = (0, _react.useContext)(SubscriptionContext);
    if (context === undefined) {
        throw new Error("useSubscription must be used within a SubscriptionProvider");
    }
    return context;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL0x1c29Ub3duL3dlYi1hcHAvc3JjL2NvbnRleHQvU3Vic2NyaXB0aW9uQ29udGV4dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBjbGllbnQnXG5cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGxvYWRTdHJpcGUsIFN0cmlwZSB9IGZyb20gJ0BzdHJpcGUvc3RyaXBlLWpzJ1xuaW1wb3J0IHsgdXNlTGFuZ3VhZ2UgfSBmcm9tICcuL0xhbmd1YWdlQ29udGV4dCdcbmltcG9ydCB7IGF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9saWIvYXV0aCdcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnXG5pbXBvcnQgdG9hc3QgZnJvbSAncmVhY3QtaG90LXRvYXN0J1xuaW1wb3J0IHsgUk9VVEVTIH0gZnJvbSAnQC9jb25maWcvcm91dGVzJ1xuXG4vLyBJbml0aWFsaXplIFN0cmlwZSAtIHdpdGggZmFsbGJhY2sgZm9yIGRldmVsb3BtZW50XG5jb25zdCBzdHJpcGVQcm9taXNlID0gbG9hZFN0cmlwZShwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVFJJUEVfUFVCTElTSEFCTEVfS0VZIHx8ICdwa190ZXN0X3BsYWNlaG9sZGVyJylcblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb24ge1xuICBpZDogc3RyaW5nXG4gIHVzZXJfaWQ6IHN0cmluZ1xuICBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkPzogc3RyaW5nXG4gIHN0cmlwZV9jdXN0b21lcl9pZD86IHN0cmluZ1xuICBzdGF0dXM6ICdhY3RpdmUnIHwgJ2luYWN0aXZlJyB8ICdjYW5jZWxsZWQnIHwgJ3Bhc3RfZHVlJyB8ICd0cmlhbGluZydcbiAgcGxhbl90eXBlOiAnbW9udGhseScgfCAneWVhcmx5J1xuICB0aWVyOiAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyB8ICdmYW1pbGlhJ1xuICBjdXJyZW50X3BlcmlvZF9zdGFydD86IHN0cmluZ1xuICBjdXJyZW50X3BlcmlvZF9lbmQ/OiBzdHJpbmdcbiAgdHJpYWxfZW5kPzogc3RyaW5nXG4gIGFtb3VudDogbnVtYmVyXG4gIGN1cnJlbmN5OiBzdHJpbmdcbiAgc3R1ZGVudF92ZXJpZmllZD86IGJvb2xlYW5cbiAgY29ycG9yYXRlX2FjY291bnRfaWQ/OiBzdHJpbmdcbiAgY3JlYXRlZF9hdDogc3RyaW5nXG4gIHVwZGF0ZWRfYXQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvblRyaWFsIHtcbiAgaWQ6IHN0cmluZ1xuICB1c2VyX2lkOiBzdHJpbmdcbiAgdHJpYWxfc3RhcnQ6IHN0cmluZ1xuICB0cmlhbF9lbmQ6IHN0cmluZ1xuICBpc191c2VkOiBib29sZWFuXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvblVzYWdlTGltaXRzIHtcbiAgZGFpbHlNYXRjaGVzOiBudW1iZXJcbiAgbW9udGhseU1lc3NhZ2VzOiBudW1iZXJcbiAgcHJlbWl1bUV2ZW50czogbnVtYmVyXG4gIGxpdmVzdHJlYW1Ib3VyczogbnVtYmVyXG4gIGhhc1VubGltaXRlZEFjY2VzczogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvblVzYWdlIHtcbiAgZGFpbHlNYXRjaGVzVXNlZDogbnVtYmVyXG4gIG1vbnRobHlNZXNzYWdlc1VzZWQ6IG51bWJlclxuICBwcmVtaXVtRXZlbnRzVXNlZDogbnVtYmVyXG4gIGxpdmVzdHJlYW1Ib3Vyc1VzZWQ6IG51bWJlclxuICBsYXN0UmVzZXREYXRlOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFN1YnNjcmlwdGlvbkNvbnRleHRUeXBlIHtcbiAgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gfCBudWxsXG4gIHRyaWFsOiBTdWJzY3JpcHRpb25UcmlhbCB8IG51bGxcbiAgdXNhZ2U6IFN1YnNjcmlwdGlvblVzYWdlIHwgbnVsbFxuICBpc0xvYWRpbmc6IGJvb2xlYW5cbiAgaGFzQWN0aXZlU3Vic2NyaXB0aW9uOiBib29sZWFuXG4gIGlzSW5UcmlhbDogYm9vbGVhblxuICB0cmlhbERheXNSZW1haW5pbmc6IG51bWJlclxuICBzdWJzY3JpcHRpb25SZXF1aXJlZDogYm9vbGVhblxuICBzdHJpcGU6IFN0cmlwZSB8IG51bGxcbiAgbWVtYmVyc2hpcFRpZXI6ICdub25lJyB8ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InIHwgJ2ZhbWlsaWEnXG4gIHNlcnZpY2VEaXNjb3VudDogbnVtYmVyXG4gIHVzYWdlTGltaXRzOiBTdWJzY3JpcHRpb25Vc2FnZUxpbWl0c1xuICBcbiAgLy8gRmVhdHVyZSBhY2Nlc3NcbiAgY2FuU2VuZE1lc3NhZ2U6ICgpID0+IGJvb2xlYW5cbiAgY2FuQ3JlYXRlTWF0Y2g6ICgpID0+IGJvb2xlYW5cbiAgY2FuQWNjZXNzUHJlbWl1bUV2ZW50OiAoKSA9PiBib29sZWFuXG4gIGNhbkFjY2Vzc0xpdmVzdHJlYW06ICgpID0+IGJvb2xlYW5cbiAgZ2V0UmVtYWluaW5nTWF0Y2hlczogKCkgPT4gbnVtYmVyXG4gIGdldFJlbWFpbmluZ01lc3NhZ2VzOiAoKSA9PiBudW1iZXJcbiAgXG4gIC8vIEFjdGlvbnNcbiAgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXM6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgY3JlYXRlU3Vic2NyaXB0aW9uOiAodGllcj86ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InIHwgJ2ZhbWlsaWEnLCBwbGFuVHlwZT86ICdtb250aGx5JyB8ICd5ZWFybHknKSA9PiBQcm9taXNlPHN0cmluZyB8IG51bGw+XG4gIHVwZ3JhZGVTdWJzY3JpcHRpb246IChuZXdUaWVyOiAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyB8ICdmYW1pbGlhJykgPT4gUHJvbWlzZTxib29sZWFuPlxuICBjYW5jZWxTdWJzY3JpcHRpb246ICgpID0+IFByb21pc2U8Ym9vbGVhbj5cbiAgcmVkaXJlY3RUb1N1YnNjcmlwdGlvbjogKCkgPT4gdm9pZFxuICBtYXJrVHJpYWxBc1VzZWQ6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgdHJhY2tNZW1iZXJzaGlwVXNhZ2U6IChiZW5lZml0VHlwZTogc3RyaW5nLCBzZXJ2aWNlVHlwZTogc3RyaW5nLCBkaXNjb3VudEFwcGxpZWQ/OiBudW1iZXIsIGFtb3VudFNhdmVkPzogbnVtYmVyKSA9PiBQcm9taXNlPHZvaWQ+XG4gIHRyYWNrRmVhdHVyZVVzYWdlOiAoZmVhdHVyZTogJ21hdGNoJyB8ICdtZXNzYWdlJyB8ICdwcmVtaXVtX2V2ZW50JyB8ICdsaXZlc3RyZWFtJykgPT4gUHJvbWlzZTxib29sZWFuPlxuICB2YWxpZGF0ZVN0dWRlbnRTdGF0dXM6IChzdHVkZW50RW1haWw6IHN0cmluZywgdW5pdmVyc2l0eUlkOiBzdHJpbmcpID0+IFByb21pc2U8Ym9vbGVhbj5cbn1cblxuY29uc3QgU3Vic2NyaXB0aW9uQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8U3Vic2NyaXB0aW9uQ29udGV4dFR5cGUgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZClcblxuaW50ZXJmYWNlIFN1YnNjcmlwdGlvblByb3ZpZGVyUHJvcHMge1xuICBjaGlsZHJlbjogUmVhY3ROb2RlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBTdWJzY3JpcHRpb25Qcm92aWRlcih7IGNoaWxkcmVuIH06IFN1YnNjcmlwdGlvblByb3ZpZGVyUHJvcHMpIHtcbiAgY29uc3QgeyBsYW5ndWFnZSwgdCB9ID0gdXNlTGFuZ3VhZ2UoKVxuICBjb25zdCBbc3Vic2NyaXB0aW9uLCBzZXRTdWJzY3JpcHRpb25dID0gdXNlU3RhdGU8U3Vic2NyaXB0aW9uIHwgbnVsbD4obnVsbClcbiAgY29uc3QgW3RyaWFsLCBzZXRUcmlhbF0gPSB1c2VTdGF0ZTxTdWJzY3JpcHRpb25UcmlhbCB8IG51bGw+KG51bGwpXG4gIGNvbnN0IFt1c2FnZSwgc2V0VXNhZ2VdID0gdXNlU3RhdGU8U3Vic2NyaXB0aW9uVXNhZ2UgfCBudWxsPihudWxsKVxuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gdXNlU3RhdGUodHJ1ZSlcbiAgY29uc3QgW3N0cmlwZSwgc2V0U3RyaXBlXSA9IHVzZVN0YXRlPFN0cmlwZSB8IG51bGw+KG51bGwpXG5cbiAgLy8gSW5pdGlhbGl6ZSBTdHJpcGVcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBpbml0aWFsaXplU3RyaXBlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RyaXBlSW5zdGFuY2UgPSBhd2FpdCBzdHJpcGVQcm9taXNlXG4gICAgICBzZXRTdHJpcGUoc3RyaXBlSW5zdGFuY2UpXG4gICAgfVxuICAgIGluaXRpYWxpemVTdHJpcGUoKVxuICB9LCBbXSlcblxuICAvLyBMb2FkIHN1YnNjcmlwdGlvbiBzdGF0dXMgd2hlbiB1c2VyIGNoYW5nZXNcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBjaGVja1VzZXJTdWJzY3JpcHRpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKVxuICAgICAgaWYgKHVzZXIgJiYgIWF1dGhTZXJ2aWNlLmlzRGVtb1VzZXIoKSkge1xuICAgICAgICBhd2FpdCBjaGVja1N1YnNjcmlwdGlvblN0YXR1cygpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRTdWJzY3JpcHRpb24obnVsbClcbiAgICAgICAgc2V0VHJpYWwobnVsbClcbiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKVxuICAgICAgfVxuICAgIH1cblxuICAgIGNoZWNrVXNlclN1YnNjcmlwdGlvbigpXG5cbiAgICAvLyBMaXN0ZW4gZm9yIGF1dGggc3RhdGUgY2hhbmdlc1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gYXV0aFNlcnZpY2Uub25BdXRoU3RhdGVDaGFuZ2UoY2hlY2tVc2VyU3Vic2NyaXB0aW9uKVxuICAgIHJldHVybiB1bnN1YnNjcmliZVxuICB9LCBbXSlcblxuICBjb25zdCBjaGVja1N1YnNjcmlwdGlvblN0YXR1cyA9IGFzeW5jICgpID0+IHtcbiAgICBzZXRJc0xvYWRpbmcodHJ1ZSlcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIGlmICghdXNlciB8fCBhdXRoU2VydmljZS5pc0RlbW9Vc2VyKCkpIHtcbiAgICAgICAgc2V0U3Vic2NyaXB0aW9uKG51bGwpXG4gICAgICAgIHNldFRyaWFsKG51bGwpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBmb3IgYWN0aXZlIHN1YnNjcmlwdGlvblxuICAgICAgY29uc3QgeyBkYXRhOiBzdWJzY3JpcHRpb25EYXRhLCBlcnJvcjogc3ViRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25zJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXG4gICAgICAgIC5lcSgnc3RhdHVzJywgJ2FjdGl2ZScpXG4gICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICBpZiAoc3ViRXJyb3IgJiYgc3ViRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdWJzY3JpcHRpb246Jywgc3ViRXJyb3IpXG4gICAgICB9IGVsc2UgaWYgKHN1YnNjcmlwdGlvbkRhdGEpIHtcbiAgICAgICAgc2V0U3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbkRhdGEpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciB0cmlhbCBzdGF0dXNcbiAgICAgIGNvbnN0IHsgZGF0YTogdHJpYWxEYXRhLCBlcnJvcjogdHJpYWxFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbl90cmlhbHMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZClcbiAgICAgICAgLnNpbmdsZSgpXG5cbiAgICAgIGlmICh0cmlhbEVycm9yICYmIHRyaWFsRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB0cmlhbDonLCB0cmlhbEVycm9yKVxuICAgICAgfSBlbHNlIGlmICh0cmlhbERhdGEpIHtcbiAgICAgICAgc2V0VHJpYWwodHJpYWxEYXRhKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBzdWJzY3JpcHRpb24gc3RhdHVzOicsIGVycm9yKVxuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgY3JlYXRlU3Vic2NyaXB0aW9uID0gYXN5bmMgKFxuICAgIHRpZXI6ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InIHwgJ2ZhbWlsaWEnID0gJ2NvbW11bml0eScsXG4gICAgcGxhblR5cGU6ICdtb250aGx5JyB8ICd5ZWFybHknID0gJ21vbnRobHknXG4gICk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKVxuICAgICAgaWYgKCF1c2VyIHx8IGF1dGhTZXJ2aWNlLmlzRGVtb1VzZXIoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbXVzdCBiZSBsb2dnZWQgaW4gdG8gY3JlYXRlIHN1YnNjcmlwdGlvbicpXG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgeW91ciBiYWNrZW5kIEFQSSB0byBjcmVhdGUgU3RyaXBlIGNoZWNrb3V0IHNlc3Npb25cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvY3JlYXRlLXN1YnNjcmlwdGlvbicsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICB1c2VyTmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgIHRpZXI6IHRpZXIsXG4gICAgICAgICAgcGxhblR5cGU6IHBsYW5UeXBlLFxuICAgICAgICB9KSxcbiAgICAgIH0pXG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHN1YnNjcmlwdGlvbicpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgc2Vzc2lvbklkIH0gPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICAgIFxuICAgICAgaWYgKCFzdHJpcGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdHJpcGUgbm90IGluaXRpYWxpemVkJylcbiAgICAgIH1cblxuICAgICAgLy8gUmVkaXJlY3QgdG8gU3RyaXBlIENoZWNrb3V0XG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdHJpcGUucmVkaXJlY3RUb0NoZWNrb3V0KHtcbiAgICAgICAgc2Vzc2lvbklkLFxuICAgICAgfSlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N0cmlwZSBjaGVja291dCBlcnJvcjonLCBlcnJvcilcbiAgICAgICAgdG9hc3QuZXJyb3IoXG4gICAgICAgICAgbGFuZ3VhZ2UgPT09ICdwdCcgXG4gICAgICAgICAgICA/ICdFcnJvIGFvIHByb2Nlc3NhciBwYWdhbWVudG8uIFRlbnRlIG5vdmFtZW50ZS4nIFxuICAgICAgICAgICAgOiAnUGF5bWVudCBwcm9jZXNzaW5nIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLidcbiAgICAgICAgKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2Vzc2lvbklkXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcilcbiAgICAgIHRvYXN0LmVycm9yKFxuICAgICAgICBsYW5ndWFnZSA9PT0gJ3B0JyBcbiAgICAgICAgICA/ICdFcnJvIGFvIGNyaWFyIHN1YnNjcmnDp8Ojby4gVGVudGUgbm92YW1lbnRlLicgXG4gICAgICAgICAgOiAnRXJyb3IgY3JlYXRpbmcgc3Vic2NyaXB0aW9uLiBQbGVhc2UgdHJ5IGFnYWluLidcbiAgICAgIClcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICB9XG5cbiAgY29uc3QgY2FuY2VsU3Vic2NyaXB0aW9uID0gYXN5bmMgKCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKVxuICAgICAgaWYgKCF1c2VyIHx8ICFzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvY2FuY2VsLXN1YnNjcmlwdGlvbicsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6IHN1YnNjcmlwdGlvbi5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkLFxuICAgICAgICB9KSxcbiAgICAgIH0pXG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY2FuY2VsIHN1YnNjcmlwdGlvbicpXG4gICAgICB9XG5cbiAgICAgIC8vIFJlZnJlc2ggc3Vic2NyaXB0aW9uIHN0YXR1c1xuICAgICAgYXdhaXQgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXMoKVxuICAgICAgXG4gICAgICB0b2FzdC5zdWNjZXNzKFxuICAgICAgICBsYW5ndWFnZSA9PT0gJ3B0JyBcbiAgICAgICAgICA/ICdTdWJzY3Jpw6fDo28gY2FuY2VsYWRhIGNvbSBzdWNlc3NvJyBcbiAgICAgICAgICA6ICdTdWJzY3JpcHRpb24gY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIClcbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FuY2VsbGluZyBzdWJzY3JpcHRpb246JywgZXJyb3IpXG4gICAgICB0b2FzdC5lcnJvcihcbiAgICAgICAgbGFuZ3VhZ2UgPT09ICdwdCcgXG4gICAgICAgICAgPyAnRXJybyBhbyBjYW5jZWxhciBzdWJzY3Jpw6fDo28nIFxuICAgICAgICAgIDogJ0Vycm9yIGNhbmNlbGxpbmcgc3Vic2NyaXB0aW9uJ1xuICAgICAgKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVkaXJlY3RUb1N1YnNjcmlwdGlvbiA9ICgpID0+IHtcbiAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBST1VURVMuc3Vic2NyaXB0aW9uXG4gIH1cblxuICBjb25zdCB1cGdyYWRlU3Vic2NyaXB0aW9uID0gYXN5bmMgKG5ld1RpZXI6ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgIXN1YnNjcmlwdGlvbikge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS91cGdyYWRlLXN1YnNjcmlwdGlvbicsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6IHN1YnNjcmlwdGlvbi5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkLFxuICAgICAgICAgIG5ld1RpZXI6IG5ld1RpZXIsXG4gICAgICAgIH0pLFxuICAgICAgfSlcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byB1cGdyYWRlIHN1YnNjcmlwdGlvbicpXG4gICAgICB9XG5cbiAgICAgIC8vIFJlZnJlc2ggc3Vic2NyaXB0aW9uIHN0YXR1c1xuICAgICAgYXdhaXQgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXMoKVxuICAgICAgXG4gICAgICB0b2FzdC5zdWNjZXNzKFxuICAgICAgICBsYW5ndWFnZSA9PT0gJ3B0JyBcbiAgICAgICAgICA/ICdTdWJzY3Jpw6fDo28gYXR1YWxpemFkYSBjb20gc3VjZXNzbycgXG4gICAgICAgICAgOiAnU3Vic2NyaXB0aW9uIHVwZ3JhZGVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIClcbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBncmFkaW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcilcbiAgICAgIHRvYXN0LmVycm9yKFxuICAgICAgICBsYW5ndWFnZSA9PT0gJ3B0JyBcbiAgICAgICAgICA/ICdFcnJvIGFvIGF0dWFsaXphciBzdWJzY3Jpw6fDo28nIFxuICAgICAgICAgIDogJ0Vycm9yIHVwZ3JhZGluZyBzdWJzY3JpcHRpb24nXG4gICAgICApXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBjb25zdCBtYXJrVHJpYWxBc1VzZWQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgIXRyaWFsKSByZXR1cm5cblxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbl90cmlhbHMnKVxuICAgICAgICAudXBkYXRlKHsgaXNfdXNlZDogdHJ1ZSB9KVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbWFya2luZyB0cmlhbCBhcyB1c2VkOicsIGVycm9yKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0VHJpYWwocHJldiA9PiBwcmV2ID8geyAuLi5wcmV2LCBpc191c2VkOiB0cnVlIH0gOiBudWxsKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtYXJraW5nIHRyaWFsIGFzIHVzZWQ6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdHJhY2tNZW1iZXJzaGlwVXNhZ2UgPSBhc3luYyAoXG4gICAgYmVuZWZpdFR5cGU6IHN0cmluZywgXG4gICAgc2VydmljZVR5cGU6IHN0cmluZywgXG4gICAgZGlzY291bnRBcHBsaWVkOiBudW1iZXIgPSAwLCBcbiAgICBhbW91bnRTYXZlZDogbnVtYmVyID0gMFxuICApID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIGlmICghdXNlciB8fCAhc3Vic2NyaXB0aW9uKSByZXR1cm5cblxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ21lbWJlcnNoaXBfdXNhZ2UnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLFxuICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgIGJlbmVmaXRfdHlwZTogYmVuZWZpdFR5cGUsXG4gICAgICAgICAgc2VydmljZV90eXBlOiBzZXJ2aWNlVHlwZSxcbiAgICAgICAgICBkaXNjb3VudF9hcHBsaWVkOiBkaXNjb3VudEFwcGxpZWQsXG4gICAgICAgICAgYW1vdW50X3NhdmVkOiBhbW91bnRTYXZlZCxcbiAgICAgICAgfSlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIG1lbWJlcnNoaXAgdXNhZ2U6JywgZXJyb3IpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIG1lbWJlcnNoaXAgdXNhZ2U6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdHJhY2tGZWF0dXJlVXNhZ2UgPSBhc3luYyAoZmVhdHVyZTogJ21hdGNoJyB8ICdtZXNzYWdlJyB8ICdwcmVtaXVtX2V2ZW50JyB8ICdsaXZlc3RyZWFtJyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKVxuICAgICAgaWYgKCF1c2VyKSByZXR1cm4gZmFsc2VcblxuICAgICAgLy8gQ2hlY2sgY3VycmVudCB1c2FnZSBsaW1pdHNcbiAgICAgIGlmICghY2FuVXNlRmVhdHVyZShmZWF0dXJlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIHVzYWdlIGNvdW50c1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICAgICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCA3KVxuICAgICAgXG4gICAgICAvLyBTdGFydCBmcm9tIGEgc3Ryb25nbHktdHlwZWQgYmFzZWxpbmUgYW5kIHRoZW4gY29weSBmb3J3YXJkIGFsbG93ZWQgY291bnRlcnNcbiAgICAgIGxldCB1cGRhdGVkVXNhZ2U6IFN1YnNjcmlwdGlvblVzYWdlID0ge1xuICAgICAgICBkYWlseU1hdGNoZXNVc2VkOiAwLFxuICAgICAgICBtb250aGx5TWVzc2FnZXNVc2VkOlxuICAgICAgICAgIHVzYWdlPy5sYXN0UmVzZXREYXRlPy5zdWJzdHJpbmcoMCwgNykgPT09IGN1cnJlbnRNb250aCA/IHVzYWdlIS5tb250aGx5TWVzc2FnZXNVc2VkIDogMCxcbiAgICAgICAgcHJlbWl1bUV2ZW50c1VzZWQ6IDAsXG4gICAgICAgIGxpdmVzdHJlYW1Ib3Vyc1VzZWQ6IDAsXG4gICAgICAgIGxhc3RSZXNldERhdGU6IHRvZGF5LFxuICAgICAgfVxuXG4gICAgICAvLyBJZiBzYW1lIGRheSwgY2FycnkgZm9yd2FyZCB0b2RheSdzIGNvdW50ZXJzXG4gICAgICBpZiAodXNhZ2UgJiYgdXNhZ2UubGFzdFJlc2V0RGF0ZSA9PT0gdG9kYXkpIHtcbiAgICAgICAgdXBkYXRlZFVzYWdlLmRhaWx5TWF0Y2hlc1VzZWQgPSB1c2FnZS5kYWlseU1hdGNoZXNVc2VkXG4gICAgICAgIHVwZGF0ZWRVc2FnZS5wcmVtaXVtRXZlbnRzVXNlZCA9IHVzYWdlLnByZW1pdW1FdmVudHNVc2VkXG4gICAgICAgIHVwZGF0ZWRVc2FnZS5saXZlc3RyZWFtSG91cnNVc2VkID0gdXNhZ2UubGl2ZXN0cmVhbUhvdXJzVXNlZFxuICAgICAgfVxuXG4gICAgICAvLyBJbmNyZW1lbnQgdGhlIHNwZWNpZmljIGNvdW50ZXJcbiAgICAgIHN3aXRjaCAoZmVhdHVyZSkge1xuICAgICAgICBjYXNlICdtYXRjaCc6XG4gICAgICAgICAgdXBkYXRlZFVzYWdlLmRhaWx5TWF0Y2hlc1VzZWQrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ21lc3NhZ2UnOlxuICAgICAgICAgIHVwZGF0ZWRVc2FnZS5tb250aGx5TWVzc2FnZXNVc2VkKytcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlICdwcmVtaXVtX2V2ZW50JzpcbiAgICAgICAgICB1cGRhdGVkVXNhZ2UucHJlbWl1bUV2ZW50c1VzZWQrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ2xpdmVzdHJlYW0nOlxuICAgICAgICAgIHVwZGF0ZWRVc2FnZS5saXZlc3RyZWFtSG91cnNVc2VkKytcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuXG4gICAgICAvLyBTYXZlIHRvIGRhdGFiYXNlXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3VzYWdlJylcbiAgICAgICAgLnVwc2VydCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICAuLi51cGRhdGVkVXNhZ2VcbiAgICAgICAgfSlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIGZlYXR1cmUgdXNhZ2U6JywgZXJyb3IpXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gIHNldFVzYWdlKHVwZGF0ZWRVc2FnZSlcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIGZlYXR1cmUgdXNhZ2U6JywgZXJyb3IpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBjb25zdCB2YWxpZGF0ZVN0dWRlbnRTdGF0dXMgPSBhc3luYyAoc3R1ZGVudEVtYWlsOiBzdHJpbmcsIHVuaXZlcnNpdHlJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvdmFsaWRhdGUtc3R1ZGVudCcsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZW1haWw6IHN0dWRlbnRFbWFpbCxcbiAgICAgICAgICB1bml2ZXJzaXR5SWQ6IHVuaXZlcnNpdHlJZCxcbiAgICAgICAgfSksXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGlzVmFsaWQgfSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgcmV0dXJuIGlzVmFsaWRcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdmFsaWRhdGluZyBzdHVkZW50IHN0YXR1czonLCBlcnJvcilcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBmZWF0dXJlIHVzYWdlXG4gIGNvbnN0IGNhblVzZUZlYXR1cmUgPSAoZmVhdHVyZTogJ21hdGNoJyB8ICdtZXNzYWdlJyB8ICdwcmVtaXVtX2V2ZW50JyB8ICdsaXZlc3RyZWFtJyk6IGJvb2xlYW4gPT4ge1xuICAgIGlmICh1c2FnZUxpbWl0cy5oYXNVbmxpbWl0ZWRBY2Nlc3MpIHJldHVybiB0cnVlXG4gICAgaWYgKCF1c2FnZSkgcmV0dXJuIHRydWUgLy8gRmlyc3QgdGltZSB1c2FnZVxuXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgNylcbiAgICBcbiAgICAvLyBSZXNldCBjb3VudGVycyBpZiBuZWVkZWRcbiAgICBjb25zdCBkYWlseVJlc2V0ID0gdXNhZ2UubGFzdFJlc2V0RGF0ZSAhPT0gdG9kYXlcbiAgICBjb25zdCBtb250aGx5UmVzZXQgPSB1c2FnZS5sYXN0UmVzZXREYXRlLnN1YnN0cmluZygwLCA3KSAhPT0gY3VycmVudE1vbnRoXG5cbiAgICBzd2l0Y2ggKGZlYXR1cmUpIHtcbiAgICAgIGNhc2UgJ21hdGNoJzpcbiAgICAgICAgY29uc3QgZGFpbHlNYXRjaGVzID0gZGFpbHlSZXNldCA/IDAgOiB1c2FnZS5kYWlseU1hdGNoZXNVc2VkXG4gICAgICAgIHJldHVybiBkYWlseU1hdGNoZXMgPCB1c2FnZUxpbWl0cy5kYWlseU1hdGNoZXNcbiAgICAgIGNhc2UgJ21lc3NhZ2UnOlxuICAgICAgICBjb25zdCBtb250aGx5TWVzc2FnZXMgPSBtb250aGx5UmVzZXQgPyAwIDogdXNhZ2UubW9udGhseU1lc3NhZ2VzVXNlZFxuICAgICAgICByZXR1cm4gbW9udGhseU1lc3NhZ2VzIDwgdXNhZ2VMaW1pdHMubW9udGhseU1lc3NhZ2VzXG4gICAgICBjYXNlICdwcmVtaXVtX2V2ZW50JzpcbiAgICAgICAgcmV0dXJuIHVzYWdlLnByZW1pdW1FdmVudHNVc2VkIDwgdXNhZ2VMaW1pdHMucHJlbWl1bUV2ZW50c1xuICAgICAgY2FzZSAnbGl2ZXN0cmVhbSc6XG4gICAgICAgIHJldHVybiB1c2FnZS5saXZlc3RyZWFtSG91cnNVc2VkIDwgdXNhZ2VMaW1pdHMubGl2ZXN0cmVhbUhvdXJzXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICAvLyBDb21wdXRlZCB2YWx1ZXNcbiAgY29uc3QgaGFzQWN0aXZlU3Vic2NyaXB0aW9uID0gQm9vbGVhbihcbiAgICBzdWJzY3JpcHRpb24gJiYgXG4gICAgc3Vic2NyaXB0aW9uLnN0YXR1cyA9PT0gJ2FjdGl2ZScgJiYgXG4gICAgc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAmJiBcbiAgICBuZXcgRGF0ZShzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2RfZW5kKSA+IG5ldyBEYXRlKClcbiAgKVxuXG4gIGNvbnN0IGlzSW5UcmlhbCA9IEJvb2xlYW4oXG4gICAgdHJpYWwgJiYgXG4gICAgIXRyaWFsLmlzX3VzZWQgJiYgXG4gICAgbmV3IERhdGUodHJpYWwudHJpYWxfZW5kKSA+IG5ldyBEYXRlKClcbiAgKVxuXG4gIGNvbnN0IHRyaWFsRGF5c1JlbWFpbmluZyA9IHRyaWFsICYmICF0cmlhbC5pc191c2VkID8gXG4gICAgTWF0aC5tYXgoMCwgTWF0aC5jZWlsKChuZXcgRGF0ZSh0cmlhbC50cmlhbF9lbmQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSkpIDogXG4gICAgMFxuXG4gIC8vIFN1YnNjcmlwdGlvbiBpcyByZXF1aXJlZCBmb3IgYWxsIHVzZXJzIGV4Y2VwdCBkZW1vIHVzZXJzXG4gIGNvbnN0IHN1YnNjcmlwdGlvblJlcXVpcmVkID0gIWF1dGhTZXJ2aWNlLmlzRGVtb1VzZXIoKSAmJiAhaGFzQWN0aXZlU3Vic2NyaXB0aW9uICYmICFpc0luVHJpYWxcblxuICAvLyBHZXQgY3VycmVudCBtZW1iZXJzaGlwIHRpZXJcbiAgY29uc3QgbWVtYmVyc2hpcFRpZXI6ICdub25lJyB8ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InID0gXG4gICAgaGFzQWN0aXZlU3Vic2NyaXB0aW9uICYmIHN1YnNjcmlwdGlvbj8udGllciA/IHN1YnNjcmlwdGlvbi50aWVyIDogJ25vbmUnXG5cbiAgLy8gTm9ybWFsaXplIHRvIGFuIGVmZmVjdGl2ZSB0aWVyIGZvciBsaW1pdHMvZGlzY291bnRzXG4gIGNvbnN0IGVmZmVjdGl2ZVRpZXI6ICdmcmVlJyB8ICdjb21tdW5pdHknIHwgJ2FtYmFzc2Fkb3InIHwgJ2ZhbWlsaWEnID0gbWVtYmVyc2hpcFRpZXIgPT09ICdub25lJyA/ICdmcmVlJyA6IG1lbWJlcnNoaXBUaWVyXG5cbiAgLy8gQ2FsY3VsYXRlIHNlcnZpY2UgZGlzY291bnQgYmFzZWQgb24gdGllciAtIFBvcnR1Z3Vlc2Utc3BlYWtpbmcgY29tbXVuaXR5IG9wdGltaXplZFxuICBjb25zdCBzZXJ2aWNlRGlzY291bnQgPSAoKCkgPT4ge1xuICAgIHN3aXRjaCAoZWZmZWN0aXZlVGllcikge1xuICAgICAgY2FzZSAnY29tbXVuaXR5JzogcmV0dXJuIDEwIC8vIDEwJSBtZW1iZXIgZGlzY291bnRcbiAgICAgIGNhc2UgJ2FtYmFzc2Fkb3InOiByZXR1cm4gMjAgLy8gMjAlIGFtYmFzc2Fkb3IgZGlzY291bnQgIFxuICAgICAgY2FzZSAnZmFtaWxpYSc6IHJldHVybiAxNSAvLyAxNSUgZmFtaWx5IGRpc2NvdW50XG4gICAgICBkZWZhdWx0OiByZXR1cm4gMFxuICAgIH1cbiAgfSkoKVxuXG4gIC8vIFVzYWdlIGxpbWl0cyBiYXNlZCBvbiB0aWVyIC0gT3B0aW1pemVkIGZvciBQb3J0dWd1ZXNlLXNwZWFraW5nIGNvbW11bml0eSBjb252ZXJzaW9uXG4gIGNvbnN0IHVzYWdlTGltaXRzOiBTdWJzY3JpcHRpb25Vc2FnZUxpbWl0cyA9ICgoKSA9PiB7XG4gICAgc3dpdGNoIChlZmZlY3RpdmVUaWVyKSB7XG4gICAgICBjYXNlICdmcmVlJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYWlseU1hdGNoZXM6IDIsIC8vIFN0cmF0ZWdpYyBsaW1pdGF0aW9uIGVuY291cmFnaW5nIHVwZ3JhZGVcbiAgICAgICAgICBtb250aGx5TWVzc2FnZXM6IDMsIC8vIFN0cmF0ZWdpYyBsaW1pdGF0aW9uIGVuY291cmFnaW5nIHVwZ3JhZGVcbiAgICAgICAgICBwcmVtaXVtRXZlbnRzOiAwLFxuICAgICAgICAgIGxpdmVzdHJlYW1Ib3VyczogMCxcbiAgICAgICAgICBoYXNVbmxpbWl0ZWRBY2Nlc3M6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ2NvbW11bml0eSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGFpbHlNYXRjaGVzOiAtMSwgLy8gdW5saW1pdGVkIG1hdGNoZXNcbiAgICAgICAgICBtb250aGx5TWVzc2FnZXM6IC0xLCAvLyB1bmxpbWl0ZWQgbWVzc2FnaW5nXG4gICAgICAgICAgcHJlbWl1bUV2ZW50czogLTEsIC8vIHVubGltaXRlZCBjb21tdW5pdHkgZXZlbnRzIChub3QgcHJlbWl1bSBldmVudHMpXG4gICAgICAgICAgbGl2ZXN0cmVhbUhvdXJzOiAwLCAvLyBubyBzdHJlYW1pbmcgYWNjZXNzIGZvciBjb21tdW5pdHkgdGllclxuICAgICAgICAgIGhhc1VubGltaXRlZEFjY2VzczogZmFsc2VcbiAgICAgICAgfVxuICAgICAgY2FzZSAnYW1iYXNzYWRvcic6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGFpbHlNYXRjaGVzOiAtMSwgLy8gdW5saW1pdGVkXG4gICAgICAgICAgbW9udGhseU1lc3NhZ2VzOiAtMSwgLy8gdW5saW1pdGVkXG4gICAgICAgICAgcHJlbWl1bUV2ZW50czogLTEsIC8vIHVubGltaXRlZCBpbmNsdWRpbmcgcHJlbWl1bSBldmVudHNcbiAgICAgICAgICBsaXZlc3RyZWFtSG91cnM6IDUsIC8vIDUgaG91cnMgcGVyIG1vbnRoIGFzIHN0YXRlZCBpbiBiZW5lZml0c1xuICAgICAgICAgIGhhc1VubGltaXRlZEFjY2VzczogZmFsc2UgLy8gTGltaXRlZCBzdHJlYW1pbmcgaG91cnMsIG5vdCB1bmxpbWl0ZWRcbiAgICAgICAgfVxuICAgICAgY2FzZSAnZmFtaWxpYSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGFpbHlNYXRjaGVzOiAtMSwgLy8gdW5saW1pdGVkIGZvciBhbGwgZmFtaWx5IG1lbWJlcnNcbiAgICAgICAgICBtb250aGx5TWVzc2FnZXM6IC0xLCAvLyB1bmxpbWl0ZWQgZm9yIGFsbCBmYW1pbHkgbWVtYmVyc1xuICAgICAgICAgIHByZW1pdW1FdmVudHM6IC0xLCAvLyB1bmxpbWl0ZWQgaW5jbHVkaW5nIHByZW1pdW0gZXZlbnRzXG4gICAgICAgICAgbGl2ZXN0cmVhbUhvdXJzOiAzLCAvLyAzIGhvdXJzIHBlciBtb250aCBmb3IgZmFtaWx5IHBsYW5cbiAgICAgICAgICBoYXNVbmxpbWl0ZWRBY2Nlc3M6IGZhbHNlIC8vIEZhbWlseS1hcHByb3ByaWF0ZSBsaW1pdGF0aW9uc1xuICAgICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhaWx5TWF0Y2hlczogMixcbiAgICAgICAgICBtb250aGx5TWVzc2FnZXM6IDMsXG4gICAgICAgICAgcHJlbWl1bUV2ZW50czogMCxcbiAgICAgICAgICBsaXZlc3RyZWFtSG91cnM6IDAsXG4gICAgICAgICAgaGFzVW5saW1pdGVkQWNjZXNzOiBmYWxzZVxuICAgICAgICB9XG4gICAgfVxuICB9KSgpXG5cbiAgLy8gRmVhdHVyZSBhY2Nlc3MgZnVuY3Rpb25zXG4gIGNvbnN0IGNhblNlbmRNZXNzYWdlID0gKCk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiBjYW5Vc2VGZWF0dXJlKCdtZXNzYWdlJylcbiAgfVxuXG4gIGNvbnN0IGNhbkNyZWF0ZU1hdGNoID0gKCk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiBjYW5Vc2VGZWF0dXJlKCdtYXRjaCcpXG4gIH1cblxuICBjb25zdCBjYW5BY2Nlc3NQcmVtaXVtRXZlbnQgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIGNhblVzZUZlYXR1cmUoJ3ByZW1pdW1fZXZlbnQnKVxuICB9XG5cbiAgY29uc3QgY2FuQWNjZXNzTGl2ZXN0cmVhbSA9ICgpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gY2FuVXNlRmVhdHVyZSgnbGl2ZXN0cmVhbScpXG4gIH1cblxuICBjb25zdCBnZXRSZW1haW5pbmdNYXRjaGVzID0gKCk6IG51bWJlciA9PiB7XG4gICAgaWYgKHVzYWdlTGltaXRzLmhhc1VubGltaXRlZEFjY2VzcyB8fCB1c2FnZUxpbWl0cy5kYWlseU1hdGNoZXMgPT09IC0xKSByZXR1cm4gLTFcbiAgICBcbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgY29uc3QgZGFpbHlVc2VkID0gdXNhZ2U/Lmxhc3RSZXNldERhdGUgPT09IHRvZGF5ID8gdXNhZ2UuZGFpbHlNYXRjaGVzVXNlZCA6IDBcbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgdXNhZ2VMaW1pdHMuZGFpbHlNYXRjaGVzIC0gZGFpbHlVc2VkKVxuICB9XG5cbiAgY29uc3QgZ2V0UmVtYWluaW5nTWVzc2FnZXMgPSAoKTogbnVtYmVyID0+IHtcbiAgICBpZiAodXNhZ2VMaW1pdHMuaGFzVW5saW1pdGVkQWNjZXNzIHx8IHVzYWdlTGltaXRzLm1vbnRobHlNZXNzYWdlcyA9PT0gLTEpIHJldHVybiAtMVxuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgNylcbiAgICBjb25zdCBtb250aGx5VXNlZCA9IHVzYWdlPy5sYXN0UmVzZXREYXRlPy5zdWJzdHJpbmcoMCwgNykgPT09IGN1cnJlbnRNb250aCA/IHVzYWdlLm1vbnRobHlNZXNzYWdlc1VzZWQgOiAwXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIHVzYWdlTGltaXRzLm1vbnRobHlNZXNzYWdlcyAtIG1vbnRobHlVc2VkKVxuICB9XG5cbiAgY29uc3QgdmFsdWU6IFN1YnNjcmlwdGlvbkNvbnRleHRUeXBlID0ge1xuICAgIHN1YnNjcmlwdGlvbixcbiAgICB0cmlhbCxcbiAgICB1c2FnZSxcbiAgICBpc0xvYWRpbmcsXG4gICAgaGFzQWN0aXZlU3Vic2NyaXB0aW9uLFxuICAgIGlzSW5UcmlhbCxcbiAgICB0cmlhbERheXNSZW1haW5pbmcsXG4gICAgc3Vic2NyaXB0aW9uUmVxdWlyZWQsXG4gICAgc3RyaXBlLFxuICAgIG1lbWJlcnNoaXBUaWVyLFxuICAgIHNlcnZpY2VEaXNjb3VudCxcbiAgICB1c2FnZUxpbWl0cyxcbiAgICBjYW5TZW5kTWVzc2FnZSxcbiAgICBjYW5DcmVhdGVNYXRjaCxcbiAgICBjYW5BY2Nlc3NQcmVtaXVtRXZlbnQsXG4gICAgY2FuQWNjZXNzTGl2ZXN0cmVhbSxcbiAgICBnZXRSZW1haW5pbmdNYXRjaGVzLFxuICAgIGdldFJlbWFpbmluZ01lc3NhZ2VzLFxuICAgIGNoZWNrU3Vic2NyaXB0aW9uU3RhdHVzLFxuICAgIGNyZWF0ZVN1YnNjcmlwdGlvbixcbiAgICB1cGdyYWRlU3Vic2NyaXB0aW9uLFxuICAgIGNhbmNlbFN1YnNjcmlwdGlvbixcbiAgICByZWRpcmVjdFRvU3Vic2NyaXB0aW9uLFxuICAgIG1hcmtUcmlhbEFzVXNlZCxcbiAgICB0cmFja01lbWJlcnNoaXBVc2FnZSxcbiAgICB0cmFja0ZlYXR1cmVVc2FnZSxcbiAgICB2YWxpZGF0ZVN0dWRlbnRTdGF0dXMsXG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxTdWJzY3JpcHRpb25Db250ZXh0LlByb3ZpZGVyIHZhbHVlPXt2YWx1ZX0+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9TdWJzY3JpcHRpb25Db250ZXh0LlByb3ZpZGVyPlxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VTdWJzY3JpcHRpb24oKSB7XG4gIGNvbnN0IGNvbnRleHQgPSB1c2VDb250ZXh0KFN1YnNjcmlwdGlvbkNvbnRleHQpXG4gIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZVN1YnNjcmlwdGlvbiBtdXN0IGJlIHVzZWQgd2l0aGluIGEgU3Vic2NyaXB0aW9uUHJvdmlkZXInKVxuICB9XG4gIHJldHVybiBjb250ZXh0XG59Il0sIm5hbWVzIjpbIlN1YnNjcmlwdGlvblByb3ZpZGVyIiwidXNlU3Vic2NyaXB0aW9uIiwic3RyaXBlUHJvbWlzZSIsImxvYWRTdHJpcGUiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1RSSVBFX1BVQkxJU0hBQkxFX0tFWSIsIlN1YnNjcmlwdGlvbkNvbnRleHQiLCJjcmVhdGVDb250ZXh0IiwidW5kZWZpbmVkIiwiY2hpbGRyZW4iLCJsYW5ndWFnZSIsInQiLCJ1c2VMYW5ndWFnZSIsInN1YnNjcmlwdGlvbiIsInNldFN1YnNjcmlwdGlvbiIsInVzZVN0YXRlIiwidHJpYWwiLCJzZXRUcmlhbCIsInVzYWdlIiwic2V0VXNhZ2UiLCJpc0xvYWRpbmciLCJzZXRJc0xvYWRpbmciLCJzdHJpcGUiLCJzZXRTdHJpcGUiLCJ1c2VFZmZlY3QiLCJpbml0aWFsaXplU3RyaXBlIiwic3RyaXBlSW5zdGFuY2UiLCJjaGVja1VzZXJTdWJzY3JpcHRpb24iLCJ1c2VyIiwiYXV0aFNlcnZpY2UiLCJnZXRDdXJyZW50VXNlciIsImlzRGVtb1VzZXIiLCJjaGVja1N1YnNjcmlwdGlvblN0YXR1cyIsInVuc3Vic2NyaWJlIiwib25BdXRoU3RhdGVDaGFuZ2UiLCJkYXRhIiwic3Vic2NyaXB0aW9uRGF0YSIsImVycm9yIiwic3ViRXJyb3IiLCJzdXBhYmFzZSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwiY29kZSIsImNvbnNvbGUiLCJ0cmlhbERhdGEiLCJ0cmlhbEVycm9yIiwiY3JlYXRlU3Vic2NyaXB0aW9uIiwidGllciIsInBsYW5UeXBlIiwiRXJyb3IiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidXNlcklkIiwidXNlckVtYWlsIiwiZW1haWwiLCJ1c2VyTmFtZSIsIm5hbWUiLCJvayIsInNlc3Npb25JZCIsImpzb24iLCJyZWRpcmVjdFRvQ2hlY2tvdXQiLCJ0b2FzdCIsImNhbmNlbFN1YnNjcmlwdGlvbiIsInN1YnNjcmlwdGlvbklkIiwic3RyaXBlX3N1YnNjcmlwdGlvbl9pZCIsInN1Y2Nlc3MiLCJyZWRpcmVjdFRvU3Vic2NyaXB0aW9uIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwiUk9VVEVTIiwidXBncmFkZVN1YnNjcmlwdGlvbiIsIm5ld1RpZXIiLCJtYXJrVHJpYWxBc1VzZWQiLCJ1cGRhdGUiLCJpc191c2VkIiwicHJldiIsInRyYWNrTWVtYmVyc2hpcFVzYWdlIiwiYmVuZWZpdFR5cGUiLCJzZXJ2aWNlVHlwZSIsImRpc2NvdW50QXBwbGllZCIsImFtb3VudFNhdmVkIiwiaW5zZXJ0IiwidXNlcl9pZCIsInN1YnNjcmlwdGlvbl9pZCIsImJlbmVmaXRfdHlwZSIsInNlcnZpY2VfdHlwZSIsImRpc2NvdW50X2FwcGxpZWQiLCJhbW91bnRfc2F2ZWQiLCJ0cmFja0ZlYXR1cmVVc2FnZSIsImZlYXR1cmUiLCJjYW5Vc2VGZWF0dXJlIiwidG9kYXkiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImN1cnJlbnRNb250aCIsInN1YnN0cmluZyIsInVwZGF0ZWRVc2FnZSIsImRhaWx5TWF0Y2hlc1VzZWQiLCJtb250aGx5TWVzc2FnZXNVc2VkIiwibGFzdFJlc2V0RGF0ZSIsInByZW1pdW1FdmVudHNVc2VkIiwibGl2ZXN0cmVhbUhvdXJzVXNlZCIsInVwc2VydCIsInZhbGlkYXRlU3R1ZGVudFN0YXR1cyIsInN0dWRlbnRFbWFpbCIsInVuaXZlcnNpdHlJZCIsImlzVmFsaWQiLCJ1c2FnZUxpbWl0cyIsImhhc1VubGltaXRlZEFjY2VzcyIsImRhaWx5UmVzZXQiLCJtb250aGx5UmVzZXQiLCJkYWlseU1hdGNoZXMiLCJtb250aGx5TWVzc2FnZXMiLCJwcmVtaXVtRXZlbnRzIiwibGl2ZXN0cmVhbUhvdXJzIiwiaGFzQWN0aXZlU3Vic2NyaXB0aW9uIiwiQm9vbGVhbiIsInN0YXR1cyIsImN1cnJlbnRfcGVyaW9kX2VuZCIsImlzSW5UcmlhbCIsInRyaWFsX2VuZCIsInRyaWFsRGF5c1JlbWFpbmluZyIsIk1hdGgiLCJtYXgiLCJjZWlsIiwiZ2V0VGltZSIsInN1YnNjcmlwdGlvblJlcXVpcmVkIiwibWVtYmVyc2hpcFRpZXIiLCJlZmZlY3RpdmVUaWVyIiwic2VydmljZURpc2NvdW50IiwiY2FuU2VuZE1lc3NhZ2UiLCJjYW5DcmVhdGVNYXRjaCIsImNhbkFjY2Vzc1ByZW1pdW1FdmVudCIsImNhbkFjY2Vzc0xpdmVzdHJlYW0iLCJnZXRSZW1haW5pbmdNYXRjaGVzIiwiZGFpbHlVc2VkIiwiZ2V0UmVtYWluaW5nTWVzc2FnZXMiLCJtb250aGx5VXNlZCIsInZhbHVlIiwiUHJvdmlkZXIiLCJjb250ZXh0IiwidXNlQ29udGV4dCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7OztJQWlHZ0JBLG9CQUFvQjtlQUFwQkE7O0lBMmlCQUMsZUFBZTtlQUFmQTs7OzsrREExb0JpRTswQkFDOUM7aUNBQ1A7c0JBQ0E7MEJBQ0g7c0VBQ1A7d0JBQ0s7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXZCLG9EQUFvRDtBQUNwRCxNQUFNQyxnQkFBZ0JDLElBQUFBLG9CQUFVLEVBQUNDLFFBQVFDLEdBQUcsQ0FBQ0Msa0NBQWtDLElBQUk7QUFnRm5GLE1BQU1DLG9DQUFzQkMsSUFBQUEsb0JBQWEsRUFBc0NDO0FBTXhFLFNBQVNULHFCQUFxQixFQUFFVSxRQUFRLEVBQTZCO0lBQzFFLE1BQU0sRUFBRUMsUUFBUSxFQUFFQyxDQUFDLEVBQUUsR0FBR0MsSUFBQUEsNEJBQVc7SUFDbkMsTUFBTSxDQUFDQyxjQUFjQyxnQkFBZ0IsR0FBR0MsSUFBQUEsZUFBUSxFQUFzQjtJQUN0RSxNQUFNLENBQUNDLE9BQU9DLFNBQVMsR0FBR0YsSUFBQUEsZUFBUSxFQUEyQjtJQUM3RCxNQUFNLENBQUNHLE9BQU9DLFNBQVMsR0FBR0osSUFBQUEsZUFBUSxFQUEyQjtJQUM3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