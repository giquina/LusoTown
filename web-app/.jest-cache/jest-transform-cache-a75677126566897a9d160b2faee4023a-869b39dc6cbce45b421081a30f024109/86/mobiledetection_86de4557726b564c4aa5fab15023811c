6269c4f547b29793da7e56f512720737
/**
 * Mobile Device Detection and App Installation Detection
 * 
 * Comprehensive mobile device detection system for LusoTown's Portuguese-speaking community,
 * including app installation detection, deep link testing, and analytics tracking.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    MobileDeviceDetector: function() {
        return MobileDeviceDetector;
    },
    checkAppInstallation: function() {
        return checkAppInstallation;
    },
    default: function() {
        return _default;
    },
    getAppStoreUrl: function() {
        return getAppStoreUrl;
    },
    getDeviceInfo: function() {
        return getDeviceInfo;
    },
    mobileDetector: function() {
        return mobileDetector;
    },
    shouldShowDownloadPrompt: function() {
        return shouldShowDownloadPrompt;
    },
    trackDownloadChoice: function() {
        return trackDownloadChoice;
    }
});
const _mobileapp = require("../config/mobile-app");
class MobileDeviceDetector {
    constructor(){
        this.deviceInfo = null;
        this.installationStatus = null;
    }
    static getInstance() {
        if (!MobileDeviceDetector.instance) {
            MobileDeviceDetector.instance = new MobileDeviceDetector();
        }
        return MobileDeviceDetector.instance;
    }
    /**
   * Get comprehensive device information
   */ getDeviceInfo() {
        if (typeof window === "undefined") {
            // Server-side rendering fallback
            return {
                isMobile: false,
                isTablet: false,
                isDesktop: true,
                isIOS: false,
                isAndroid: false,
                userAgent: "",
                viewport: {
                    width: 1024,
                    height: 768
                },
                touchSupport: false
            };
        }
        if (this.deviceInfo) {
            return this.deviceInfo;
        }
        const userAgent = navigator.userAgent;
        const viewport = {
            width: window.innerWidth,
            height: window.innerHeight
        };
        // Detect device types using user agent patterns
        const isIOS = this.matchesAnyPattern(userAgent, _mobileapp.DEVICE_DETECTION_CONFIG.userAgentPatterns.ios);
        const isAndroid = this.matchesAnyPattern(userAgent, _mobileapp.DEVICE_DETECTION_CONFIG.userAgentPatterns.android);
        const isMobileUA = this.matchesAnyPattern(userAgent, _mobileapp.DEVICE_DETECTION_CONFIG.userAgentPatterns.mobile);
        const isTabletUA = this.matchesAnyPattern(userAgent, _mobileapp.DEVICE_DETECTION_CONFIG.userAgentPatterns.tablet);
        // Viewport-based detection for more accuracy
        const isMobileViewport = viewport.width < _mobileapp.DEVICE_DETECTION_CONFIG.viewportBreakpoints.mobile;
        const isTabletViewport = viewport.width >= _mobileapp.DEVICE_DETECTION_CONFIG.viewportBreakpoints.mobile && viewport.width < _mobileapp.DEVICE_DETECTION_CONFIG.viewportBreakpoints.desktop;
        // Combine user agent and viewport detection
        const isMobile = (isMobileUA || isMobileViewport) && !isTabletUA;
        const isTablet = isTabletUA || isTabletViewport && !isMobileUA;
        const isDesktop = !isMobile && !isTablet;
        // Touch support detection
        const touchSupport = "ontouchstart" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
        this.deviceInfo = {
            isMobile,
            isTablet,
            isDesktop,
            isIOS,
            isAndroid,
            userAgent,
            viewport,
            touchSupport
        };
        return this.deviceInfo;
    }
    /**
   * Check if native app is installed using deep link testing
   */ async checkAppInstallation() {
        if (typeof window === "undefined") {
            return {
                isInstalled: false,
                platform: "unknown",
                canInstallPWA: false,
                installPromptAvailable: false,
                lastChecked: Date.now()
            };
        }
        const deviceInfo = this.getDeviceInfo();
        const platform = deviceInfo.isIOS ? "ios" : deviceInfo.isAndroid ? "android" : "unknown";
        // Check if we've recently tested (cache for 5 minutes)
        if (this.installationStatus && Date.now() - this.installationStatus.lastChecked < 300000) {
            return this.installationStatus;
        }
        let isInstalled = false;
        try {
            // Test deep link support
            if (platform === "ios") {
                isInstalled = await this.testIOSDeepLink();
            } else if (platform === "android") {
                isInstalled = await this.testAndroidDeepLink();
            }
        } catch (error) {
            console.log("Deep link test failed:", error);
            isInstalled = false;
        }
        // Check PWA installation capability
        const canInstallPWA = this.canInstallPWA();
        const installPromptAvailable = window.deferredPrompt !== undefined;
        this.installationStatus = {
            isInstalled,
            platform,
            canInstallPWA,
            installPromptAvailable,
            lastChecked: Date.now()
        };
        return this.installationStatus;
    }
    /**
   * Test iOS deep link support
   */ async testIOSDeepLink() {
        return new Promise((resolve)=>{
            const timeout = setTimeout(()=>resolve(false), 2000);
            const deepLinkUrl = `${_mobileapp.MOBILE_APP_CONFIG.deepLink.scheme}://open?utm_source=web_app_detection`;
            // Try to open the deep link
            window.location.href = deepLinkUrl;
            // If we can navigate back quickly, the app likely isn't installed
            const startTime = Date.now();
            const checkFocus = ()=>{
                if (Date.now() - startTime > 1500) {
                    clearTimeout(timeout);
                    resolve(true); // App likely opened
                } else {
                    setTimeout(checkFocus, 500);
                }
            };
            document.addEventListener("visibilitychange", ()=>{
                if (document.hidden) {
                    clearTimeout(timeout);
                    resolve(true); // App opened, page became hidden
                }
            });
            checkFocus();
        });
    }
    /**
   * Test Android deep link support
   */ async testAndroidDeepLink() {
        return new Promise((resolve)=>{
            const timeout = setTimeout(()=>resolve(false), 2000);
            const intentUrl = `intent://${_mobileapp.MOBILE_APP_CONFIG.deepLink.scheme}://open#Intent;scheme=${_mobileapp.MOBILE_APP_CONFIG.deepLink.scheme};package=${_mobileapp.MOBILE_APP_CONFIG.stores.android.id};end`;
            try {
                window.location.href = intentUrl;
                // Android intent URLs will fail if app isn't installed
                setTimeout(()=>{
                    clearTimeout(timeout);
                    resolve(true);
                }, 1000);
            } catch (error) {
                clearTimeout(timeout);
                resolve(false);
            }
        });
    }
    /**
   * Check if PWA can be installed
   */ canInstallPWA() {
        if (typeof window === "undefined") return false;
        // Check for beforeinstallprompt event support
        if ("serviceWorker" in navigator && window.beforeinstallprompt !== undefined) {
            return true;
        }
        // Check for iOS Safari PWA support
        const deviceInfo = this.getDeviceInfo();
        if (deviceInfo.isIOS && "standalone" in navigator) {
            return true;
        }
        return false;
    }
    /**
   * Track user's choice for app download
   */ trackDownloadChoice(choice, platform) {
        const deviceInfo = this.getDeviceInfo();
        // Store choice in localStorage for returning user logic
        const choiceData = {
            choice,
            platform: platform || (deviceInfo.isIOS ? "ios" : deviceInfo.isAndroid ? "android" : "web"),
            timestamp: Date.now(),
            userAgent: deviceInfo.userAgent,
            viewport: deviceInfo.viewport
        };
        try {
            localStorage.setItem("lusotown_app_choice", JSON.stringify(choiceData));
            // Send analytics event (if analytics is configured)
            this.sendAnalyticsEvent("app_download_choice", choiceData);
        } catch (error) {
            console.warn("Could not store app choice:", error);
        }
    }
    /**
   * Check if user has previously made a download choice
   */ getPreviousDownloadChoice() {
        try {
            const stored = localStorage.getItem("lusotown_app_choice");
            if (stored) {
                const choice = JSON.parse(stored);
                // Check if choice is less than 7 days old
                if (Date.now() - choice.timestamp < 7 * 24 * 60 * 60 * 1000) {
                    return choice;
                }
            }
        } catch (error) {
            console.warn("Could not retrieve app choice:", error);
        }
        return null;
    }
    /**
   * Should show app download prompt
   */ shouldShowDownloadPrompt() {
        const deviceInfo = this.getDeviceInfo();
        const previousChoice = this.getPreviousDownloadChoice();
        // Don't show on desktop
        if (deviceInfo.isDesktop) return false;
        // Don't show if user recently declined
        if (previousChoice && previousChoice.choice === "continue_web") {
            return false;
        }
        // Don't show if user recently downloaded
        if (previousChoice && previousChoice.choice === "download_app") {
            return false;
        }
        return true;
    }
    /**
   * Get appropriate app store URL for the device
   */ getAppStoreUrl() {
        const deviceInfo = this.getDeviceInfo();
        if (deviceInfo.isIOS) {
            return _mobileapp.MOBILE_APP_CONFIG.stores.ios.url;
        } else if (deviceInfo.isAndroid) {
            return _mobileapp.MOBILE_APP_CONFIG.stores.android.url;
        }
        // Default to Play Store for unknown mobile devices
        return _mobileapp.MOBILE_APP_CONFIG.stores.android.url;
    }
    /**
   * Get appropriate app store scheme URL for native opening
   */ getAppStoreSchemeUrl() {
        const deviceInfo = this.getDeviceInfo();
        if (deviceInfo.isIOS) {
            return _mobileapp.MOBILE_APP_CONFIG.stores.ios.scheme;
        } else if (deviceInfo.isAndroid) {
            return _mobileapp.MOBILE_APP_CONFIG.stores.android.scheme;
        }
        return _mobileapp.MOBILE_APP_CONFIG.stores.android.scheme;
    }
    /**
   * Send analytics event for mobile app interactions
   */ sendAnalyticsEvent(eventName, data) {
        // Placeholder for analytics implementation
        // This would integrate with your analytics service (Google Analytics, Mixpanel, etc.)
        if (typeof window !== "undefined" && window.gtag) {
            window.gtag("event", eventName, {
                event_category: "mobile_app",
                event_label: "portuguese_community",
                custom_parameters: data
            });
        }
        console.log(`Analytics: ${eventName}`, data);
    }
    /**
   * Helper method to test user agent patterns
   */ matchesAnyPattern(userAgent, patterns) {
        return patterns.some((pattern)=>pattern.test(userAgent));
    }
    /**
   * Reset cached data (useful for testing)
   */ resetCache() {
        this.deviceInfo = null;
        this.installationStatus = null;
    }
}
const mobileDetector = MobileDeviceDetector.getInstance();
const getDeviceInfo = ()=>{
    return mobileDetector.getDeviceInfo();
};
const checkAppInstallation = async ()=>{
    return await mobileDetector.checkAppInstallation();
};
const shouldShowDownloadPrompt = ()=>{
    return mobileDetector.shouldShowDownloadPrompt();
};
const getAppStoreUrl = ()=>{
    return mobileDetector.getAppStoreUrl();
};
const trackDownloadChoice = (choice, platform)=>{
    return mobileDetector.trackDownloadChoice(choice, platform);
};
const _default = MobileDeviceDetector;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL0x1c29Ub3duL3dlYi1hcHAvc3JjL2xpYi9tb2JpbGUtZGV0ZWN0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9iaWxlIERldmljZSBEZXRlY3Rpb24gYW5kIEFwcCBJbnN0YWxsYXRpb24gRGV0ZWN0aW9uXG4gKiBcbiAqIENvbXByZWhlbnNpdmUgbW9iaWxlIGRldmljZSBkZXRlY3Rpb24gc3lzdGVtIGZvciBMdXNvVG93bidzIFBvcnR1Z3Vlc2Utc3BlYWtpbmcgY29tbXVuaXR5LFxuICogaW5jbHVkaW5nIGFwcCBpbnN0YWxsYXRpb24gZGV0ZWN0aW9uLCBkZWVwIGxpbmsgdGVzdGluZywgYW5kIGFuYWx5dGljcyB0cmFja2luZy5cbiAqL1xuXG5pbXBvcnQgeyBERVZJQ0VfREVURUNUSU9OX0NPTkZJRywgTU9CSUxFX0FQUF9DT05GSUcgfSBmcm9tICdAL2NvbmZpZy9tb2JpbGUtYXBwJztcblxuZXhwb3J0IGludGVyZmFjZSBEZXZpY2VJbmZvIHtcbiAgaXNNb2JpbGU6IGJvb2xlYW47XG4gIGlzVGFibGV0OiBib29sZWFuO1xuICBpc0Rlc2t0b3A6IGJvb2xlYW47XG4gIGlzSU9TOiBib29sZWFuO1xuICBpc0FuZHJvaWQ6IGJvb2xlYW47XG4gIHVzZXJBZ2VudDogc3RyaW5nO1xuICB2aWV3cG9ydDoge1xuICAgIHdpZHRoOiBudW1iZXI7XG4gICAgaGVpZ2h0OiBudW1iZXI7XG4gIH07XG4gIHRvdWNoU3VwcG9ydDogYm9vbGVhbjtcbiAgYXBwSW5zdGFsbGVkPzogYm9vbGVhbjtcbiAgZGVlcExpbmtTdXBwb3J0PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBJbnN0YWxsYXRpb25TdGF0dXMge1xuICBpc0luc3RhbGxlZDogYm9vbGVhbjtcbiAgcGxhdGZvcm06ICdpb3MnIHwgJ2FuZHJvaWQnIHwgJ3Vua25vd24nO1xuICBjYW5JbnN0YWxsUFdBOiBib29sZWFuO1xuICBpbnN0YWxsUHJvbXB0QXZhaWxhYmxlOiBib29sZWFuO1xuICBsYXN0Q2hlY2tlZDogbnVtYmVyO1xufVxuXG4vKipcbiAqIE1vYmlsZSBEZXZpY2UgRGV0ZWN0aW9uIENsYXNzXG4gKiBQcm92aWRlcyBjb21wcmVoZW5zaXZlIGRldmljZSBkZXRlY3Rpb24gZm9yIFBvcnR1Z3Vlc2Utc3BlYWtpbmcgY29tbXVuaXR5IG1lbWJlcnNcbiAqL1xuZXhwb3J0IGNsYXNzIE1vYmlsZURldmljZURldGVjdG9yIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IE1vYmlsZURldmljZURldGVjdG9yO1xuICBwcml2YXRlIGRldmljZUluZm86IERldmljZUluZm8gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpbnN0YWxsYXRpb25TdGF0dXM6IEFwcEluc3RhbGxhdGlvblN0YXR1cyB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogTW9iaWxlRGV2aWNlRGV0ZWN0b3Ige1xuICAgIGlmICghTW9iaWxlRGV2aWNlRGV0ZWN0b3IuaW5zdGFuY2UpIHtcbiAgICAgIE1vYmlsZURldmljZURldGVjdG9yLmluc3RhbmNlID0gbmV3IE1vYmlsZURldmljZURldGVjdG9yKCk7XG4gICAgfVxuICAgIHJldHVybiBNb2JpbGVEZXZpY2VEZXRlY3Rvci5pbnN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY29tcHJlaGVuc2l2ZSBkZXZpY2UgaW5mb3JtYXRpb25cbiAgICovXG4gIHB1YmxpYyBnZXREZXZpY2VJbmZvKCk6IERldmljZUluZm8ge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gU2VydmVyLXNpZGUgcmVuZGVyaW5nIGZhbGxiYWNrXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc01vYmlsZTogZmFsc2UsXG4gICAgICAgIGlzVGFibGV0OiBmYWxzZSxcbiAgICAgICAgaXNEZXNrdG9wOiB0cnVlLFxuICAgICAgICBpc0lPUzogZmFsc2UsXG4gICAgICAgIGlzQW5kcm9pZDogZmFsc2UsXG4gICAgICAgIHVzZXJBZ2VudDogJycsXG4gICAgICAgIHZpZXdwb3J0OiB7IHdpZHRoOiAxMDI0LCBoZWlnaHQ6IDc2OCB9LFxuICAgICAgICB0b3VjaFN1cHBvcnQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRldmljZUluZm8pIHtcbiAgICAgIHJldHVybiB0aGlzLmRldmljZUluZm87XG4gICAgfVxuXG4gICAgY29uc3QgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICBjb25zdCB2aWV3cG9ydCA9IHtcbiAgICAgIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0XG4gICAgfTtcblxuICAgIC8vIERldGVjdCBkZXZpY2UgdHlwZXMgdXNpbmcgdXNlciBhZ2VudCBwYXR0ZXJuc1xuICAgIGNvbnN0IGlzSU9TID0gdGhpcy5tYXRjaGVzQW55UGF0dGVybih1c2VyQWdlbnQsIERFVklDRV9ERVRFQ1RJT05fQ09ORklHLnVzZXJBZ2VudFBhdHRlcm5zLmlvcyk7XG4gICAgY29uc3QgaXNBbmRyb2lkID0gdGhpcy5tYXRjaGVzQW55UGF0dGVybih1c2VyQWdlbnQsIERFVklDRV9ERVRFQ1RJT05fQ09ORklHLnVzZXJBZ2VudFBhdHRlcm5zLmFuZHJvaWQpO1xuICAgIGNvbnN0IGlzTW9iaWxlVUEgPSB0aGlzLm1hdGNoZXNBbnlQYXR0ZXJuKHVzZXJBZ2VudCwgREVWSUNFX0RFVEVDVElPTl9DT05GSUcudXNlckFnZW50UGF0dGVybnMubW9iaWxlKTtcbiAgICBjb25zdCBpc1RhYmxldFVBID0gdGhpcy5tYXRjaGVzQW55UGF0dGVybih1c2VyQWdlbnQsIERFVklDRV9ERVRFQ1RJT05fQ09ORklHLnVzZXJBZ2VudFBhdHRlcm5zLnRhYmxldCk7XG5cbiAgICAvLyBWaWV3cG9ydC1iYXNlZCBkZXRlY3Rpb24gZm9yIG1vcmUgYWNjdXJhY3lcbiAgICBjb25zdCBpc01vYmlsZVZpZXdwb3J0ID0gdmlld3BvcnQud2lkdGggPCBERVZJQ0VfREVURUNUSU9OX0NPTkZJRy52aWV3cG9ydEJyZWFrcG9pbnRzLm1vYmlsZTtcbiAgICBjb25zdCBpc1RhYmxldFZpZXdwb3J0ID0gdmlld3BvcnQud2lkdGggPj0gREVWSUNFX0RFVEVDVElPTl9DT05GSUcudmlld3BvcnRCcmVha3BvaW50cy5tb2JpbGUgJiYgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydC53aWR0aCA8IERFVklDRV9ERVRFQ1RJT05fQ09ORklHLnZpZXdwb3J0QnJlYWtwb2ludHMuZGVza3RvcDtcblxuICAgIC8vIENvbWJpbmUgdXNlciBhZ2VudCBhbmQgdmlld3BvcnQgZGV0ZWN0aW9uXG4gICAgY29uc3QgaXNNb2JpbGUgPSAoaXNNb2JpbGVVQSB8fCBpc01vYmlsZVZpZXdwb3J0KSAmJiAhaXNUYWJsZXRVQTtcbiAgICBjb25zdCBpc1RhYmxldCA9IGlzVGFibGV0VUEgfHwgKGlzVGFibGV0Vmlld3BvcnQgJiYgIWlzTW9iaWxlVUEpO1xuICAgIGNvbnN0IGlzRGVza3RvcCA9ICFpc01vYmlsZSAmJiAhaXNUYWJsZXQ7XG5cbiAgICAvLyBUb3VjaCBzdXBwb3J0IGRldGVjdGlvblxuICAgIGNvbnN0IHRvdWNoU3VwcG9ydCA9ICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDAgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAobmF2aWdhdG9yIGFzIGFueSkubXNNYXhUb3VjaFBvaW50cyA+IDA7XG5cbiAgICB0aGlzLmRldmljZUluZm8gPSB7XG4gICAgICBpc01vYmlsZSxcbiAgICAgIGlzVGFibGV0LFxuICAgICAgaXNEZXNrdG9wLFxuICAgICAgaXNJT1MsXG4gICAgICBpc0FuZHJvaWQsXG4gICAgICB1c2VyQWdlbnQsXG4gICAgICB2aWV3cG9ydCxcbiAgICAgIHRvdWNoU3VwcG9ydFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5kZXZpY2VJbmZvO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIG5hdGl2ZSBhcHAgaXMgaW5zdGFsbGVkIHVzaW5nIGRlZXAgbGluayB0ZXN0aW5nXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgY2hlY2tBcHBJbnN0YWxsYXRpb24oKTogUHJvbWlzZTxBcHBJbnN0YWxsYXRpb25TdGF0dXM+IHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzSW5zdGFsbGVkOiBmYWxzZSxcbiAgICAgICAgcGxhdGZvcm06ICd1bmtub3duJyxcbiAgICAgICAgY2FuSW5zdGFsbFBXQTogZmFsc2UsXG4gICAgICAgIGluc3RhbGxQcm9tcHRBdmFpbGFibGU6IGZhbHNlLFxuICAgICAgICBsYXN0Q2hlY2tlZDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBkZXZpY2VJbmZvID0gdGhpcy5nZXREZXZpY2VJbmZvKCk7XG4gICAgY29uc3QgcGxhdGZvcm0gPSBkZXZpY2VJbmZvLmlzSU9TID8gJ2lvcycgOiBkZXZpY2VJbmZvLmlzQW5kcm9pZCA/ICdhbmRyb2lkJyA6ICd1bmtub3duJztcblxuICAgIC8vIENoZWNrIGlmIHdlJ3ZlIHJlY2VudGx5IHRlc3RlZCAoY2FjaGUgZm9yIDUgbWludXRlcylcbiAgICBpZiAodGhpcy5pbnN0YWxsYXRpb25TdGF0dXMgJiYgXG4gICAgICAgIERhdGUubm93KCkgLSB0aGlzLmluc3RhbGxhdGlvblN0YXR1cy5sYXN0Q2hlY2tlZCA8IDMwMDAwMCkge1xuICAgICAgcmV0dXJuIHRoaXMuaW5zdGFsbGF0aW9uU3RhdHVzO1xuICAgIH1cblxuICAgIGxldCBpc0luc3RhbGxlZCA9IGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRlc3QgZGVlcCBsaW5rIHN1cHBvcnRcbiAgICAgIGlmIChwbGF0Zm9ybSA9PT0gJ2lvcycpIHtcbiAgICAgICAgaXNJbnN0YWxsZWQgPSBhd2FpdCB0aGlzLnRlc3RJT1NEZWVwTGluaygpO1xuICAgICAgfSBlbHNlIGlmIChwbGF0Zm9ybSA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgIGlzSW5zdGFsbGVkID0gYXdhaXQgdGhpcy50ZXN0QW5kcm9pZERlZXBMaW5rKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdEZWVwIGxpbmsgdGVzdCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgaXNJbnN0YWxsZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBQV0EgaW5zdGFsbGF0aW9uIGNhcGFiaWxpdHlcbiAgICBjb25zdCBjYW5JbnN0YWxsUFdBID0gdGhpcy5jYW5JbnN0YWxsUFdBKCk7XG4gICAgY29uc3QgaW5zdGFsbFByb21wdEF2YWlsYWJsZSA9ICh3aW5kb3cgYXMgYW55KS5kZWZlcnJlZFByb21wdCAhPT0gdW5kZWZpbmVkO1xuXG4gICAgdGhpcy5pbnN0YWxsYXRpb25TdGF0dXMgPSB7XG4gICAgICBpc0luc3RhbGxlZCxcbiAgICAgIHBsYXRmb3JtLFxuICAgICAgY2FuSW5zdGFsbFBXQSxcbiAgICAgIGluc3RhbGxQcm9tcHRBdmFpbGFibGUsXG4gICAgICBsYXN0Q2hlY2tlZDogRGF0ZS5ub3coKVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5pbnN0YWxsYXRpb25TdGF0dXM7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBpT1MgZGVlcCBsaW5rIHN1cHBvcnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdGVzdElPU0RlZXBMaW5rKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZShmYWxzZSksIDIwMDApO1xuICAgICAgXG4gICAgICBjb25zdCBkZWVwTGlua1VybCA9IGAke01PQklMRV9BUFBfQ09ORklHLmRlZXBMaW5rLnNjaGVtZX06Ly9vcGVuP3V0bV9zb3VyY2U9d2ViX2FwcF9kZXRlY3Rpb25gO1xuICAgICAgXG4gICAgICAvLyBUcnkgdG8gb3BlbiB0aGUgZGVlcCBsaW5rXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGRlZXBMaW5rVXJsO1xuICAgICAgXG4gICAgICAvLyBJZiB3ZSBjYW4gbmF2aWdhdGUgYmFjayBxdWlja2x5LCB0aGUgYXBwIGxpa2VseSBpc24ndCBpbnN0YWxsZWRcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCBjaGVja0ZvY3VzID0gKCkgPT4ge1xuICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSA+IDE1MDApIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTsgLy8gQXBwIGxpa2VseSBvcGVuZWRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGNoZWNrRm9jdXMsIDUwMCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTsgLy8gQXBwIG9wZW5lZCwgcGFnZSBiZWNhbWUgaGlkZGVuXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjaGVja0ZvY3VzKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBBbmRyb2lkIGRlZXAgbGluayBzdXBwb3J0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHRlc3RBbmRyb2lkRGVlcExpbmsoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKGZhbHNlKSwgMjAwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGludGVudFVybCA9IGBpbnRlbnQ6Ly8ke01PQklMRV9BUFBfQ09ORklHLmRlZXBMaW5rLnNjaGVtZX06Ly9vcGVuI0ludGVudDtzY2hlbWU9JHtNT0JJTEVfQVBQX0NPTkZJRy5kZWVwTGluay5zY2hlbWV9O3BhY2thZ2U9JHtNT0JJTEVfQVBQX0NPTkZJRy5zdG9yZXMuYW5kcm9pZC5pZH07ZW5kYDtcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBpbnRlbnRVcmw7XG4gICAgICAgIFxuICAgICAgICAvLyBBbmRyb2lkIGludGVudCBVUkxzIHdpbGwgZmFpbCBpZiBhcHAgaXNuJ3QgaW5zdGFsbGVkXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIFBXQSBjYW4gYmUgaW5zdGFsbGVkXG4gICAqL1xuICBwcml2YXRlIGNhbkluc3RhbGxQV0EoKTogYm9vbGVhbiB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gZmFsc2U7XG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIGJlZm9yZWluc3RhbGxwcm9tcHQgZXZlbnQgc3VwcG9ydFxuICAgIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICh3aW5kb3cgYXMgYW55KS5iZWZvcmVpbnN0YWxscHJvbXB0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3IgaU9TIFNhZmFyaSBQV0Egc3VwcG9ydFxuICAgIGNvbnN0IGRldmljZUluZm8gPSB0aGlzLmdldERldmljZUluZm8oKTtcbiAgICBpZiAoZGV2aWNlSW5mby5pc0lPUyAmJiAnc3RhbmRhbG9uZScgaW4gKG5hdmlnYXRvciBhcyBhbnkpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYWNrIHVzZXIncyBjaG9pY2UgZm9yIGFwcCBkb3dubG9hZFxuICAgKi9cbiAgcHVibGljIHRyYWNrRG93bmxvYWRDaG9pY2UoY2hvaWNlOiAnZG93bmxvYWRfYXBwJyB8ICdjb250aW51ZV93ZWInIHwgJ2luc3RhbGxfcHdhJywgcGxhdGZvcm0/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBkZXZpY2VJbmZvID0gdGhpcy5nZXREZXZpY2VJbmZvKCk7XG4gICAgXG4gICAgLy8gU3RvcmUgY2hvaWNlIGluIGxvY2FsU3RvcmFnZSBmb3IgcmV0dXJuaW5nIHVzZXIgbG9naWNcbiAgICBjb25zdCBjaG9pY2VEYXRhID0ge1xuICAgICAgY2hvaWNlLFxuICAgICAgcGxhdGZvcm06IHBsYXRmb3JtIHx8IChkZXZpY2VJbmZvLmlzSU9TID8gJ2lvcycgOiBkZXZpY2VJbmZvLmlzQW5kcm9pZCA/ICdhbmRyb2lkJyA6ICd3ZWInKSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIHVzZXJBZ2VudDogZGV2aWNlSW5mby51c2VyQWdlbnQsXG4gICAgICB2aWV3cG9ydDogZGV2aWNlSW5mby52aWV3cG9ydFxuICAgIH07XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsdXNvdG93bl9hcHBfY2hvaWNlJywgSlNPTi5zdHJpbmdpZnkoY2hvaWNlRGF0YSkpO1xuICAgICAgXG4gICAgICAvLyBTZW5kIGFuYWx5dGljcyBldmVudCAoaWYgYW5hbHl0aWNzIGlzIGNvbmZpZ3VyZWQpXG4gICAgICB0aGlzLnNlbmRBbmFseXRpY3NFdmVudCgnYXBwX2Rvd25sb2FkX2Nob2ljZScsIGNob2ljZURhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBzdG9yZSBhcHAgY2hvaWNlOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBoYXMgcHJldmlvdXNseSBtYWRlIGEgZG93bmxvYWQgY2hvaWNlXG4gICAqL1xuICBwdWJsaWMgZ2V0UHJldmlvdXNEb3dubG9hZENob2ljZSgpOiBhbnkgfCBudWxsIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2x1c290b3duX2FwcF9jaG9pY2UnKTtcbiAgICAgIGlmIChzdG9yZWQpIHtcbiAgICAgICAgY29uc3QgY2hvaWNlID0gSlNPTi5wYXJzZShzdG9yZWQpO1xuICAgICAgICAvLyBDaGVjayBpZiBjaG9pY2UgaXMgbGVzcyB0aGFuIDcgZGF5cyBvbGRcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBjaG9pY2UudGltZXN0YW1wIDwgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHtcbiAgICAgICAgICByZXR1cm4gY2hvaWNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHJldHJpZXZlIGFwcCBjaG9pY2U6JywgZXJyb3IpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG91bGQgc2hvdyBhcHAgZG93bmxvYWQgcHJvbXB0XG4gICAqL1xuICBwdWJsaWMgc2hvdWxkU2hvd0Rvd25sb2FkUHJvbXB0KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGRldmljZUluZm8gPSB0aGlzLmdldERldmljZUluZm8oKTtcbiAgICBjb25zdCBwcmV2aW91c0Nob2ljZSA9IHRoaXMuZ2V0UHJldmlvdXNEb3dubG9hZENob2ljZSgpO1xuICAgIFxuICAgIC8vIERvbid0IHNob3cgb24gZGVza3RvcFxuICAgIGlmIChkZXZpY2VJbmZvLmlzRGVza3RvcCkgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIC8vIERvbid0IHNob3cgaWYgdXNlciByZWNlbnRseSBkZWNsaW5lZFxuICAgIGlmIChwcmV2aW91c0Nob2ljZSAmJiBwcmV2aW91c0Nob2ljZS5jaG9pY2UgPT09ICdjb250aW51ZV93ZWInKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIERvbid0IHNob3cgaWYgdXNlciByZWNlbnRseSBkb3dubG9hZGVkXG4gICAgaWYgKHByZXZpb3VzQ2hvaWNlICYmIHByZXZpb3VzQ2hvaWNlLmNob2ljZSA9PT0gJ2Rvd25sb2FkX2FwcCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFwcHJvcHJpYXRlIGFwcCBzdG9yZSBVUkwgZm9yIHRoZSBkZXZpY2VcbiAgICovXG4gIHB1YmxpYyBnZXRBcHBTdG9yZVVybCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRldmljZUluZm8gPSB0aGlzLmdldERldmljZUluZm8oKTtcbiAgICBcbiAgICBpZiAoZGV2aWNlSW5mby5pc0lPUykge1xuICAgICAgcmV0dXJuIE1PQklMRV9BUFBfQ09ORklHLnN0b3Jlcy5pb3MudXJsO1xuICAgIH0gZWxzZSBpZiAoZGV2aWNlSW5mby5pc0FuZHJvaWQpIHtcbiAgICAgIHJldHVybiBNT0JJTEVfQVBQX0NPTkZJRy5zdG9yZXMuYW5kcm9pZC51cmw7XG4gICAgfVxuICAgIFxuICAgIC8vIERlZmF1bHQgdG8gUGxheSBTdG9yZSBmb3IgdW5rbm93biBtb2JpbGUgZGV2aWNlc1xuICAgIHJldHVybiBNT0JJTEVfQVBQX0NPTkZJRy5zdG9yZXMuYW5kcm9pZC51cmw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFwcHJvcHJpYXRlIGFwcCBzdG9yZSBzY2hlbWUgVVJMIGZvciBuYXRpdmUgb3BlbmluZ1xuICAgKi9cbiAgcHVibGljIGdldEFwcFN0b3JlU2NoZW1lVXJsKCk6IHN0cmluZyB7XG4gICAgY29uc3QgZGV2aWNlSW5mbyA9IHRoaXMuZ2V0RGV2aWNlSW5mbygpO1xuICAgIFxuICAgIGlmIChkZXZpY2VJbmZvLmlzSU9TKSB7XG4gICAgICByZXR1cm4gTU9CSUxFX0FQUF9DT05GSUcuc3RvcmVzLmlvcy5zY2hlbWU7XG4gICAgfSBlbHNlIGlmIChkZXZpY2VJbmZvLmlzQW5kcm9pZCkge1xuICAgICAgcmV0dXJuIE1PQklMRV9BUFBfQ09ORklHLnN0b3Jlcy5hbmRyb2lkLnNjaGVtZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE1PQklMRV9BUFBfQ09ORklHLnN0b3Jlcy5hbmRyb2lkLnNjaGVtZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGFuYWx5dGljcyBldmVudCBmb3IgbW9iaWxlIGFwcCBpbnRlcmFjdGlvbnNcbiAgICovXG4gIHByaXZhdGUgc2VuZEFuYWx5dGljc0V2ZW50KGV2ZW50TmFtZTogc3RyaW5nLCBkYXRhOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBQbGFjZWhvbGRlciBmb3IgYW5hbHl0aWNzIGltcGxlbWVudGF0aW9uXG4gICAgLy8gVGhpcyB3b3VsZCBpbnRlZ3JhdGUgd2l0aCB5b3VyIGFuYWx5dGljcyBzZXJ2aWNlIChHb29nbGUgQW5hbHl0aWNzLCBNaXhwYW5lbCwgZXRjLilcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgKHdpbmRvdyBhcyBhbnkpLmd0YWcpIHtcbiAgICAgICh3aW5kb3cgYXMgYW55KS5ndGFnKCdldmVudCcsIGV2ZW50TmFtZSwge1xuICAgICAgICBldmVudF9jYXRlZ29yeTogJ21vYmlsZV9hcHAnLFxuICAgICAgICBldmVudF9sYWJlbDogJ3BvcnR1Z3Vlc2VfY29tbXVuaXR5JyxcbiAgICAgICAgY3VzdG9tX3BhcmFtZXRlcnM6IGRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhgQW5hbHl0aWNzOiAke2V2ZW50TmFtZX1gLCBkYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIHRvIHRlc3QgdXNlciBhZ2VudCBwYXR0ZXJuc1xuICAgKi9cbiAgcHJpdmF0ZSBtYXRjaGVzQW55UGF0dGVybih1c2VyQWdlbnQ6IHN0cmluZywgcGF0dGVybnM6IFJlZ0V4cFtdKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QodXNlckFnZW50KSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgY2FjaGVkIGRhdGEgKHVzZWZ1bCBmb3IgdGVzdGluZylcbiAgICovXG4gIHB1YmxpYyByZXNldENhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMuZGV2aWNlSW5mbyA9IG51bGw7XG4gICAgdGhpcy5pbnN0YWxsYXRpb25TdGF0dXMgPSBudWxsO1xuICB9XG59XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBlYXN5IGFjY2Vzc1xuZXhwb3J0IGNvbnN0IG1vYmlsZURldGVjdG9yID0gTW9iaWxlRGV2aWNlRGV0ZWN0b3IuZ2V0SW5zdGFuY2UoKTtcblxuZXhwb3J0IGNvbnN0IGdldERldmljZUluZm8gPSAoKTogRGV2aWNlSW5mbyA9PiB7XG4gIHJldHVybiBtb2JpbGVEZXRlY3Rvci5nZXREZXZpY2VJbmZvKCk7XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tBcHBJbnN0YWxsYXRpb24gPSBhc3luYyAoKTogUHJvbWlzZTxBcHBJbnN0YWxsYXRpb25TdGF0dXM+ID0+IHtcbiAgcmV0dXJuIGF3YWl0IG1vYmlsZURldGVjdG9yLmNoZWNrQXBwSW5zdGFsbGF0aW9uKCk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2hvdWxkU2hvd0Rvd25sb2FkUHJvbXB0ID0gKCk6IGJvb2xlYW4gPT4ge1xuICByZXR1cm4gbW9iaWxlRGV0ZWN0b3Iuc2hvdWxkU2hvd0Rvd25sb2FkUHJvbXB0KCk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0QXBwU3RvcmVVcmwgPSAoKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIG1vYmlsZURldGVjdG9yLmdldEFwcFN0b3JlVXJsKCk7XG59O1xuXG5leHBvcnQgY29uc3QgdHJhY2tEb3dubG9hZENob2ljZSA9IChjaG9pY2U6ICdkb3dubG9hZF9hcHAnIHwgJ2NvbnRpbnVlX3dlYicgfCAnaW5zdGFsbF9wd2EnLCBwbGF0Zm9ybT86IHN0cmluZyk6IHZvaWQgPT4ge1xuICByZXR1cm4gbW9iaWxlRGV0ZWN0b3IudHJhY2tEb3dubG9hZENob2ljZShjaG9pY2UsIHBsYXRmb3JtKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IE1vYmlsZURldmljZURldGVjdG9yOyJdLCJuYW1lcyI6WyJNb2JpbGVEZXZpY2VEZXRlY3RvciIsImNoZWNrQXBwSW5zdGFsbGF0aW9uIiwiZ2V0QXBwU3RvcmVVcmwiLCJnZXREZXZpY2VJbmZvIiwibW9iaWxlRGV0ZWN0b3IiLCJzaG91bGRTaG93RG93bmxvYWRQcm9tcHQiLCJ0cmFja0Rvd25sb2FkQ2hvaWNlIiwiZGV2aWNlSW5mbyIsImluc3RhbGxhdGlvblN0YXR1cyIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJ3aW5kb3ciLCJpc01vYmlsZSIsImlzVGFibGV0IiwiaXNEZXNrdG9wIiwiaXNJT1MiLCJpc0FuZHJvaWQiLCJ1c2VyQWdlbnQiLCJ2aWV3cG9ydCIsIndpZHRoIiwiaGVpZ2h0IiwidG91Y2hTdXBwb3J0IiwibmF2aWdhdG9yIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwibWF0Y2hlc0FueVBhdHRlcm4iLCJERVZJQ0VfREVURUNUSU9OX0NPTkZJRyIsInVzZXJBZ2VudFBhdHRlcm5zIiwiaW9zIiwiYW5kcm9pZCIsImlzTW9iaWxlVUEiLCJtb2JpbGUiLCJpc1RhYmxldFVBIiwidGFibGV0IiwiaXNNb2JpbGVWaWV3cG9ydCIsInZpZXdwb3J0QnJlYWtwb2ludHMiLCJpc1RhYmxldFZpZXdwb3J0IiwiZGVza3RvcCIsIm1heFRvdWNoUG9pbnRzIiwibXNNYXhUb3VjaFBvaW50cyIsImlzSW5zdGFsbGVkIiwicGxhdGZvcm0iLCJjYW5JbnN0YWxsUFdBIiwiaW5zdGFsbFByb21wdEF2YWlsYWJsZSIsImxhc3RDaGVja2VkIiwiRGF0ZSIsIm5vdyIsInRlc3RJT1NEZWVwTGluayIsInRlc3RBbmRyb2lkRGVlcExpbmsiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJkZWZlcnJlZFByb21wdCIsInVuZGVmaW5lZCIsIlByb21pc2UiLCJyZXNvbHZlIiwidGltZW91dCIsInNldFRpbWVvdXQiLCJkZWVwTGlua1VybCIsIk1PQklMRV9BUFBfQ09ORklHIiwiZGVlcExpbmsiLCJzY2hlbWUiLCJsb2NhdGlvbiIsImhyZWYiLCJzdGFydFRpbWUiLCJjaGVja0ZvY3VzIiwiY2xlYXJUaW1lb3V0IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiaGlkZGVuIiwiaW50ZW50VXJsIiwic3RvcmVzIiwiaWQiLCJiZWZvcmVpbnN0YWxscHJvbXB0IiwiY2hvaWNlIiwiY2hvaWNlRGF0YSIsInRpbWVzdGFtcCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5Iiwic2VuZEFuYWx5dGljc0V2ZW50Iiwid2FybiIsImdldFByZXZpb3VzRG93bmxvYWRDaG9pY2UiLCJzdG9yZWQiLCJnZXRJdGVtIiwicGFyc2UiLCJwcmV2aW91c0Nob2ljZSIsInVybCIsImdldEFwcFN0b3JlU2NoZW1lVXJsIiwiZXZlbnROYW1lIiwiZGF0YSIsImd0YWciLCJldmVudF9jYXRlZ29yeSIsImV2ZW50X2xhYmVsIiwiY3VzdG9tX3BhcmFtZXRlcnMiLCJwYXR0ZXJucyIsInNvbWUiLCJwYXR0ZXJuIiwidGVzdCIsInJlc2V0Q2FjaGUiXSwibWFwcGluZ3MiOiJBQUFBOzs7OztDQUtDOzs7Ozs7Ozs7OztJQWdDWUEsb0JBQW9CO2VBQXBCQTs7SUEwVkFDLG9CQUFvQjtlQUFwQkE7O0lBZ0JiLE9BQW9DO2VBQXBDOztJQVJhQyxjQUFjO2VBQWRBOztJQVpBQyxhQUFhO2VBQWJBOztJQUZBQyxjQUFjO2VBQWRBOztJQVVBQyx3QkFBd0I7ZUFBeEJBOztJQVFBQyxtQkFBbUI7ZUFBbkJBOzs7MkJBcFk4QztBQThCcEQsTUFBTU47SUFLWCxhQUFzQjthQUhkTyxhQUFnQzthQUNoQ0MscUJBQW1EO0lBRXBDO0lBRXZCLE9BQWNDLGNBQW9DO1FBQ2hELElBQUksQ0FBQ1QscUJBQXFCVSxRQUFRLEVBQUU7WUFDbENWLHFCQUFxQlUsUUFBUSxHQUFHLElBQUlWO1FBQ3RDO1FBQ0EsT0FBT0EscUJBQXFCVSxRQUFRO0lBQ3RDO0lBRUE7O0dBRUMsR0FDRCxBQUFPUCxnQkFBNEI7UUFDakMsSUFBSSxPQUFPUSxXQUFXLGFBQWE7WUFDakMsaUNBQWlDO1lBQ2pDLE9BQU87Z0JBQ0xDLFVBQVU7Z0JBQ1ZDLFVBQVU7Z0JBQ1ZDLFdBQVc7Z0JBQ1hDLE9BQU87Z0JBQ1BDLFdBQVc7Z0JBQ1hDLFdBQVc7Z0JBQ1hDLFVBQVU7b0JBQUVDLE9BQU87b0JBQU1DLFFBQVE7Z0JBQUk7Z0JBQ3JDQyxjQUFjO1lBQ2hCO1FBQ0Y7UUFFQSxJQUFJLElBQUksQ0FBQ2QsVUFBVSxFQUFFO1lBQ25CLE9BQU8sSUFBSSxDQUFDQSxVQUFVO1FBQ3hCO1FBRUEsTUFBTVUsWUFBWUssVUFBVUwsU0FBUztRQUNyQyxNQUFNQyxXQUFXO1lBQ2ZDLE9BQU9SLE9BQU9ZLFVBQVU7WUFDeEJILFFBQVFULE9BQU9hLFdBQVc7UUFDNUI7UUFFQSxnREFBZ0Q7UUFDaEQsTUFBTVQsUUFBUSxJQUFJLENBQUNVLGlCQUFp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