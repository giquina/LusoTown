{"version":3,"sources":["/workspaces/LusoTown/web-app/src/components/VoiceMessagePlayer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Play,\n  Pause,\n  Volume2,\n  VolumeX,\n  Languages,\n  MoreVertical,\n  Download,\n  Flag,\n  Copy,\n  Repeat,\n  SkipForward,\n  SkipBack,\n  Settings,\n} from \"lucide-react\";\nimport { useLanguage } from \"@/context/LanguageContext\";\nimport {\n  VOICE_MESSAGE_UI,\n  PORTUGUESE_AUDIO_PREFERENCES,\n} from \"@/config/voice-messaging\";\nimport { PORTUGUESE_COLORS } from \"@/config/brand\";\n\ninterface VoiceMessage {\n  id: string;\n  audioUrl: string;\n  duration: number;\n  transcription?: string;\n  translation?: string;\n  senderName: string;\n  senderAvatar?: string;\n  timestamp: string;\n  dialect?: string;\n  confidence?: number;\n  isRead?: boolean;\n}\n\ninterface VoiceMessagePlayerProps {\n  message: VoiceMessage;\n  isOwn?: boolean;\n  showTranscription?: boolean;\n  showTranslation?: boolean;\n  onTranslate?: (messageId: string) => void;\n  onReport?: (messageId: string) => void;\n  onDownload?: (messageId: string) => void;\n  className?: string;\n}\n\nexport default function VoiceMessagePlayer({\n  message,\n  isOwn = false,\n  showTranscription = true,\n  showTranslation = true,\n  onTranslate,\n  onReport,\n  onDownload,\n  className = \"\",\n}: VoiceMessagePlayerProps) {\n  const { language } = useLanguage();\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [volume, setVolume] = useState(1);\n  const [isMuted, setIsMuted] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const progressRef = useRef<HTMLDivElement | null>(null);\n  const waveformRef = useRef<HTMLCanvasElement | null>(null);\n\n  const translations = {\n    en: {\n      play: \"Play voice message\",\n      pause: \"Pause voice message\",\n      mute: \"Mute\",\n      unmute: \"Unmute\",\n      transcription: \"Transcription\",\n      translation: \"Translation\",\n      translate: \"Translate to English\",\n      download: \"Download voice message\",\n      report: \"Report message\",\n      copy: \"Copy transcription\",\n      playbackSpeed: \"Playback speed\",\n      forward: \"Skip forward 10s\",\n      backward: \"Skip backward 10s\",\n      repeat: \"Repeat message\",\n      settings: \"Voice settings\",\n      errorLoading: \"Error loading voice message\",\n      noTranscription: \"Transcription not available\",\n      confidence: \"Transcription confidence\",\n    },\n    pt: {\n      play: \"Reproduzir mensagem de voz\",\n      pause: \"Pausar mensagem de voz\",\n      mute: \"Silenciar\",\n      unmute: \"Ativar som\",\n      transcription: \"TranscriÃ§Ã£o\",\n      translation: \"TraduÃ§Ã£o\",\n      translate: \"Traduzir para portuguÃªs\",\n      download: \"Descarregar mensagem\",\n      report: \"Reportar mensagem\",\n      copy: \"Copiar transcriÃ§Ã£o\",\n      playbackSpeed: \"Velocidade de reproduÃ§Ã£o\",\n      forward: \"AvanÃ§ar 10s\",\n      backward: \"Retroceder 10s\",\n      repeat: \"Repetir mensagem\",\n      settings: \"ConfiguraÃ§Ãµes de voz\",\n      errorLoading: \"Erro ao carregar mensagem de voz\",\n      noTranscription: \"TranscriÃ§Ã£o nÃ£o disponÃ­vel\",\n      confidence: \"ConfianÃ§a da transcriÃ§Ã£o\",\n    },\n  };\n\n  const t = translations[language];\n\n  // Initialize audio element\n  useEffect(() => {\n    if (message.audioUrl) {\n      const audio = new Audio(message.audioUrl);\n      audioRef.current = audio;\n\n      audio.addEventListener(\"loadedmetadata\", () => {\n        setError(null);\n      });\n\n      audio.addEventListener(\"timeupdate\", () => {\n        setCurrentTime(audio.currentTime);\n      });\n\n      audio.addEventListener(\"ended\", () => {\n        setIsPlaying(false);\n        setCurrentTime(0);\n      });\n\n      audio.addEventListener(\"error\", (e) => {\n        setError(t.errorLoading);\n        console.error(\"Audio loading error:\", e);\n      });\n\n      return () => {\n        audio.pause();\n        audio.remove();\n      };\n    }\n  }, [message.audioUrl, t.errorLoading]);\n\n  const drawWaveform = useCallback(() => {\n    const canvas = waveformRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const barWidth = 3;\n    const barGap = 1;\n    const numBars = Math.floor(width / (barWidth + barGap));\n\n    ctx.clearRect(0, 0, width, height);\n\n    // Generate pseudo-random waveform based on message ID\n    const seed = message.id\n      .split(\"\")\n      .reduce((acc, char) => acc + char.charCodeAt(0), 0);\n    const random = (seed: number) => {\n      const x = Math.sin(seed) * 10000;\n      return x - Math.floor(x);\n    };\n\n    // Draw waveform bars\n    for (let i = 0; i < numBars; i++) {\n      const barHeight = (random(seed + i) * 0.7 + 0.3) * height * 0.8;\n      const x = i * (barWidth + barGap);\n      const y = (height - barHeight) / 2;\n\n      // Progress color\n      const progress = currentTime / message.duration;\n      const isPlayed = i / numBars <= progress;\n\n      ctx.fillStyle = isPlayed\n        ? PORTUGUESE_COLORS.red[500]\n        : `${VOICE_MESSAGE_UI.waveformColor}40`; // 40% opacity\n\n      ctx.fillRect(x, y, barWidth, barHeight);\n    }\n  }, [currentTime, message.duration, message.id]);\n\n  // Draw waveform visualization\n  useEffect(() => {\n    if (waveformRef.current && message.audioUrl) {\n      drawWaveform();\n    }\n  }, [message.audioUrl, drawWaveform]);\n\n  const togglePlay = () => {\n    if (!audioRef.current) return;\n\n    if (isPlaying) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const toggleMute = () => {\n    if (!audioRef.current) return;\n\n    if (isMuted) {\n      audioRef.current.volume = volume;\n      setIsMuted(false);\n    } else {\n      audioRef.current.volume = 0;\n      setIsMuted(true);\n    }\n  };\n\n  const handleVolumeChange = (newVolume: number) => {\n    if (!audioRef.current) return;\n\n    setVolume(newVolume);\n    audioRef.current.volume = newVolume;\n    setIsMuted(newVolume === 0);\n  };\n\n  const handleSpeedChange = (speed: number) => {\n    if (!audioRef.current) return;\n\n    setPlaybackSpeed(speed);\n    audioRef.current.playbackRate = speed;\n  };\n\n  const skipForward = () => {\n    if (!audioRef.current) return;\n    audioRef.current.currentTime = Math.min(\n      audioRef.current.currentTime + 10,\n      message.duration\n    );\n  };\n\n  const skipBackward = () => {\n    if (!audioRef.current) return;\n    audioRef.current.currentTime = Math.max(\n      audioRef.current.currentTime - 10,\n      0\n    );\n  };\n\n  const handleProgressClick = (event: React.MouseEvent) => {\n    if (!audioRef.current || !progressRef.current) return;\n\n    const rect = progressRef.current.getBoundingClientRect();\n    const clickX = event.clientX - rect.left;\n    const percentage = clickX / rect.width;\n    const newTime = percentage * message.duration;\n\n    audioRef.current.currentTime = newTime;\n    setCurrentTime(newTime);\n  };\n\n  const copyTranscription = () => {\n    if (message.transcription) {\n      navigator.clipboard.writeText(message.transcription);\n    }\n  };\n\n  const formatTime = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const getDialectFlag = (dialect?: string): string => {\n    const flags: Record<string, string> = {\n      \"pt-PT\": \"ðŸ‡µðŸ‡¹\",\n      \"pt-BR\": \"ðŸ‡§ðŸ‡·\",\n      \"pt-CV\": \"ðŸ‡¨ðŸ‡»\",\n      \"pt-AO\": \"ðŸ‡¦ðŸ‡´\",\n      \"pt-MZ\": \"ðŸ‡²ðŸ‡¿\",\n    };\n    return flags[dialect || \"pt-PT\"] || \"ðŸ‡µðŸ‡¹\";\n  };\n\n  return (\n    <div className={`voice-message-player ${className}`}>\n      <div\n        className={`\n        flex items-start space-x-3 p-4 rounded-lg max-w-md\n        ${\n          isOwn\n            ? \"bg-primary-600 text-white ml-auto flex-row-reverse space-x-reverse\"\n            : \"bg-white border border-gray-200\"\n        }\n  `}\n        style={isOwn ? { backgroundColor: PORTUGUESE_COLORS.red[500] } : {}}\n      >\n        {/* User Avatar */}\n        {!isOwn && (\n          <img\n            src={message.senderAvatar || \"/images/default-avatar.png\"}\n            alt={message.senderName}\n            className=\"w-8 h-8 rounded-full object-cover flex-shrink-0\"\n          />\n        )}\n\n        <div className=\"flex-1 min-w-0\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"flex items-center space-x-2\">\n              {message.dialect && (\n                <span className=\"text-sm\">\n                  {getDialectFlag(message.dialect)}\n                </span>\n              )}\n              <span\n                className={`text-sm font-medium ${isOwn ? \"text-white\" : \"text-gray-900\"}`}\n              >\n                {isOwn ? \"You\" : message.senderName}\n              </span>\n            </div>\n\n            <div className=\"flex items-center space-x-1\">\n              <span\n                className={`text-xs ${isOwn ? \"text-white/70\" : \"text-gray-500\"}`}\n              >\n                {formatTime(message.duration)}\n              </span>\n\n              <div className=\"relative\">\n                <button\n                  onClick={() => setShowMenu(!showMenu)}\n                  className={`p-1 rounded-full hover:bg-black/10 ${isOwn ? \"text-white\" : \"text-gray-600\"}`}\n                >\n                  <MoreVertical className=\"w-4 h-4\" />\n                </button>\n\n                {/* Dropdown Menu */}\n                <AnimatePresence>\n                  {showMenu && (\n                    <motion.div\n                      initial={{ opacity: 0, scale: 0.95 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                      exit={{ opacity: 0, scale: 0.95 }}\n                      className=\"absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10\"\n                    >\n                      {onTranslate && (\n                        <button\n                          onClick={() => {\n                            onTranslate(message.id);\n                            setShowMenu(false);\n                          }}\n                          className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2\"\n                        >\n                          <Languages className=\"w-4 h-4\" />\n                          <span>{t.translate}</span>\n                        </button>\n                      )}\n\n                      {message.transcription && (\n                        <button\n                          onClick={() => {\n                            copyTranscription();\n                            setShowMenu(false);\n                          }}\n                          className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2\"\n                        >\n                          <Copy className=\"w-4 h-4\" />\n                          <span>{t.copy}</span>\n                        </button>\n                      )}\n\n                      {onDownload && (\n                        <button\n                          onClick={() => {\n                            onDownload(message.id);\n                            setShowMenu(false);\n                          }}\n                          className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2\"\n                        >\n                          <Download className=\"w-4 h-4\" />\n                          <span>{t.download}</span>\n                        </button>\n                      )}\n\n                      {onReport && !isOwn && (\n                        <button\n                          onClick={() => {\n                            onReport(message.id);\n                            setShowMenu(false);\n                          }}\n                          className=\"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2\"\n                        >\n                          <Flag className=\"w-4 h-4\" />\n                          <span>{t.report}</span>\n                        </button>\n                      )}\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </div>\n            </div>\n          </div>\n\n          {/* Audio Controls */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center space-x-3\">\n              {/* Play/Pause Button */}\n              <button\n                onClick={togglePlay}\n                disabled={!!error}\n                className={`\n                  w-8 h-8 rounded-full flex items-center justify-center transition-colors\n                  ${\n                    isOwn\n                      ? \"bg-white/20 hover:bg-white/30 text-white\"\n                      : \"bg-primary-100 hover:bg-primary-200 text-primary-700\"\n                  }\n                  ${error ? \"opacity-50 cursor-not-allowed\" : \"\"}\n                `}\n              >\n                {isPlaying ? (\n                  <Pause className=\"w-4 h-4\" />\n                ) : (\n                  <Play className=\"w-4 h-4 ml-0.5\" />\n                )}\n              </button>\n\n              {/* Waveform/Progress */}\n              <div className=\"flex-1 h-12 relative\">\n                <canvas\n                  ref={waveformRef}\n                  width={200}\n                  height={VOICE_MESSAGE_UI.waveformHeight}\n                  className=\"w-full h-full cursor-pointer rounded\"\n                  onClick={handleProgressClick}\n                />\n\n                {/* Progress overlay */}\n                <div\n                  ref={progressRef}\n                  className=\"absolute inset-0 cursor-pointer\"\n                  onClick={handleProgressClick}\n                />\n              </div>\n\n              {/* Time Display */}\n              <div\n                className={`text-xs font-mono ${isOwn ? \"text-white/70\" : \"text-gray-500\"}`}\n              >\n                {formatTime(currentTime)} / {formatTime(message.duration)}\n              </div>\n            </div>\n\n            {/* Additional Controls */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                {/* Skip Backward */}\n                <button\n                  onClick={skipBackward}\n                  className={`p-1 rounded hover:bg-black/10 ${isOwn ? \"text-white/70\" : \"text-gray-600\"}`}\n                >\n                  <SkipBack className=\"w-4 h-4\" />\n                </button>\n\n                {/* Skip Forward */}\n                <button\n                  onClick={skipForward}\n                  className={`p-1 rounded hover:bg-black/10 ${isOwn ? \"text-white/70\" : \"text-gray-600\"}`}\n                >\n                  <SkipForward className=\"w-4 h-4\" />\n                </button>\n\n                {/* Speed Control */}\n                <select\n                  value={playbackSpeed}\n                  onChange={(e) => handleSpeedChange(Number(e.target.value))}\n                  className={`\n                    text-xs px-1 py-0.5 rounded border-0 bg-transparent cursor-pointer\n                    ${isOwn ? \"text-white/70\" : \"text-gray-600\"}\n                  `}\n                >\n                  {VOICE_MESSAGE_UI.playbackSpeed.map((speed) => (\n                    <option key={speed} value={speed} className=\"text-gray-900\">\n                      {speed}x\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                {/* Volume Control */}\n                <button\n                  onClick={toggleMute}\n                  className={`p-1 rounded hover:bg-black/10 ${isOwn ? \"text-white/70\" : \"text-gray-600\"}`}\n                >\n                  {isMuted ? (\n                    <VolumeX className=\"w-4 h-4\" />\n                  ) : (\n                    <Volume2 className=\"w-4 h-4\" />\n                  )}\n                </button>\n\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.1\"\n                  value={isMuted ? 0 : volume}\n                  onChange={(e) => handleVolumeChange(Number(e.target.value))}\n                  className=\"w-16 h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer slider\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Error Display */}\n          {error && (\n            <div\n              className={`mt-2 p-2 rounded text-xs ${isOwn ? \"bg-white/20 text-white\" : \"bg-red-50 text-red-600\"}`}\n            >\n              {error}\n            </div>\n          )}\n\n          {/* Transcription */}\n          {showTranscription && message.transcription && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              className={`mt-3 p-2 rounded text-xs ${isOwn ? \"bg-white/20\" : \"bg-gray-50\"}`}\n            >\n              <div className=\"flex items-center justify-between mb-1\">\n                <span\n                  className={`font-medium ${isOwn ? \"text-white/80\" : \"text-gray-600\"}`}\n                >\n                  {t.transcription}\n                </span>\n                {message.confidence && (\n                  <span\n                    className={`text-xs ${isOwn ? \"text-white/60\" : \"text-gray-500\"}`}\n                  >\n                    {Math.round(message.confidence * 100)}%\n                  </span>\n                )}\n              </div>\n              <p\n                className={`italic ${isOwn ? \"text-white/90\" : \"text-gray-800\"}`}\n              >\n                \"{message.transcription}\"\n              </p>\n            </motion.div>\n          )}\n\n          {/* Translation */}\n          {showTranslation && message.translation && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              className={`mt-2 p-2 rounded text-xs ${isOwn ? \"bg-white/20\" : \"bg-blue-50\"}`}\n            >\n              <div className=\"flex items-center space-x-1 mb-1\">\n                <Languages className=\"w-3 h-3\" />\n                <span\n                  className={`font-medium ${isOwn ? \"text-white/80\" : \"text-blue-600\"}`}\n                >\n                  {t.translation}\n                </span>\n              </div>\n              <p\n                className={`italic ${isOwn ? \"text-white/90\" : \"text-blue-800\"}`}\n              >\n                \"{message.translation}\"\n              </p>\n            </motion.div>\n          )}\n\n          {/* Timestamp */}\n          <div\n            className={`mt-2 text-xs ${isOwn ? \"text-white/60\" : \"text-gray-500\"}`}\n          >\n            {new Date(message.timestamp).toLocaleTimeString([], {\n              hour: \"2-digit\",\n              minute: \"2-digit\",\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["VoiceMessagePlayer","message","isOwn","showTranscription","showTranslation","onTranslate","onReport","onDownload","className","language","useLanguage","isPlaying","setIsPlaying","useState","currentTime","setCurrentTime","volume","setVolume","isMuted","setIsMuted","playbackSpeed","setPlaybackSpeed","showMenu","setShowMenu","showSettings","setShowSettings","error","setError","audioRef","useRef","progressRef","waveformRef","translations","en","play","pause","mute","unmute","transcription","translation","translate","download","report","copy","forward","backward","repeat","settings","errorLoading","noTranscription","confidence","pt","t","useEffect","audioUrl","audio","Audio","current","addEventListener","e","console","remove","drawWaveform","useCallback","canvas","ctx","getContext","width","height","barWidth","barGap","numBars","Math","floor","clearRect","seed","id","split","reduce","acc","char","charCodeAt","random","x","sin","i","barHeight","y","progress","duration","isPlayed","fillStyle","PORTUGUESE_COLORS","red","VOICE_MESSAGE_UI","waveformColor","fillRect","togglePlay","toggleMute","handleVolumeChange","newVolume","handleSpeedChange","speed","playbackRate","skipForward","min","skipBackward","max","handleProgressClick","event","rect","getBoundingClientRect","clickX","clientX","left","percentage","newTime","copyTranscription","navigator","clipboard","writeText","formatTime","seconds","mins","secs","toString","padStart","getDialectFlag","dialect","flags","div","style","backgroundColor","img","src","senderAvatar","alt","senderName","span","button","onClick","MoreVertical","AnimatePresence","motion","initial","opacity","scale","animate","exit","Languages","Copy","Download","Flag","disabled","Pause","Play","ref","waveformHeight","SkipBack","SkipForward","select","value","onChange","Number","target","map","option","VolumeX","Volume2","input","type","step","round","p","Date","timestamp","toLocaleTimeString","hour","minute"],"mappings":"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"}