{"version":3,"sources":["/workspaces/LusoTown/web-app/src/components/LusoBotWidget.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  ChatBubbleLeftRightIcon,\n  XMarkIcon,\n  SparklesIcon,\n  HeartIcon,\n  MinusIcon,\n  PlusIcon,\n} from \"@heroicons/react/24/outline\";\nimport { HeartIcon as HeartSolidIcon } from \"@heroicons/react/24/solid\";\nimport { useLanguage } from \"@/context/LanguageContext\";\nimport {\n  COMPONENT_Z_INDEX,\n  getMobileWidgetClasses,\n} from \"@/config/z-index-layers\";\nimport LusoBotChat from \"./LusoBotChat\";\nimport { useAppDownloadBarVisible } from \"./AppDownloadBar\";\nimport { useWidget } from \"./WidgetManager\";\nimport { useAriaAnnouncements, ARIA_MESSAGES } from \"@/hooks/useAriaAnnouncements\";\nimport { useFocusManagement, useFocusIndicator } from \"@/hooks/useFocusManagement\";\n\n// Simple, consistent welcome messages (no randomization)\nconst WELCOME_MESSAGES = {\n  pt: [\"Olá! Sou o LusoBot. Como posso ajudar-te hoje?\"],\n  en: [\"Hi! I’m LusoBot. How can I help you today?\"],\n};\n\ninterface LusoBotWidgetProps {\n  position?: \"bottom-right\" | \"bottom-left\" | \"top-right\" | \"top-left\";\n  autoOpen?: boolean;\n  showWelcomeMessage?: boolean;\n  customGreeting?: string;\n  theme?: \"light\" | \"dark\" | \"portuguese\";\n}\n\ninterface FloatingMessage {\n  id: string;\n  text: string;\n  type: \"welcome\" | \"suggestion\" | \"help\";\n  visible: boolean;\n}\n\nexport default function LusoBotWidget({\n  position = \"bottom-right\",\n  autoOpen = false,\n  showWelcomeMessage = true,\n  customGreeting,\n  theme = \"portuguese\",\n}: LusoBotWidgetProps) {\n  const { language } = useLanguage();\n  const [isOpen, setIsOpen] = useState(autoOpen);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [floatingMessages, setFloatingMessages] = useState<FloatingMessage[]>(\n    []\n  );\n  const [hasInteracted, setHasInteracted] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [isMobile, setIsMobile] = useState(false);\n  const [isKeyboardOpen, setIsKeyboardOpen] = useState(false);\n  \n  // Use Widget Management System\n  const widgetId = 'lusobot-widget';\n  const { isAppBarVisible, classes: widgetClasses, zIndex } = useWidget(widgetId, 'chat');\n\n  // ARIA and Focus Management\n  const { announce, announcePolite } = useAriaAnnouncements();\n  const { addFocusClasses } = useFocusIndicator();\n  const widgetRef = useRef<HTMLDivElement>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  \n  // Focus management for the chat widget when opened\n  const { focusFirst } = useFocusManagement(\n    widgetRef,\n    isOpen && !isMinimized,\n    {\n      restoreFocus: true,\n      initialFocus: 'first',\n      preventScroll: false\n    }\n  );\n  // Feature flag to disable extra contextual popups\n  const ENABLE_CONTEXTUAL_SUGGESTIONS = false;\n\n  // Lightweight routes for quick actions (fallbacks if import is unavailable)\n  const ROUTES_SAFE = {\n    events: \"/events\",\n    businessDirectory: \"/business-directory\",\n    signup: \"/apply\",\n  } as const;\n\n  // Position classes with mobile-safe positioning\n  const positionClasses = {\n    \"bottom-right\": \"bottom-6 right-6 md:bottom-6 md:right-6\",\n    \"bottom-left\": \"bottom-6 left-6 md:bottom-6 md:left-6\",\n    \"top-right\": \"top-6 right-6\",\n    \"top-left\": \"top-6 left-6\",\n  };\n\n  // Dynamic positioning based on Widget Management System\n  const getCurrentPositionClass = () => {\n    if (isMobile) {\n      // Use widget management system for mobile positioning\n      const baseBottomClass = isAppBarVisible ? 'bottom-40' : 'bottom-24';\n      return `${baseBottomClass} right-4 safe-area-bottom`;\n    }\n    return positionClasses[position];\n  };\n\n  // Mobile detection and resize handler\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < 768);\n    };\n\n    checkMobile();\n    window.addEventListener(\"resize\", checkMobile);\n    return () => window.removeEventListener(\"resize\", checkMobile);\n  }, []);\n\n  // Keyboard detection for mobile - hide widget when keyboard is open\n  useEffect(() => {\n    if (!isMobile) return;\n\n    const initialViewportHeight =\n      window.visualViewport?.height || window.innerHeight;\n\n    const handleViewportChange = () => {\n      if (window.visualViewport) {\n        const currentHeight = window.visualViewport.height;\n        const heightDifference = initialViewportHeight - currentHeight;\n        setIsKeyboardOpen(heightDifference > 150); // Keyboard likely open if viewport shrunk by 150px+\n      }\n    };\n\n    if (window.visualViewport) {\n      window.visualViewport.addEventListener(\"resize\", handleViewportChange);\n      return () =>\n        window.visualViewport?.removeEventListener(\n          \"resize\",\n          handleViewportChange\n        );\n    }\n  }, [isMobile]);\n\n  // Theme configurations\n  const themes = {\n    light: {\n      buttonBg: \"bg-white shadow-lg border border-gray-200\",\n      buttonHover: \"hover:shadow-xl\",\n      iconColor: \"text-primary-600\",\n      chatBg: \"bg-white\",\n      badgeColor: \"bg-red-500\",\n    },\n    dark: {\n      buttonBg: \"bg-gray-800 shadow-lg\",\n      buttonHover: \"hover:shadow-xl\",\n      iconColor: \"text-white\",\n      chatBg: \"bg-gray-800\",\n      badgeColor: \"bg-red-500\",\n    },\n    portuguese: {\n      buttonBg: \"bg-gradient-to-r from-primary-500 to-secondary-500 shadow-lg\",\n      buttonHover:\n        \"hover:shadow-xl hover:from-primary-600 hover:to-secondary-600\",\n      iconColor: \"text-white\",\n      chatBg: \"bg-white\",\n      badgeColor: \"bg-red-500\",\n    },\n  };\n\n  const currentTheme = themes[theme];\n\n  // Welcome messages based on language and navigation guidance\n\n  // Initialize floating messages (no randomization)\n  useEffect(() => {\n    if (!showWelcomeMessage || hasInteracted) return;\n\n    const timer = setTimeout(() => {\n      const messages =\n        WELCOME_MESSAGES[language as keyof typeof WELCOME_MESSAGES];\n      const welcomeText = messages[0];\n\n      const newMessage: FloatingMessage = {\n        id: `welcome_${Date.now()}`,\n        text: (customGreeting ?? welcomeText) as string,\n        type: \"welcome\",\n        visible: true,\n      };\n\n      setFloatingMessages([newMessage]);\n      setUnreadCount(1);\n\n      // Hide message after 10 seconds\n      setTimeout(() => {\n        setFloatingMessages((prev) =>\n          prev.map((msg) => ({ ...msg, visible: false }))\n        );\n      }, 10000);\n    }, 3000); // Show after 3 seconds\n\n    return () => clearTimeout(timer);\n  }, [language, showWelcomeMessage, hasInteracted, customGreeting]);\n\n  // (Optional) contextual suggestions based on page — disabled when flag is false\n  useEffect(() => {\n    if (!ENABLE_CONTEXTUAL_SUGGESTIONS) return;\n    const pathname = window.location.pathname;\n    let suggestion = \"\";\n\n    if (pathname.includes(\"/events\")) {\n      suggestion =\n        language === \"pt\"\n          ? \"Vejo que estás na página de eventos! De que região és? Posso recomendar eventos específicos!\"\n          : \"I see you're on the events page! Where are you from? I can recommend specific events!\";\n    } else if (pathname.includes(\"/business-directory\")) {\n      suggestion =\n        language === \"pt\"\n          ? \"Procuras negócios portugueses? Diz-me a tua localização ou tipo de serviço!\"\n          : \"Looking for Portuguese businesses? Tell me your location or type of service!\";\n    } else if (pathname.includes(\"/matches\")) {\n      suggestion =\n        language === \"pt\"\n          ? \"Quer encontrar outros portugueses? Conte-me sobre os teus interesses!\"\n          : \"Want to find other Portuguese speakers? Tell me about your interests!\";\n    } else if (pathname.includes(\"/community\")) {\n      suggestion =\n        language === \"pt\"\n          ? \"Interessado na comunidade? De onde és e o que procuras?\"\n          : \"Interested in the community? Where are you from and what are you looking for?\";\n    } else if (pathname === \"/\") {\n      suggestion =\n        language === \"pt\"\n          ? \"Bem-vindo ao LusoTown! De onde és e o que te traz aqui?\"\n          : \"Welcome to LusoTown! Where are you from and what brings you here?\";\n    }\n\n    if (showWelcomeMessage && suggestion && !hasInteracted) {\n      const timer = setTimeout(() => {\n        const newMessage: FloatingMessage = {\n          id: `suggestion_${Date.now()}`,\n          text: suggestion,\n          type: \"suggestion\",\n          visible: true,\n        };\n\n        setFloatingMessages((prev) => [...prev, newMessage]);\n        setUnreadCount((prev) => prev + 1);\n\n        setTimeout(() => {\n          setFloatingMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === newMessage.id ? { ...msg, visible: false } : msg\n            )\n          );\n        }, 8000);\n      }, 5000);\n\n      return () => clearTimeout(timer);\n    }\n  }, [\n    language,\n    hasInteracted,\n    showWelcomeMessage,\n    ENABLE_CONTEXTUAL_SUGGESTIONS,\n  ]);\n\n  const handleOpen = () => {\n    setIsOpen(true);\n    setIsMinimized(false);\n    setHasInteracted(true);\n    setUnreadCount(0);\n    setFloatingMessages([]);\n    \n    // Announce to screen readers\n    announce(ARIA_MESSAGES.lusobot.opened, { priority: 'polite', bilingual: false });\n    \n    // Scroll chat to top when opened (Priority 1 enhancement)\n    setTimeout(() => {\n      const chatContainer = document.querySelector('[data-lusobot-chat-container]') || \n                            document.querySelector('.lusobot-chat-container');\n      if (chatContainer) {\n        chatContainer.scrollTop = 0;\n        // Smooth scroll to top for better UX\n        chatContainer.scrollTo({ top: 0, behavior: 'smooth' });\n      }\n      \n      // Focus first interactive element in the widget\n      focusFirst();\n    }, 150);\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n    setIsMinimized(false);\n    \n    // Announce to screen readers\n    announcePolite(ARIA_MESSAGES.lusobot.closed);\n    \n    // Focus will be restored to the original trigger button by useFocusManagement\n  };\n\n  const handleMinimize = () => {\n    setIsMinimized(true);\n    \n    // Announce to screen readers\n    announcePolite(ARIA_MESSAGES.lusobot.minimized);\n  };\n\n  const handleMaximize = () => {\n    setIsMinimized(false);\n    \n    // Announce to screen readers\n    announcePolite(ARIA_MESSAGES.widget.maximized);\n    \n    // Focus the first element when maximized\n    setTimeout(() => {\n      focusFirst();\n    }, 100);\n  };\n\n  const dismissFloatingMessage = (messageId: string) => {\n    setFloatingMessages((prev) =>\n      prev.map((msg) =>\n        msg.id === messageId ? { ...msg, visible: false } : msg\n      )\n    );\n    setUnreadCount((prev) => Math.max(0, prev - 1));\n  };\n\n  return (\n    <>\n      {/* Floating Messages */}\n      <AnimatePresence>\n        {floatingMessages.map(\n          (message) =>\n            message.visible &&\n            !isOpen && (\n              <motion.div\n                key={message.id}\n                initial={{ opacity: 0, y: 20, scale: 0.8 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 20, scale: 0.8 }}\n                className={`fixed ${getCurrentPositionClass()} z-[${zIndex}] ${\n                  isMobile ? (isAppBarVisible ? \"bottom-44\" : \"bottom-28\") : \"bottom-20\"\n                } max-w-xs`}\n              >\n                <div className=\"bg-white rounded-2xl shadow-lg border border-gray-100 p-4 relative\">\n                  {/* Close button */}\n                  <button\n                    onClick={() => dismissFloatingMessage(message.id)}\n                    className=\"absolute top-2 right-2 w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center\n                    hover:bg-gray-200 transition-colors\"\n                  >\n                    <XMarkIcon className=\"w-3 h-3 text-gray-500\" />\n                  </button>\n\n                  {/* Message content */}\n                  <div className=\"pr-6\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <div className=\"w-6 h-6 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full flex items-center justify-center\">\n                        <span className=\"text-white text-xs\">🇵🇹</span>\n                      </div>\n                      <span className=\"text-sm font-medium text-gray-900\">\n                        LusoBot\n                      </span>\n                    </div>\n\n                    <p className=\"text-sm text-gray-700 leading-relaxed\">\n                      {message.text}\n                    </p>\n\n                    {/* Beginner-friendly quick actions */}\n                    <div className=\"mt-3 flex flex-wrap gap-2\">\n                      <a\n                        href={ROUTES_SAFE.events}\n                        className=\"text-xs px-2 py-1 rounded-full bg-primary-50 text-primary-700 border border-primary-200 hover:bg-primary-100\"\n                      >\n                        {language === \"pt\"\n                          ? \"Encontrar eventos\"\n                          : \"Find events\"}\n                      </a>\n                      <a\n                        href={ROUTES_SAFE.businessDirectory}\n                        className=\"text-xs px-2 py-1 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200 hover:bg-yellow-100\"\n                      >\n                        {language === \"pt\"\n                          ? \"Negócios portugueses\"\n                          : \"Portuguese businesses\"}\n                      </a>\n                      <a\n                        href={ROUTES_SAFE.signup}\n                        className=\"text-xs px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-200 hover:bg-green-100\"\n                      >\n                        {language === \"pt\" ? \"Começar\" : \"Get started\"}\n                      </a>\n                    </div>\n\n                    <button\n                      onClick={handleOpen}\n                      className=\"mt-3 text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors\"\n                    >\n                      {language === \"pt\" ? \"Conversar agora\" : \"Chat now\"}\n                    </button>\n                  </div>\n\n                  {/* Tail */}\n                  <div\n                    className={`absolute ${\n                      position.includes(\"right\")\n                        ? \"-bottom-2 right-6\"\n                        : \"-bottom-2 left-6\"\n                    } \n                  w-4 h-4 bg-white border-r border-b border-gray-100 transform rotate-45`}\n                  />\n                </div>\n              </motion.div>\n            )\n        )}\n      </AnimatePresence>\n\n      {/* Main Chat Widget */}\n      <div\n        className={\n          isMobile\n            ? getMobileWidgetClasses(\"chat\", isAppBarVisible)\n            : `fixed ${getCurrentPositionClass()}`\n        }\n        style={{\n          // Only apply z-index for desktop, mobile classes already include it\n          ...(isMobile ? {} : { zIndex: zIndex || 70 })\n        }}\n      >\n        <AnimatePresence>\n          {isOpen && (\n            <motion.div\n              ref={widgetRef}\n              initial={{ opacity: 0, scale: 0.8, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.8, y: 20 }}\n              transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n              className={`mb-4 ${\n                isMinimized\n                  ? \"w-80 h-16 md:w-80 md:h-16\"\n                  : \"w-[90vw] max-w-lg h-[75vh] max-h-[680px] md:w-[520px] md:h-[680px]\"\n              } ${\n                currentTheme.chatBg\n              } rounded-2xl shadow-2xl border border-gray-200 overflow-hidden`}\n              role=\"dialog\"\n              aria-modal=\"true\"\n              aria-labelledby=\"lusobot-title\"\n              aria-describedby=\"lusobot-description\"\n            >\n              {isMinimized ? (\n                <div className=\"h-full flex items-center justify-between p-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-8 h-8 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full flex items-center justify-center\">\n                      <span className=\"text-white text-sm\">🇵🇹</span>\n                    </div>\n                    <span className=\"font-medium text-gray-900\">LusoBot</span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      onClick={handleMaximize}\n                      className=\"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center\n                        hover:bg-gray-200 transition-colors\"\n                    >\n                      <PlusIcon className=\"w-4 h-4 text-gray-600\" />\n                    </button>\n                    <button\n                      onClick={handleClose}\n                      className=\"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center\n                        hover:bg-gray-200 transition-colors\"\n                    >\n                      <XMarkIcon className=\"w-4 h-4 text-gray-600\" />\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"h-full flex flex-col\">\n                  {/* Chat Header - Priority 1 Enhancement: Clear minimize/close buttons */}\n                  <div className=\"bg-gradient-to-r from-primary-500 to-secondary-500 p-4 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center\" aria-hidden=\"true\">\n                        <span className=\"text-white text-sm\">🇵🇹</span>\n                      </div>\n                      <div>\n                        <h3 id=\"lusobot-title\" className=\"font-bold text-white\">LusoBot</h3>\n                        <p id=\"lusobot-description\" className=\"text-xs text-white/80\">\n                          {language === \"pt\"\n                            ? \"Assistente Cultural Português - Conecte-se com a comunidade lusófona\"\n                            : \"Portuguese Cultural Assistant - Connect with the Portuguese-speaking community\"}\n                        </p>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-3\">\n                      <button\n                        onClick={handleMinimize}\n                        className=\"w-9 h-9 bg-white/20 rounded-lg flex items-center justify-center\n                          hover:bg-white/30 transition-colors focus:ring-2 focus:ring-white/50\n                          min-h-[44px] min-w-[44px]\"\n                        aria-label={language === \"pt\" ? \"Minimizar\" : \"Minimize\"}\n                        title={language === \"pt\" ? \"Minimizar\" : \"Minimize\"}\n                      >\n                        <MinusIcon className=\"w-5 h-5 text-white\" />\n                      </button>\n                      <button\n                        onClick={handleClose}\n                        className=\"w-9 h-9 bg-white/20 rounded-lg flex items-center justify-center\n                          hover:bg-white/30 transition-colors focus:ring-2 focus:ring-white/50\n                          min-h-[44px] min-w-[44px]\"\n                        aria-label={language === \"pt\" ? \"Fechar\" : \"Close\"}\n                        title={language === \"pt\" ? \"Fechar\" : \"Close\"}\n                      >\n                        <XMarkIcon className=\"w-5 h-5 text-white\" />\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Chat Content - Priority 1 Enhancement: Max height with internal scrolling */}\n                  <div className=\"flex-1 relative overflow-hidden max-h-[520px]\">\n                    <LusoBotChat\n                      isEmbedded={true}\n                      className=\"h-full border-0 bg-transparent lusobot-chat-container\"\n                      onClose={handleClose}\n                      data-lusobot-chat-container=\"true\"\n                    />\n                  </div>\n                </div>\n              )}\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Floating Action Button */}\n        {!isOpen && !isKeyboardOpen && (\n          <motion.button\n            ref={buttonRef}\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={handleOpen}\n            onFocus={() => {\n              if (buttonRef.current) {\n                addFocusClasses(buttonRef.current, 'widget');\n              }\n            }}\n            onBlur={() => {\n              if (buttonRef.current) {\n                buttonRef.current.classList.remove('lusotown-widget-focus', 'lusotown-focus-smooth');\n              }\n            }}\n            className={`${isMobile ? \"w-16 h-16\" : \"w-20 h-20\"} rounded-full ${\n              currentTheme.buttonBg\n            } ${currentTheme.buttonHover}\n              flex items-center justify-center transition-all duration-200 relative group min-h-[44px] min-w-[44px]`}\n            aria-label={\n              language === \"pt\"\n                ? \"Abrir LusoBot - Assistente Cultural Português para a comunidade lusófona. Prima Enter para abrir.\"\n                : \"Open LusoBot - Portuguese Cultural Assistant for the Portuguese-speaking community. Press Enter to open.\"\n            }\n            aria-describedby={unreadCount > 0 ? \"lusobot-unread-count\" : undefined}\n            role=\"button\"\n            tabIndex={0}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" || e.key === \" \") {\n                e.preventDefault();\n                handleOpen();\n              }\n            }}\n          >\n            {/* Pulse animation for attention */}\n            {unreadCount > 0 && (\n              <motion.div\n                animate={{ scale: [1, 1.2, 1] }}\n                transition={{ repeat: Infinity, duration: 2 }}\n                className=\"absolute inset-0 rounded-full bg-primary-400 opacity-30\"\n              />\n            )}\n\n            {/* Main Icon with Lusophone Context */}\n            <div className=\"relative\">\n              {unreadCount > 0 ? (\n                <HeartSolidIcon\n                  className={`${isMobile ? \"w-6 h-6\" : \"w-8 h-8\"} ${\n                    currentTheme.iconColor\n                  }`}\n                />\n              ) : (\n                <ChatBubbleLeftRightIcon\n                  className={`${isMobile ? \"w-6 h-6\" : \"w-8 h-8\"} ${\n                    currentTheme.iconColor\n                  }`}\n                />\n              )}\n\n              {/* Portuguese heritage indicator */}\n              <div className=\"absolute -top-1 -left-1 w-3 h-3 text-[10px] flex items-center justify-center\">\n                🇵🇹\n              </div>\n\n              {/* Unread count badge */}\n              {unreadCount > 0 && (\n                <div\n                  className={`absolute -top-2 -right-2 w-5 h-5 ${currentTheme.badgeColor} \n                  rounded-full flex items-center justify-center`}\n                >\n                  <span className=\"text-xs font-bold text-white\">\n                    {unreadCount > 9 ? \"9+\" : unreadCount}\n                  </span>\n                </div>\n              )}\n            </div>\n\n            {/* Hover tooltip */}\n            <div\n              className=\"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 \n              bg-gray-800 text-white text-xs px-2 py-1 rounded-lg opacity-0 group-hover:opacity-100 \n              transition-opacity duration-200 whitespace-nowrap pointer-events-none\"\n            >\n              {language === \"pt\"\n                ? \"Conversar com LusoBot\"\n                : \"Chat with LusoBot\"}\n              <div\n                className=\"absolute top-full left-1/2 transform -translate-x-1/2 \n                w-2 h-2 bg-gray-800 rotate-45\"\n              />\n            </div>\n          </motion.button>\n        )}\n      </div>\n    </>\n  );\n}\n"],"names":["LusoBotWidget","WELCOME_MESSAGES","pt","en","position","autoOpen","showWelcomeMessage","customGreeting","theme","language","useLanguage","isOpen","setIsOpen","useState","isMinimized","setIsMinimized","floatingMessages","setFloatingMessages","hasInteracted","setHasInteracted","unreadCount","setUnreadCount","isMobile","setIsMobile","isKeyboardOpen","setIsKeyboardOpen","widgetId","isAppBarVisible","classes","widgetClasses","zIndex","useWidget","announce","announcePolite","useAriaAnnouncements","addFocusClasses","useFocusIndicator","widgetRef","useRef","buttonRef","focusFirst","useFocusManagement","restoreFocus","initialFocus","preventScroll","ENABLE_CONTEXTUAL_SUGGESTIONS","ROUTES_SAFE","events","businessDirectory","signup","positionClasses","getCurrentPositionClass","baseBottomClass","useEffect","checkMobile","window","innerWidth","addEventListener","removeEventListener","initialViewportHeight","visualViewport","height","innerHeight","handleViewportChange","currentHeight","heightDifference","themes","light","buttonBg","buttonHover","iconColor","chatBg","badgeColor","dark","portuguese","currentTheme","timer","setTimeout","messages","welcomeText","newMessage","id","Date","now","text","type","visible","prev","map","msg","clearTimeout","pathname","location","suggestion","includes","handleOpen","ARIA_MESSAGES","lusobot","opened","priority","bilingual","chatContainer","document","querySelector","scrollTop","scrollTo","top","behavior","handleClose","closed","handleMinimize","minimized","handleMaximize","widget","maximized","dismissFloatingMessage","messageId","Math","max","AnimatePresence","message","motion","div","initial","opacity","y","scale","animate","exit","className","button","onClick","XMarkIcon","span","p","a","href","getMobileWidgetClasses","style","ref","transition","stiffness","damping","role","aria-modal","aria-labelledby","aria-describedby","PlusIcon","aria-hidden","h3","aria-label","title","MinusIcon","LusoBotChat","isEmbedded","onClose","data-lusobot-chat-container","whileHover","whileTap","onFocus","current","onBlur","classList","remove","undefined","tabIndex","onKeyDown","e","key","preventDefault","repeat","Infinity","duration","HeartSolidIcon","ChatBubbleLeftRightIcon"],"mappings":"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"}