{"version":3,"sources":["/workspaces/LusoTown/web-app/src/lib/monitoring/error-tracker.ts"],"sourcesContent":["/**\n * Comprehensive Error Tracking System for LusoTown Platform\n * Handles Portuguese community-specific error tracking and monitoring with Sentry integration\n */\n\nimport * as Sentry from '@sentry/nextjs'\nimport { \n  ERROR_MONITORING, \n  MONITORING_ALERTS, \n  ERROR_CATEGORIES,\n  PORTUGUESE_ERROR_CONTEXTS,\n  ERROR_SEVERITY,\n  PORTUGUESE_ERROR_THRESHOLDS\n} from '@/config/error-monitoring'\nimport { LusoTownError, ErrorType } from '@/lib/errorHandling'\nimport { getErrorMessage, getContextualErrorMessage } from './portuguese-error-messages'\n\nexport interface ErrorEvent {\n  id: string\n  timestamp: Date\n  message: string\n  type: ErrorType\n  severity: keyof typeof ERROR_SEVERITY\n  context: string\n  stack?: string\n  userAgent?: string\n  url?: string\n  userId?: string\n  sessionId?: string\n  portugueseContext?: {\n    language: 'pt' | 'en'\n    culturalFeature?: string\n    businessDirectoryAction?: string\n    characterEncodingIssue?: boolean\n    mobileDevice?: boolean\n  }\n  metadata?: Record<string, any>\n}\n\nexport interface PerformanceMetric {\n  name: string\n  value: number\n  timestamp: Date\n  context: string\n  threshold?: number\n  exceedsThreshold: boolean\n}\n\nclass ErrorTracker {\n  private errorQueue: ErrorEvent[] = []\n  private performanceQueue: PerformanceMetric[] = []\n  private errorCounts: Map<string, number> = new Map()\n  private lastFlush: Date = new Date()\n  private sessionId: string = this.generateSessionId()\n\n  constructor() {\n    this.setupErrorCapture()\n    this.setupPerformanceCapture()\n    this.setupPeriodicFlush()\n  }\n\n  private generateSessionId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  private setupErrorCapture() {\n    if (typeof window === 'undefined') return\n\n    // Capture unhandled errors\n    window.addEventListener('error', (event) => {\n      this.trackError({\n        message: event.message,\n        type: ErrorType.CLIENT_ERROR,\n        severity: ERROR_SEVERITY.HIGH,\n        context: 'unhandled-error',\n        stack: event.error?.stack,\n        url: event.filename,\n        metadata: {\n          lineno: event.lineno,\n          colno: event.colno\n        }\n      })\n    })\n\n    // Capture unhandled promise rejections\n    window.addEventListener('unhandledrejection', (event) => {\n      this.trackError({\n        message: event.reason?.message || 'Unhandled promise rejection',\n        type: ErrorType.CLIENT_ERROR,\n        severity: ERROR_SEVERITY.HIGH,\n        context: 'unhandled-rejection',\n        stack: event.reason?.stack,\n        metadata: {\n          reason: event.reason\n        }\n      })\n    })\n  }\n\n  private setupPerformanceCapture() {\n    if (typeof window === 'undefined') return\n\n    // Capture performance metrics using Performance Observer API\n    if ('PerformanceObserver' in window) {\n      try {\n        const observer = new PerformanceObserver((list) => {\n          for (const entry of list.getEntries()) {\n            if (entry.entryType === 'navigation') {\n              this.trackPerformanceMetric({\n                name: 'Page Load Time',\n                value: entry.duration,\n                context: 'page-navigation'\n              })\n            } else if (entry.entryType === 'measure') {\n              this.trackPerformanceMetric({\n                name: entry.name,\n                value: entry.duration,\n                context: 'custom-measure'\n              })\n            }\n          }\n        })\n\n        observer.observe({ entryTypes: ['navigation', 'measure'] })\n      } catch (error) {\n        console.error('Failed to setup performance observer:', error)\n      }\n    }\n  }\n\n  trackError(errorData: Partial<ErrorEvent>) {\n    const error: ErrorEvent = {\n      id: this.generateErrorId(),\n      timestamp: new Date(),\n      message: errorData.message || 'Unknown error',\n      type: errorData.type || ErrorType.UNKNOWN,\n      severity: errorData.severity || ERROR_SEVERITY.MEDIUM,\n      context: errorData.context || 'unknown',\n      stack: errorData.stack,\n      userAgent: typeof window !== 'undefined' ? navigator.userAgent : undefined,\n      url: typeof window !== 'undefined' ? window.location.href : undefined,\n      sessionId: this.sessionId,\n      userId: errorData.userId,\n      portugueseContext: errorData.portugueseContext,\n      metadata: errorData.metadata\n    }\n\n    // Send to Sentry with Portuguese community context\n    this.sendToSentry(error)\n\n    this.errorQueue.push(error)\n    this.updateErrorCounts(error)\n    this.checkAlertThresholds(error)\n\n    // Immediate flush for critical errors\n    if (error.severity === ERROR_SEVERITY.CRITICAL) {\n      this.flushErrors()\n    }\n  }\n\n  trackPerformanceMetric(metricData: Omit<PerformanceMetric, 'timestamp' | 'exceedsThreshold'>) {\n    const metric: PerformanceMetric = {\n      ...metricData,\n      timestamp: new Date(),\n      exceedsThreshold: metricData.threshold ? metricData.value > metricData.threshold : false\n    }\n\n    this.performanceQueue.push(metric)\n\n    // Track performance issues as errors if they exceed thresholds\n    if (metric.exceedsThreshold) {\n      this.trackError({\n        message: `Performance threshold exceeded: ${metric.name} (${metric.value}ms > ${metric.threshold}ms)`,\n        type: ErrorType.CLIENT_ERROR,\n        severity: ERROR_SEVERITY.MEDIUM,\n        context: 'performance-degradation',\n        metadata: { metric }\n      })\n    }\n  }\n\n  private generateErrorId(): string {\n    return `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  private updateErrorCounts(error: ErrorEvent) {\n    const key = `${error.context}-${error.severity}`\n    const current = this.errorCounts.get(key) || 0\n    this.errorCounts.set(key, current + 1)\n  }\n\n  private checkAlertThresholds(error: ErrorEvent) {\n    const category = Object.values(ERROR_CATEGORIES).find(cat => \n      cat.context === error.context\n    )\n\n    if (category) {\n      const key = `${error.context}-${error.severity}`\n      const count = this.errorCounts.get(key) || 0\n\n      if (count >= category.alertThreshold) {\n        this.triggerAlert(error, category, count)\n      }\n    }\n  }\n\n  private triggerAlert(error: ErrorEvent, category: any, count: number) {\n    if (!MONITORING_ALERTS.criticalErrors.enabled) return\n\n    console.error('ALERT TRIGGERED:', {\n      category: category.name,\n      error: error.message,\n      count,\n      severity: error.severity,\n      context: error.context,\n      timestamp: error.timestamp\n    })\n\n    // Dispatch custom event for UI notifications\n    if (typeof window !== 'undefined') {\n      window.dispatchEvent(new CustomEvent('lusotown:error-alert', {\n        detail: { error, category, count }\n      }))\n    }\n  }\n\n  private setupPeriodicFlush() {\n    // Flush errors and metrics every 5 minutes\n    setInterval(() => {\n      this.flushErrors()\n      this.flushMetrics()\n    }, 5 * 60 * 1000)\n\n    // Flush on page unload\n    if (typeof window !== 'undefined') {\n      window.addEventListener('beforeunload', () => {\n        this.flushErrors()\n        this.flushMetrics()\n      })\n    }\n  }\n\n  private async flushErrors() {\n    if (this.errorQueue.length === 0) return\n\n    const errorsToFlush = [...this.errorQueue]\n    this.errorQueue = []\n\n    try {\n      if (ERROR_MONITORING.enabled && ERROR_MONITORING.endpoint) {\n        await this.sendToMonitoringService(errorsToFlush, 'errors')\n      } else {\n        console.group('üö® Error Batch:', errorsToFlush.length, 'errors')\n        errorsToFlush.forEach(error => {\n          console.error('Error:', error.message, error)\n        })\n        console.groupEnd()\n      }\n    } catch (flushError) {\n      console.error('Failed to flush errors:', flushError)\n      this.errorQueue.unshift(...errorsToFlush)\n    }\n  }\n\n  private async flushMetrics() {\n    if (this.performanceQueue.length === 0) return\n\n    const metricsToFlush = [...this.performanceQueue]\n    this.performanceQueue = []\n\n    try {\n      if (ERROR_MONITORING.enabled && ERROR_MONITORING.endpoint) {\n        await this.sendToMonitoringService(metricsToFlush, 'metrics')\n      } else {\n        console.group('üìä Performance Metrics:', metricsToFlush.length, 'metrics')\n        metricsToFlush.forEach(metric => {\n          const status = metric.exceedsThreshold ? '‚ùå' : '‚úÖ'\n          console.log(`${status} ${metric.name}: ${metric.value}ms`, metric)\n        })\n        console.groupEnd()\n      }\n    } catch (flushError) {\n      console.error('Failed to flush metrics:', flushError)\n      this.performanceQueue.unshift(...metricsToFlush)\n    }\n  }\n\n  private async sendToMonitoringService(data: any[], type: 'errors' | 'metrics') {\n    if (!ERROR_MONITORING.endpoint || !ERROR_MONITORING.apiKey) return\n\n    const response = await fetch(ERROR_MONITORING.endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${ERROR_MONITORING.apiKey}`\n      },\n      body: JSON.stringify({\n        type,\n        data,\n        environment: ERROR_MONITORING.environment,\n        timestamp: new Date().toISOString(),\n        sessionId: this.sessionId\n      })\n    })\n\n    if (!response.ok) {\n      throw new Error(`Failed to send ${type} to monitoring service: ${response.statusText}`)\n    }\n  }\n\n  private sendToSentry(error: ErrorEvent) {\n    try {\n      // Set user context if available\n      if (error.userId) {\n        Sentry.setUser({\n          id: error.userId,\n          segment: 'portuguese-community'\n        })\n      }\n\n      // Set Portuguese community context\n      Sentry.setContext('portuguese_community', {\n        feature_context: error.context,\n        language: error.portugueseContext?.language || 'unknown',\n        cultural_feature: error.portugueseContext?.culturalFeature,\n        business_directory_action: error.portugueseContext?.businessDirectoryAction,\n        mobile_device: error.portugueseContext?.mobileDevice || false,\n        character_encoding_issue: error.portugueseContext?.characterEncodingIssue || false\n      })\n\n      // Set additional metadata\n      Sentry.setTags({\n        error_severity: error.severity,\n        error_type: error.type,\n        error_context: error.context,\n        session_id: error.sessionId\n      })\n\n      // Add breadcrumb for error sequence\n      Sentry.addBreadcrumb({\n        message: `Error in ${error.context}`,\n        category: 'error',\n        level: error.severity as any,\n        data: {\n          error_id: error.id,\n          portuguese_context: error.portugueseContext,\n          metadata: error.metadata\n        }\n      })\n\n      // Capture the error\n      if (error.stack) {\n        const sentryError = new Error(error.message)\n        sentryError.stack = error.stack\n        Sentry.captureException(sentryError)\n      } else {\n        Sentry.captureMessage(error.message, error.severity as any)\n      }\n\n    } catch (sentryError) {\n      console.error('Failed to send error to Sentry:', sentryError)\n    }\n  }\n\n  // Public methods for manual tracking\n  trackPortugueseFeatureError(featureContext: keyof typeof PORTUGUESE_ERROR_CONTEXTS, error: Error | string, metadata?: any) {\n    const language = typeof window !== 'undefined' ? \n      (localStorage.getItem('preferred-language') as 'en' | 'pt') || 'en' : 'en'\n\n    // Determine severity based on feature context\n    let severity = ERROR_SEVERITY.HIGH\n    if (featureContext === 'CULTURAL_MATCHING' || featureContext === 'AUTHENTICATION' || featureContext === 'DATABASE') {\n      severity = ERROR_SEVERITY.CRITICAL\n    }\n\n    this.trackError({\n      message: typeof error === 'string' ? error : error.message,\n      type: ErrorType.CLIENT_ERROR,\n      severity,\n      context: PORTUGUESE_ERROR_CONTEXTS[featureContext],\n      stack: typeof error === 'string' ? undefined : error.stack,\n      portugueseContext: {\n        language,\n        culturalFeature: featureContext,\n        mobileDevice: typeof window !== 'undefined' ? /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) : false\n      },\n      metadata\n    })\n  }\n\n  getErrorSummary() {\n    return {\n      totalErrors: this.errorQueue.length,\n      errorsByContext: Array.from(this.errorCounts.entries()).reduce((acc, [key, count]) => {\n        acc[key] = count\n        return acc\n      }, {} as Record<string, number>),\n      criticalErrors: this.errorQueue.filter(e => e.severity === 'critical').length,\n      portugueseRelatedErrors: this.errorQueue.filter(e => e.portugueseContext).length\n    }\n  }\n}\n\n// Global error tracker instance\nexport const errorTracker = new ErrorTracker()\n\n// Export the class for testing\nexport { ErrorTracker }\n"],"names":["ErrorTracker","errorTracker","constructor","errorQueue","performanceQueue","errorCounts","Map","lastFlush","Date","sessionId","generateSessionId","setupErrorCapture","setupPerformanceCapture","setupPeriodicFlush","now","Math","random","toString","substr","window","addEventListener","event","trackError","message","type","ErrorType","CLIENT_ERROR","severity","ERROR_SEVERITY","HIGH","context","stack","error","url","filename","metadata","lineno","colno","reason","observer","PerformanceObserver","list","entry","getEntries","entryType","trackPerformanceMetric","name","value","duration","observe","entryTypes","console","errorData","id","generateErrorId","timestamp","UNKNOWN","MEDIUM","userAgent","navigator","undefined","location","href","userId","portugueseContext","sendToSentry","push","updateErrorCounts","checkAlertThresholds","CRITICAL","flushErrors","metricData","metric","exceedsThreshold","threshold","key","current","get","set","category","Object","values","ERROR_CATEGORIES","find","cat","count","alertThreshold","triggerAlert","MONITORING_ALERTS","criticalErrors","enabled","dispatchEvent","CustomEvent","detail","setInterval","flushMetrics","length","errorsToFlush","ERROR_MONITORING","endpoint","sendToMonitoringService","group","forEach","groupEnd","flushError","unshift","metricsToFlush","status","log","data","apiKey","response","fetch","method","headers","body","JSON","stringify","environment","toISOString","ok","Error","statusText","Sentry","setUser","segment","setContext","feature_context","language","cultural_feature","culturalFeature","business_directory_action","businessDirectoryAction","mobile_device","mobileDevice","character_encoding_issue","characterEncodingIssue","setTags","error_severity","error_type","error_context","session_id","addBreadcrumb","level","error_id","portuguese_context","sentryError","captureException","captureMessage","trackPortugueseFeatureError","featureContext","localStorage","getItem","PORTUGUESE_ERROR_CONTEXTS","test","getErrorSummary","totalErrors","errorsByContext","Array","from","entries","reduce","acc","filter","e","portugueseRelatedErrors"],"mappings":"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"}