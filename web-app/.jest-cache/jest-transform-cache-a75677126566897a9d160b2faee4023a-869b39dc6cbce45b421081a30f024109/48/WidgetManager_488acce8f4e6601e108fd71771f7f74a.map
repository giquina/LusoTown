{"version":3,"sources":["/workspaces/LusoTown/web-app/src/components/WidgetManager.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { Z_INDEX_LAYERS, getMobileWidgetClasses, getWidgetBottomOffset } from '@/config/z-index-layers';\n\n/**\n * Widget Management System Context\n * Centralized positioning and z-index management for all floating widgets\n */\ninterface WidgetManagerContextType {\n  isAppBarVisible: boolean;\n  setAppBarVisible: (visible: boolean) => void;\n  registerWidget: (id: string, type: WidgetType) => void;\n  unregisterWidget: (id: string) => void;\n  getWidgetClasses: (type: WidgetType) => string;\n  getWidgetZIndex: (type: WidgetType) => number;\n  getBottomOffset: (type: WidgetType) => string;\n  activeWidgets: Set<string>;\n}\n\ntype WidgetType = 'chat' | 'activity' | 'fab' | 'notification' | 'appBar';\n\nconst WidgetManagerContext = createContext<WidgetManagerContextType | null>(null);\n\ninterface WidgetManagerProps {\n  children: ReactNode;\n  className?: string;\n}\n\n/**\n * Priority 1 Widget Management System\n * \n * Features:\n * - Centralized z-index hierarchy management\n * - Dynamic widget positioning based on app bar visibility\n * - Mobile-first responsive positioning\n * - Portuguese cultural theming integration\n * - Widget registration system for conflict prevention\n */\nexport function WidgetManager({ children, className = '' }: WidgetManagerProps) {\n  const [isAppBarVisible, setAppBarVisible] = useState(false);\n  const [activeWidgets, setActiveWidgets] = useState<Set<string>>(new Set());\n\n  // Listen for app bar visibility changes\n  useEffect(() => {\n    const handleAppBarShow = () => setAppBarVisible(true);\n    const handleAppBarDismiss = () => setAppBarVisible(false);\n\n    // Listen for custom events from AppDownloadBar\n    window.addEventListener('appDownloadBarShown', handleAppBarShow);\n    window.addEventListener('appDownloadBarDismissed', handleAppBarDismiss);\n\n    // Check initial state\n    const isDismissed = localStorage.getItem('lusotown_app_download_bar_dismissed');\n    const hasShownInSession = sessionStorage.getItem('lusotown_app_download_shown');\n    const shouldShowAppBar = !isDismissed && hasShownInSession === 'true';\n    setAppBarVisible(shouldShowAppBar);\n\n    return () => {\n      window.removeEventListener('appDownloadBarShown', handleAppBarShow);\n      window.removeEventListener('appDownloadBarDismissed', handleAppBarDismiss);\n    };\n  }, []);\n\n  const registerWidget = (id: string, type: WidgetType) => {\n    setActiveWidgets(prev => new Set(prev).add(id));\n  };\n\n  const unregisterWidget = (id: string) => {\n    setActiveWidgets(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(id);\n      return newSet;\n    });\n  };\n\n  const getWidgetClasses = (type: WidgetType): string => {\n    return getMobileWidgetClasses(type, isAppBarVisible);\n  };\n\n  const getWidgetZIndex = (type: WidgetType): number => {\n    const zIndexMap: Record<WidgetType, number> = {\n      appBar: Z_INDEX_LAYERS.appDownloadBar,\n      notification: Z_INDEX_LAYERS.notification,\n      fab: Z_INDEX_LAYERS.fabButton,\n      chat: Z_INDEX_LAYERS.lusoBotWidget,\n      activity: Z_INDEX_LAYERS.liveActivityWidget,\n    };\n\n    return zIndexMap[type] || Z_INDEX_LAYERS.floatingBase;\n  };\n\n  const getBottomOffset = (type: WidgetType): string => {\n    if (type === 'appBar') return '0rem';\n    return getWidgetBottomOffset(type as Exclude<WidgetType, 'appBar'>, isAppBarVisible);\n  };\n\n  const contextValue: WidgetManagerContextType = {\n    isAppBarVisible,\n    setAppBarVisible,\n    registerWidget,\n    unregisterWidget,\n    getWidgetClasses,\n    getWidgetZIndex,\n    getBottomOffset,\n    activeWidgets,\n  };\n\n  return (\n    <WidgetManagerContext.Provider value={contextValue}>\n      <div className={`widget-manager ${className}`}>\n        {children}\n        \n        {/* Widget Debug Information (development only) */}\n        {process.env.NODE_ENV === 'development' && (\n          <div className=\"fixed top-4 left-4 bg-black/80 text-white text-xs p-2 rounded-lg z-[9999] font-mono\">\n            <div>App Bar: {isAppBarVisible ? 'Visible' : 'Hidden'}</div>\n            <div>Active: {activeWidgets.size} widgets</div>\n            <div className=\"text-primary-300\">Z-Index Hierarchy:</div>\n            <div className=\"ml-2 space-y-1\">\n              <div>App Bar: {Z_INDEX_LAYERS.appDownloadBar}</div>\n              <div>Notification: {Z_INDEX_LAYERS.notification}</div>\n              <div>FAB: {Z_INDEX_LAYERS.fabButton}</div>\n              <div>Chat: {Z_INDEX_LAYERS.lusoBotWidget}</div>\n              <div>Activity: {Z_INDEX_LAYERS.liveActivityWidget}</div>\n            </div>\n          </div>\n        )}\n      </div>\n    </WidgetManagerContext.Provider>\n  );\n}\n\n/**\n * Hook to access widget manager context\n */\nexport function useWidgetManager(): WidgetManagerContextType {\n  const context = useContext(WidgetManagerContext);\n  if (!context) {\n    throw new Error('useWidgetManager must be used within a WidgetManager');\n  }\n  return context;\n}\n\n/**\n * Hook for widget registration and positioning\n */\nexport function useWidget(id: string, type: WidgetType) {\n  const manager = useWidgetManager();\n\n  useEffect(() => {\n    manager.registerWidget(id, type);\n    return () => manager.unregisterWidget(id);\n  }, [id, type, manager]);\n\n  return {\n    isAppBarVisible: manager.isAppBarVisible,\n    classes: manager.getWidgetClasses(type),\n    zIndex: manager.getWidgetZIndex(type),\n    bottomOffset: manager.getBottomOffset(type),\n  };\n}\n\n/**\n * Widget positioning utilities component for direct usage\n */\ninterface WidgetPositionerProps {\n  type: WidgetType;\n  id: string;\n  children: ReactNode;\n  className?: string;\n}\n\nexport function WidgetPositioner({ type, id, children, className = '' }: WidgetPositionerProps) {\n  const { classes } = useWidget(id, type);\n\n  return (\n    <div className={`${classes} ${className}`}>\n      {children}\n    </div>\n  );\n}\n\n/**\n * Portuguese-themed widget container with cultural styling\n */\ninterface PortugueseWidgetContainerProps {\n  children: ReactNode;\n  className?: string;\n  variant?: 'primary' | 'secondary' | 'heritage';\n}\n\nexport function PortugueseWidgetContainer({ \n  children, \n  className = '', \n  variant = 'primary' \n}: PortugueseWidgetContainerProps) {\n  const variantClasses = {\n    primary: 'bg-gradient-to-r from-primary-500 to-secondary-500',\n    secondary: 'bg-white border-2 border-primary-200 text-primary-900',\n    heritage: 'bg-gradient-to-br from-green-600 via-red-500 to-yellow-500'\n  };\n\n  return (\n    <div className={`\n      ${variantClasses[variant]} \n      rounded-2xl shadow-lg transition-all duration-300\n      ${className}\n    `}>\n      {children}\n    </div>\n  );\n}\n\nexport default WidgetManager;"],"names":["PortugueseWidgetContainer","WidgetManager","WidgetPositioner","useWidget","useWidgetManager","WidgetManagerContext","createContext","children","className","isAppBarVisible","setAppBarVisible","useState","activeWidgets","setActiveWidgets","Set","useEffect","handleAppBarShow","handleAppBarDismiss","window","addEventListener","isDismissed","localStorage","getItem","hasShownInSession","sessionStorage","shouldShowAppBar","removeEventListener","registerWidget","id","type","prev","add","unregisterWidget","newSet","delete","getWidgetClasses","getMobileWidgetClasses","getWidgetZIndex","zIndexMap","appBar","Z_INDEX_LAYERS","appDownloadBar","notification","fab","fabButton","chat","lusoBotWidget","activity","liveActivityWidget","floatingBase","getBottomOffset","getWidgetBottomOffset","contextValue","Provider","value","div","process","env","NODE_ENV","size","context","useContext","Error","manager","classes","zIndex","bottomOffset","variant","variantClasses","primary","secondary","heritage"],"mappings":"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"}