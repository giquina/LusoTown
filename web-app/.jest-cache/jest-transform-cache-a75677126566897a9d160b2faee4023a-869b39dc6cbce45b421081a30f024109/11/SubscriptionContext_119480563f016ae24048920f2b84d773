ff32f2355a10a969d7003bc3c637e4dc
"use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    SubscriptionProvider: function() {
        return SubscriptionProvider;
    },
    useSubscription: function() {
        return useSubscription;
    }
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _stripejs = require("@stripe/stripe-js");
const _LanguageContext = require("./LanguageContext");
const _auth = require("../lib/auth");
const _supabase = require("../lib/supabase");
const _reacthottoast = /*#__PURE__*/ _interop_require_default(require("react-hot-toast"));
const _routes = require("../config/routes");
const _logger = /*#__PURE__*/ _interop_require_default(require("../utils/logger"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// Initialize Stripe - with fallback for development
const stripePromise = (0, _stripejs.loadStripe)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY || "pk_test_placeholder");
const SubscriptionContext = /*#__PURE__*/ (0, _react.createContext)(undefined);
function SubscriptionProvider({ children }) {
    const { language, t } = (0, _LanguageContext.useLanguage)();
    const [subscription, setSubscription] = (0, _react.useState)(null);
    const [trial, setTrial] = (0, _react.useState)(null);
    const [usage, setUsage] = (0, _react.useState)(null);
    const [isLoading, setIsLoading] = (0, _react.useState)(true);
    const [stripe, setStripe] = (0, _react.useState)(null);
    // Initialize Stripe
    (0, _react.useEffect)(()=>{
        const initializeStripe = async ()=>{
            const stripeInstance = await stripePromise;
            setStripe(stripeInstance);
        };
        initializeStripe();
    }, []);
    // Load subscription status when user changes
    (0, _react.useEffect)(()=>{
        const checkUserSubscription = async ()=>{
            const user = _auth.authService.getCurrentUser();
            if (user && !_auth.authService.isDemoUser()) {
                await checkSubscriptionStatus();
            } else {
                setSubscription(null);
                setTrial(null);
                setIsLoading(false);
            }
        };
        checkUserSubscription();
        // Listen for auth state changes
        const unsubscribe = _auth.authService.onAuthStateChange(checkUserSubscription);
        return unsubscribe;
    }, []);
    const checkSubscriptionStatus = async ()=>{
        setIsLoading(true);
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || _auth.authService.isDemoUser()) {
                setSubscription(null);
                setTrial(null);
                return;
            }
            // Check for active subscription
            const { data: subscriptionData, error: subError } = await _supabase.supabase.from("subscriptions").select("*").eq("user_id", user.id).eq("status", "active").single();
            if (subError && subError.code !== "PGRST116") {
                _logger.default.error("Error fetching subscription:", subError);
            } else if (subscriptionData) {
                setSubscription(subscriptionData);
            }
            // Check for trial status
            const { data: trialData, error: trialError } = await _supabase.supabase.from("subscription_trials").select("*").eq("user_id", user.id).single();
            if (trialError && trialError.code !== "PGRST116") {
                _logger.default.error("Error fetching trial:", trialError);
            } else if (trialData) {
                setTrial(trialData);
            }
        } catch (error) {
            _logger.default.error("Error checking subscription status:", error);
        } finally{
            setIsLoading(false);
        }
    };
    const createSubscription = async (tier = "community", planType = "monthly")=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || _auth.authService.isDemoUser()) {
                throw new Error("User must be logged in to create subscription");
            }
            // Call your backend API to create Stripe checkout session
            const response = await fetch("/api/create-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    userId: user.id,
                    userEmail: user.email,
                    userName: user.name,
                    tier: tier,
                    planType: planType
                })
            });
            if (!response.ok) {
                throw new Error("Failed to create subscription");
            }
            const { sessionId } = await response.json();
            if (!stripe) {
                throw new Error("Stripe not initialized");
            }
            // Redirect to Stripe Checkout
            const { error } = await stripe.redirectToCheckout({
                sessionId
            });
            if (error) {
                _logger.default.error("Stripe checkout error:", error);
                _reacthottoast.default.error(language === "pt" ? "Erro ao processar pagamento. Tente novamente." : "Payment processing error. Please try again.");
                return null;
            }
            return sessionId;
        } catch (error) {
            _logger.default.error("Error creating subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao criar subscri\xe7\xe3o. Tente novamente." : "Error creating subscription. Please try again.");
            return null;
        }
    };
    const cancelSubscription = async ()=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) {
                return false;
            }
            const response = await fetch("/api/cancel-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    subscriptionId: subscription.stripe_subscription_id
                })
            });
            if (!response.ok) {
                throw new Error("Failed to cancel subscription");
            }
            // Refresh subscription status
            await checkSubscriptionStatus();
            _reacthottoast.default.success(language === "pt" ? "Subscri\xe7\xe3o cancelada com sucesso" : "Subscription cancelled successfully");
            return true;
        } catch (error) {
            _logger.default.error("Error cancelling subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao cancelar subscri\xe7\xe3o" : "Error cancelling subscription");
            return false;
        }
    };
    const redirectToSubscription = ()=>{
        window.location.href = _routes.ROUTES.subscription;
    };
    const upgradeSubscription = async (newTier)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) {
                return false;
            }
            const response = await fetch("/api/upgrade-subscription", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    subscriptionId: subscription.stripe_subscription_id,
                    newTier: newTier
                })
            });
            if (!response.ok) {
                throw new Error("Failed to upgrade subscription");
            }
            // Refresh subscription status
            await checkSubscriptionStatus();
            _reacthottoast.default.success(language === "pt" ? "Subscri\xe7\xe3o atualizada com sucesso" : "Subscription upgraded successfully");
            return true;
        } catch (error) {
            _logger.default.error("Error upgrading subscription:", error);
            _reacthottoast.default.error(language === "pt" ? "Erro ao atualizar subscri\xe7\xe3o" : "Error upgrading subscription");
            return false;
        }
    };
    const markTrialAsUsed = async ()=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !trial) return;
            const { error } = await _supabase.supabase.from("subscription_trials").update({
                is_used: true
            }).eq("user_id", user.id);
            if (error) {
                _logger.default.error("Error marking trial as used:", error);
            } else {
                setTrial((prev)=>prev ? {
                        ...prev,
                        is_used: true
                    } : null);
            }
        } catch (error) {
            _logger.default.error("Error marking trial as used:", error);
        }
    };
    const trackMembershipUsage = async (benefitType, serviceType, discountApplied = 0, amountSaved = 0)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user || !subscription) return;
            const { error } = await _supabase.supabase.from("membership_usage").insert({
                user_id: user.id,
                subscription_id: subscription.id,
                benefit_type: benefitType,
                service_type: serviceType,
                discount_applied: discountApplied,
                amount_saved: amountSaved
            });
            if (error) {
                _logger.default.error("Error tracking membership usage:", error);
            }
        } catch (error) {
            _logger.default.error("Error tracking membership usage:", error);
        }
    };
    const trackFeatureUsage = async (feature)=>{
        try {
            const user = _auth.authService.getCurrentUser();
            if (!user) return false;
            // Check current usage limits
            if (!canUseFeature(feature)) {
                return false;
            }
            // Update usage counts
            const today = new Date().toISOString().split("T")[0];
            const currentMonth = new Date().toISOString().substring(0, 7);
            // Start from a strongly-typed baseline and then copy forward allowed counters
            let updatedUsage = {
                dailyMatchesUsed: 0,
                monthlyMessagesUsed: usage?.lastResetDate?.substring(0, 7) === currentMonth ? usage.monthlyMessagesUsed : 0,
                premiumEventsUsed: 0,
                livestreamHoursUsed: 0,
                lastResetDate: today
            };
            // If same day, carry forward today's counters
            if (usage && usage.lastResetDate === today) {
                updatedUsage.dailyMatchesUsed = usage.dailyMatchesUsed;
                updatedUsage.premiumEventsUsed = usage.premiumEventsUsed;
                updatedUsage.livestreamHoursUsed = usage.livestreamHoursUsed;
            }
            // Increment the specific counter
            switch(feature){
                case "match":
                    updatedUsage.dailyMatchesUsed++;
                    break;
                case "message":
                    updatedUsage.monthlyMessagesUsed++;
                    break;
                case "premium_event":
                    updatedUsage.premiumEventsUsed++;
                    break;
                case "livestream":
                    updatedUsage.livestreamHoursUsed++;
                    break;
            }
            // Save to database
            const { error } = await _supabase.supabase.from("subscription_usage").upsert({
                user_id: user.id,
                ...updatedUsage
            });
            if (error) {
                _logger.default.error("Error tracking feature usage:", error);
                return false;
            }
            setUsage(updatedUsage);
            return true;
        } catch (error) {
            _logger.default.error("Error tracking feature usage:", error);
            return false;
        }
    };
    const validateStudentStatus = async (studentEmail, universityId)=>{
        try {
            const response = await fetch("/api/validate-student", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    email: studentEmail,
                    universityId: universityId
                })
            });
            if (!response.ok) {
                return false;
            }
            const { isValid } = await response.json();
            return isValid;
        } catch (error) {
            _logger.default.error("Error validating student status:", error);
            return false;
        }
    };
    // Helper function to check feature usage
    const canUseFeature = (feature)=>{
        if (usageLimits.hasUnlimitedAccess) return true;
        if (!usage) return true // First time usage
        ;
        const today = new Date().toISOString().split("T")[0];
        const currentMonth = new Date().toISOString().substring(0, 7);
        // Reset counters if needed
        const dailyReset = usage.lastResetDate !== today;
        const monthlyReset = usage.lastResetDate.substring(0, 7) !== currentMonth;
        switch(feature){
            case "match":
                const dailyMatches = dailyReset ? 0 : usage.dailyMatchesUsed;
                return dailyMatches < usageLimits.dailyMatches;
            case "message":
                const monthlyMessages = monthlyReset ? 0 : usage.monthlyMessagesUsed;
                return monthlyMessages < usageLimits.monthlyMessages;
            case "premium_event":
                return usage.premiumEventsUsed < usageLimits.premiumEvents;
            case "livestream":
                return usage.livestreamHoursUsed < usageLimits.livestreamHours;
            default:
                return false;
        }
    };
    // Computed values
    const hasActiveSubscription = Boolean(subscription && subscription.status === "active" && subscription.current_period_end && new Date(subscription.current_period_end) > new Date());
    const isInTrial = Boolean(trial && !trial.is_used && new Date(trial.trial_end) > new Date());
    const trialDaysRemaining = trial && !trial.is_used ? Math.max(0, Math.ceil((new Date(trial.trial_end).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))) : 0;
    // Subscription is required for all users except demo users
    const subscriptionRequired = !_auth.authService.isDemoUser() && !hasActiveSubscription && !isInTrial;
    // Get current membership tier
    const membershipTier = hasActiveSubscription && subscription?.tier ? subscription.tier : "none";
    // Normalize to an effective tier for limits/discounts
    const effectiveTier = membershipTier === "none" ? "free" : membershipTier;
    // Calculate service discount based on tier - Portuguese-speaking community optimized
    const serviceDiscount = (()=>{
        switch(effectiveTier){
            case "community":
                return 10 // 10% member discount
                ;
            case "ambassador":
                return 20 // 20% ambassador discount  
                ;
            case "familia":
                return 15 // 15% family discount
                ;
            default:
                return 0;
        }
    })();
    // Usage limits based on tier - Optimized for Portuguese-speaking community conversion
    const usageLimits = (()=>{
        switch(effectiveTier){
            case "free":
                return {
                    dailyMatches: 2,
                    monthlyMessages: 3,
                    premiumEvents: 0,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
            case "community":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
            case "ambassador":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 5,
                    hasUnlimitedAccess: false // Limited streaming hours, not unlimited
                };
            case "familia":
                return {
                    dailyMatches: -1,
                    monthlyMessages: -1,
                    premiumEvents: -1,
                    livestreamHours: 3,
                    hasUnlimitedAccess: false // Family-appropriate limitations
                };
            default:
                return {
                    dailyMatches: 2,
                    monthlyMessages: 3,
                    premiumEvents: 0,
                    livestreamHours: 0,
                    hasUnlimitedAccess: false
                };
        }
    })();
    // Feature access functions
    const canSendMessage = ()=>{
        return canUseFeature("message");
    };
    const canCreateMatch = ()=>{
        return canUseFeature("match");
    };
    const canAccessPremiumEvent = ()=>{
        return canUseFeature("premium_event");
    };
    const canAccessLivestream = ()=>{
        return canUseFeature("livestream");
    };
    const getRemainingMatches = ()=>{
        if (usageLimits.hasUnlimitedAccess || usageLimits.dailyMatches === -1) return -1;
        const today = new Date().toISOString().split("T")[0];
        const dailyUsed = usage?.lastResetDate === today ? usage.dailyMatchesUsed : 0;
        return Math.max(0, usageLimits.dailyMatches - dailyUsed);
    };
    const getRemainingMessages = ()=>{
        if (usageLimits.hasUnlimitedAccess || usageLimits.monthlyMessages === -1) return -1;
        const currentMonth = new Date().toISOString().substring(0, 7);
        const monthlyUsed = usage?.lastResetDate?.substring(0, 7) === currentMonth ? usage.monthlyMessagesUsed : 0;
        return Math.max(0, usageLimits.monthlyMessages - monthlyUsed);
    };
    const value = {
        subscription,
        trial,
        usage,
        isLoading,
        hasActiveSubscription,
        isInTrial,
        trialDaysRemaining,
        subscriptionRequired,
        stripe,
        membershipTier,
        serviceDiscount,
        usageLimits,
        canSendMessage,
        canCreateMatch,
        canAccessPremiumEvent,
        canAccessLivestream,
        getRemainingMatches,
        getRemainingMessages,
        checkSubscriptionStatus,
        createSubscription,
        upgradeSubscription,
        cancelSubscription,
        redirectToSubscription,
        markTrialAsUsed,
        trackMembershipUsage,
        trackFeatureUsage,
        validateStudentStatus
    };
    return /*#__PURE__*/ (0, _jsxruntime.jsx)(SubscriptionContext.Provider, {
        value: value,
        children: children
    });
}
function useSubscription() {
    const context = (0, _react.useContext)(SubscriptionContext);
    if (context === undefined) {
        throw new Error("useSubscription must be used within a SubscriptionProvider");
    }
    return context;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL0x1c29Ub3duL3dlYi1hcHAvc3JjL2NvbnRleHQvU3Vic2NyaXB0aW9uQ29udGV4dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBjbGllbnQnXG5cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGxvYWRTdHJpcGUsIFN0cmlwZSB9IGZyb20gJ0BzdHJpcGUvc3RyaXBlLWpzJ1xuaW1wb3J0IHsgdXNlTGFuZ3VhZ2UgfSBmcm9tICcuL0xhbmd1YWdlQ29udGV4dCdcbmltcG9ydCB7IGF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9saWIvYXV0aCdcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnXG5pbXBvcnQgdG9hc3QgZnJvbSAncmVhY3QtaG90LXRvYXN0J1xuaW1wb3J0IHsgUk9VVEVTIH0gZnJvbSAnQC9jb25maWcvcm91dGVzJ1xuaW1wb3J0IGxvZ2dlciBmcm9tICdAL3V0aWxzL2xvZ2dlcidcblxuLy8gSW5pdGlhbGl6ZSBTdHJpcGUgLSB3aXRoIGZhbGxiYWNrIGZvciBkZXZlbG9wbWVudFxuY29uc3Qgc3RyaXBlUHJvbWlzZSA9IGxvYWRTdHJpcGUocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1RSSVBFX1BVQkxJU0hBQkxFX0tFWSB8fCAncGtfdGVzdF9wbGFjZWhvbGRlcicpXG5cbmV4cG9ydCBpbnRlcmZhY2UgU3Vic2NyaXB0aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICB1c2VyX2lkOiBzdHJpbmdcbiAgc3RyaXBlX3N1YnNjcmlwdGlvbl9pZD86IHN0cmluZ1xuICBzdHJpcGVfY3VzdG9tZXJfaWQ/OiBzdHJpbmdcbiAgc3RhdHVzOiAnYWN0aXZlJyB8ICdpbmFjdGl2ZScgfCAnY2FuY2VsbGVkJyB8ICdwYXN0X2R1ZScgfCAndHJpYWxpbmcnXG4gIHBsYW5fdHlwZTogJ21vbnRobHknIHwgJ3llYXJseSdcbiAgdGllcjogJ2ZyZWUnIHwgJ2NvbW11bml0eScgfCAnYW1iYXNzYWRvcicgfCAnZmFtaWxpYSdcbiAgY3VycmVudF9wZXJpb2Rfc3RhcnQ/OiBzdHJpbmdcbiAgY3VycmVudF9wZXJpb2RfZW5kPzogc3RyaW5nXG4gIHRyaWFsX2VuZD86IHN0cmluZ1xuICBhbW91bnQ6IG51bWJlclxuICBjdXJyZW5jeTogc3RyaW5nXG4gIHN0dWRlbnRfdmVyaWZpZWQ/OiBib29sZWFuXG4gIGNvcnBvcmF0ZV9hY2NvdW50X2lkPzogc3RyaW5nXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZ1xuICB1cGRhdGVkX2F0OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25UcmlhbCB7XG4gIGlkOiBzdHJpbmdcbiAgdXNlcl9pZDogc3RyaW5nXG4gIHRyaWFsX3N0YXJ0OiBzdHJpbmdcbiAgdHJpYWxfZW5kOiBzdHJpbmdcbiAgaXNfdXNlZDogYm9vbGVhblxuICBjcmVhdGVkX2F0OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25Vc2FnZUxpbWl0cyB7XG4gIGRhaWx5TWF0Y2hlczogbnVtYmVyXG4gIG1vbnRobHlNZXNzYWdlczogbnVtYmVyXG4gIHByZW1pdW1FdmVudHM6IG51bWJlclxuICBsaXZlc3RyZWFtSG91cnM6IG51bWJlclxuICBoYXNVbmxpbWl0ZWRBY2Nlc3M6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25Vc2FnZSB7XG4gIGRhaWx5TWF0Y2hlc1VzZWQ6IG51bWJlclxuICBtb250aGx5TWVzc2FnZXNVc2VkOiBudW1iZXJcbiAgcHJlbWl1bUV2ZW50c1VzZWQ6IG51bWJlclxuICBsaXZlc3RyZWFtSG91cnNVc2VkOiBudW1iZXJcbiAgbGFzdFJlc2V0RGF0ZTogc3RyaW5nXG59XG5cbmludGVyZmFjZSBTdWJzY3JpcHRpb25Db250ZXh0VHlwZSB7XG4gIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uIHwgbnVsbFxuICB0cmlhbDogU3Vic2NyaXB0aW9uVHJpYWwgfCBudWxsXG4gIHVzYWdlOiBTdWJzY3JpcHRpb25Vc2FnZSB8IG51bGxcbiAgaXNMb2FkaW5nOiBib29sZWFuXG4gIGhhc0FjdGl2ZVN1YnNjcmlwdGlvbjogYm9vbGVhblxuICBpc0luVHJpYWw6IGJvb2xlYW5cbiAgdHJpYWxEYXlzUmVtYWluaW5nOiBudW1iZXJcbiAgc3Vic2NyaXB0aW9uUmVxdWlyZWQ6IGJvb2xlYW5cbiAgc3RyaXBlOiBTdHJpcGUgfCBudWxsXG4gIG1lbWJlcnNoaXBUaWVyOiAnbm9uZScgfCAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyB8ICdmYW1pbGlhJ1xuICBzZXJ2aWNlRGlzY291bnQ6IG51bWJlclxuICB1c2FnZUxpbWl0czogU3Vic2NyaXB0aW9uVXNhZ2VMaW1pdHNcbiAgXG4gIC8vIEZlYXR1cmUgYWNjZXNzXG4gIGNhblNlbmRNZXNzYWdlOiAoKSA9PiBib29sZWFuXG4gIGNhbkNyZWF0ZU1hdGNoOiAoKSA9PiBib29sZWFuXG4gIGNhbkFjY2Vzc1ByZW1pdW1FdmVudDogKCkgPT4gYm9vbGVhblxuICBjYW5BY2Nlc3NMaXZlc3RyZWFtOiAoKSA9PiBib29sZWFuXG4gIGdldFJlbWFpbmluZ01hdGNoZXM6ICgpID0+IG51bWJlclxuICBnZXRSZW1haW5pbmdNZXNzYWdlczogKCkgPT4gbnVtYmVyXG4gIFxuICAvLyBBY3Rpb25zXG4gIGNoZWNrU3Vic2NyaXB0aW9uU3RhdHVzOiAoKSA9PiBQcm9taXNlPHZvaWQ+XG4gIGNyZWF0ZVN1YnNjcmlwdGlvbjogKHRpZXI/OiAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyB8ICdmYW1pbGlhJywgcGxhblR5cGU/OiAnbW9udGhseScgfCAneWVhcmx5JykgPT4gUHJvbWlzZTxzdHJpbmcgfCBudWxsPlxuICB1cGdyYWRlU3Vic2NyaXB0aW9uOiAobmV3VGllcjogJ2ZyZWUnIHwgJ2NvbW11bml0eScgfCAnYW1iYXNzYWRvcicgfCAnZmFtaWxpYScpID0+IFByb21pc2U8Ym9vbGVhbj5cbiAgY2FuY2VsU3Vic2NyaXB0aW9uOiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+XG4gIHJlZGlyZWN0VG9TdWJzY3JpcHRpb246ICgpID0+IHZvaWRcbiAgbWFya1RyaWFsQXNVc2VkOiAoKSA9PiBQcm9taXNlPHZvaWQ+XG4gIHRyYWNrTWVtYmVyc2hpcFVzYWdlOiAoYmVuZWZpdFR5cGU6IHN0cmluZywgc2VydmljZVR5cGU6IHN0cmluZywgZGlzY291bnRBcHBsaWVkPzogbnVtYmVyLCBhbW91bnRTYXZlZD86IG51bWJlcikgPT4gUHJvbWlzZTx2b2lkPlxuICB0cmFja0ZlYXR1cmVVc2FnZTogKGZlYXR1cmU6ICdtYXRjaCcgfCAnbWVzc2FnZScgfCAncHJlbWl1bV9ldmVudCcgfCAnbGl2ZXN0cmVhbScpID0+IFByb21pc2U8Ym9vbGVhbj5cbiAgdmFsaWRhdGVTdHVkZW50U3RhdHVzOiAoc3R1ZGVudEVtYWlsOiBzdHJpbmcsIHVuaXZlcnNpdHlJZDogc3RyaW5nKSA9PiBQcm9taXNlPGJvb2xlYW4+XG59XG5cbmNvbnN0IFN1YnNjcmlwdGlvbkNvbnRleHQgPSBjcmVhdGVDb250ZXh0PFN1YnNjcmlwdGlvbkNvbnRleHRUeXBlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpXG5cbmludGVyZmFjZSBTdWJzY3JpcHRpb25Qcm92aWRlclByb3BzIHtcbiAgY2hpbGRyZW46IFJlYWN0Tm9kZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gU3Vic2NyaXB0aW9uUHJvdmlkZXIoeyBjaGlsZHJlbiB9OiBTdWJzY3JpcHRpb25Qcm92aWRlclByb3BzKSB7XG4gIGNvbnN0IHsgbGFuZ3VhZ2UsIHQgfSA9IHVzZUxhbmd1YWdlKClcbiAgY29uc3QgW3N1YnNjcmlwdGlvbiwgc2V0U3Vic2NyaXB0aW9uXSA9IHVzZVN0YXRlPFN1YnNjcmlwdGlvbiB8IG51bGw+KG51bGwpXG4gIGNvbnN0IFt0cmlhbCwgc2V0VHJpYWxdID0gdXNlU3RhdGU8U3Vic2NyaXB0aW9uVHJpYWwgfCBudWxsPihudWxsKVxuICBjb25zdCBbdXNhZ2UsIHNldFVzYWdlXSA9IHVzZVN0YXRlPFN1YnNjcmlwdGlvblVzYWdlIHwgbnVsbD4obnVsbClcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpXG4gIGNvbnN0IFtzdHJpcGUsIHNldFN0cmlwZV0gPSB1c2VTdGF0ZTxTdHJpcGUgfCBudWxsPihudWxsKVxuXG4gIC8vIEluaXRpYWxpemUgU3RyaXBlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaW5pdGlhbGl6ZVN0cmlwZSA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0cmlwZUluc3RhbmNlID0gYXdhaXQgc3RyaXBlUHJvbWlzZVxuICAgICAgc2V0U3RyaXBlKHN0cmlwZUluc3RhbmNlKVxuICAgIH1cbiAgICBpbml0aWFsaXplU3RyaXBlKClcbiAgfSwgW10pXG5cbiAgLy8gTG9hZCBzdWJzY3JpcHRpb24gc3RhdHVzIHdoZW4gdXNlciBjaGFuZ2VzXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgY2hlY2tVc2VyU3Vic2NyaXB0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIGlmICh1c2VyICYmICFhdXRoU2VydmljZS5pc0RlbW9Vc2VyKCkpIHtcbiAgICAgICAgYXdhaXQgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXMoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0U3Vic2NyaXB0aW9uKG51bGwpXG4gICAgICAgIHNldFRyaWFsKG51bGwpXG4gICAgICAgIHNldElzTG9hZGluZyhmYWxzZSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjaGVja1VzZXJTdWJzY3JpcHRpb24oKVxuXG4gICAgLy8gTGlzdGVuIGZvciBhdXRoIHN0YXRlIGNoYW5nZXNcbiAgICBjb25zdCB1bnN1YnNjcmliZSA9IGF1dGhTZXJ2aWNlLm9uQXV0aFN0YXRlQ2hhbmdlKGNoZWNrVXNlclN1YnNjcmlwdGlvbilcbiAgICByZXR1cm4gdW5zdWJzY3JpYmVcbiAgfSwgW10pXG5cbiAgY29uc3QgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXMgPSBhc3luYyAoKSA9PiB7XG4gICAgc2V0SXNMb2FkaW5nKHRydWUpXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgYXV0aFNlcnZpY2UuaXNEZW1vVXNlcigpKSB7XG4gICAgICAgIHNldFN1YnNjcmlwdGlvbihudWxsKVxuICAgICAgICBzZXRUcmlhbChudWxsKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIGFjdGl2ZSBzdWJzY3JpcHRpb25cbiAgICAgIGNvbnN0IHsgZGF0YTogc3Vic2NyaXB0aW9uRGF0YSwgZXJyb3I6IHN1YkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnc3Vic2NyaXB0aW9ucycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgICAuc2luZ2xlKClcblxuICAgICAgaWYgKHN1YkVycm9yICYmIHN1YkVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdWJzY3JpcHRpb246Jywgc3ViRXJyb3IpXG4gICAgICB9IGVsc2UgaWYgKHN1YnNjcmlwdGlvbkRhdGEpIHtcbiAgICAgICAgc2V0U3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbkRhdGEpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciB0cmlhbCBzdGF0dXNcbiAgICAgIGNvbnN0IHsgZGF0YTogdHJpYWxEYXRhLCBlcnJvcjogdHJpYWxFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbl90cmlhbHMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZClcbiAgICAgICAgLnNpbmdsZSgpXG5cbiAgICAgIGlmICh0cmlhbEVycm9yICYmIHRyaWFsRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHRyaWFsOicsIHRyaWFsRXJyb3IpXG4gICAgICB9IGVsc2UgaWYgKHRyaWFsRGF0YSkge1xuICAgICAgICBzZXRUcmlhbCh0cmlhbERhdGEpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY2hlY2tpbmcgc3Vic2NyaXB0aW9uIHN0YXR1czonLCBlcnJvcilcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNyZWF0ZVN1YnNjcmlwdGlvbiA9IGFzeW5jIChcbiAgICB0aWVyOiAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyB8ICdmYW1pbGlhJyA9ICdjb21tdW5pdHknLFxuICAgIHBsYW5UeXBlOiAnbW9udGhseScgfCAneWVhcmx5JyA9ICdtb250aGx5J1xuICApOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIGlmICghdXNlciB8fCBhdXRoU2VydmljZS5pc0RlbW9Vc2VyKCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG11c3QgYmUgbG9nZ2VkIGluIHRvIGNyZWF0ZSBzdWJzY3JpcHRpb24nKVxuICAgICAgfVxuXG4gICAgICAvLyBDYWxsIHlvdXIgYmFja2VuZCBBUEkgdG8gY3JlYXRlIFN0cmlwZSBjaGVja291dCBzZXNzaW9uXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NyZWF0ZS1zdWJzY3JpcHRpb24nLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgdXNlck5hbWU6IHVzZXIubmFtZSxcbiAgICAgICAgICB0aWVyOiB0aWVyLFxuICAgICAgICAgIHBsYW5UeXBlOiBwbGFuVHlwZSxcbiAgICAgICAgfSksXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBzdWJzY3JpcHRpb24nKVxuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHNlc3Npb25JZCB9ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgICBcbiAgICAgIGlmICghc3RyaXBlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignU3RyaXBlIG5vdCBpbml0aWFsaXplZCcpXG4gICAgICB9XG5cbiAgICAgIC8vIFJlZGlyZWN0IHRvIFN0cmlwZSBDaGVja291dFxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3RyaXBlLnJlZGlyZWN0VG9DaGVja291dCh7XG4gICAgICAgIHNlc3Npb25JZCxcbiAgICAgIH0pXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1N0cmlwZSBjaGVja291dCBlcnJvcjonLCBlcnJvcilcbiAgICAgICAgdG9hc3QuZXJyb3IoXG4gICAgICAgICAgbGFuZ3VhZ2UgPT09ICdwdCcgXG4gICAgICAgICAgICA/ICdFcnJvIGFvIHByb2Nlc3NhciBwYWdhbWVudG8uIFRlbnRlIG5vdmFtZW50ZS4nIFxuICAgICAgICAgICAgOiAnUGF5bWVudCBwcm9jZXNzaW5nIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLidcbiAgICAgICAgKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2Vzc2lvbklkXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY3JlYXRpbmcgc3Vic2NyaXB0aW9uOicsIGVycm9yKVxuICAgICAgdG9hc3QuZXJyb3IoXG4gICAgICAgIGxhbmd1YWdlID09PSAncHQnIFxuICAgICAgICAgID8gJ0Vycm8gYW8gY3JpYXIgc3Vic2NyacOnw6NvLiBUZW50ZSBub3ZhbWVudGUuJyBcbiAgICAgICAgICA6ICdFcnJvciBjcmVhdGluZyBzdWJzY3JpcHRpb24uIFBsZWFzZSB0cnkgYWdhaW4uJ1xuICAgICAgKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICBjb25zdCBjYW5jZWxTdWJzY3JpcHRpb24gPSBhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgIXN1YnNjcmlwdGlvbikge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS9jYW5jZWwtc3Vic2NyaXB0aW9uJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogc3Vic2NyaXB0aW9uLnN0cmlwZV9zdWJzY3JpcHRpb25faWQsXG4gICAgICAgIH0pLFxuICAgICAgfSlcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjYW5jZWwgc3Vic2NyaXB0aW9uJylcbiAgICAgIH1cblxuICAgICAgLy8gUmVmcmVzaCBzdWJzY3JpcHRpb24gc3RhdHVzXG4gICAgICBhd2FpdCBjaGVja1N1YnNjcmlwdGlvblN0YXR1cygpXG4gICAgICBcbiAgICAgIHRvYXN0LnN1Y2Nlc3MoXG4gICAgICAgIGxhbmd1YWdlID09PSAncHQnIFxuICAgICAgICAgID8gJ1N1YnNjcmnDp8OjbyBjYW5jZWxhZGEgY29tIHN1Y2Vzc28nIFxuICAgICAgICAgIDogJ1N1YnNjcmlwdGlvbiBjYW5jZWxsZWQgc3VjY2Vzc2Z1bGx5J1xuICAgICAgKVxuICAgICAgXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNhbmNlbGxpbmcgc3Vic2NyaXB0aW9uOicsIGVycm9yKVxuICAgICAgdG9hc3QuZXJyb3IoXG4gICAgICAgIGxhbmd1YWdlID09PSAncHQnIFxuICAgICAgICAgID8gJ0Vycm8gYW8gY2FuY2VsYXIgc3Vic2NyacOnw6NvJyBcbiAgICAgICAgICA6ICdFcnJvciBjYW5jZWxsaW5nIHN1YnNjcmlwdGlvbidcbiAgICAgIClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHJlZGlyZWN0VG9TdWJzY3JpcHRpb24gPSAoKSA9PiB7XG4gIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gUk9VVEVTLnN1YnNjcmlwdGlvblxuICB9XG5cbiAgY29uc3QgdXBncmFkZVN1YnNjcmlwdGlvbiA9IGFzeW5jIChuZXdUaWVyOiAnZnJlZScgfCAnY29tbXVuaXR5JyB8ICdhbWJhc3NhZG9yJyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKVxuICAgICAgaWYgKCF1c2VyIHx8ICFzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvdXBncmFkZS1zdWJzY3JpcHRpb24nLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiBzdWJzY3JpcHRpb24uc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCxcbiAgICAgICAgICBuZXdUaWVyOiBuZXdUaWVyLFxuICAgICAgICB9KSxcbiAgICAgIH0pXG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gdXBncmFkZSBzdWJzY3JpcHRpb24nKVxuICAgICAgfVxuXG4gICAgICAvLyBSZWZyZXNoIHN1YnNjcmlwdGlvbiBzdGF0dXNcbiAgICAgIGF3YWl0IGNoZWNrU3Vic2NyaXB0aW9uU3RhdHVzKClcbiAgICAgIFxuICAgICAgdG9hc3Quc3VjY2VzcyhcbiAgICAgICAgbGFuZ3VhZ2UgPT09ICdwdCcgXG4gICAgICAgICAgPyAnU3Vic2NyacOnw6NvIGF0dWFsaXphZGEgY29tIHN1Y2Vzc28nIFxuICAgICAgICAgIDogJ1N1YnNjcmlwdGlvbiB1cGdyYWRlZCBzdWNjZXNzZnVsbHknXG4gICAgICApXG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgdXBncmFkaW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcilcbiAgICAgIHRvYXN0LmVycm9yKFxuICAgICAgICBsYW5ndWFnZSA9PT0gJ3B0JyBcbiAgICAgICAgICA/ICdFcnJvIGFvIGF0dWFsaXphciBzdWJzY3Jpw6fDo28nIFxuICAgICAgICAgIDogJ0Vycm9yIHVwZ3JhZGluZyBzdWJzY3JpcHRpb24nXG4gICAgICApXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBjb25zdCBtYXJrVHJpYWxBc1VzZWQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgIXRyaWFsKSByZXR1cm5cblxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbl90cmlhbHMnKVxuICAgICAgICAudXBkYXRlKHsgaXNfdXNlZDogdHJ1ZSB9KVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBtYXJraW5nIHRyaWFsIGFzIHVzZWQ6JywgZXJyb3IpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRUcmlhbChwcmV2ID0+IHByZXYgPyB7IC4uLnByZXYsIGlzX3VzZWQ6IHRydWUgfSA6IG51bGwpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgbWFya2luZyB0cmlhbCBhcyB1c2VkOicsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRyYWNrTWVtYmVyc2hpcFVzYWdlID0gYXN5bmMgKFxuICAgIGJlbmVmaXRUeXBlOiBzdHJpbmcsIFxuICAgIHNlcnZpY2VUeXBlOiBzdHJpbmcsIFxuICAgIGRpc2NvdW50QXBwbGllZDogbnVtYmVyID0gMCwgXG4gICAgYW1vdW50U2F2ZWQ6IG51bWJlciA9IDBcbiAgKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIgfHwgIXN1YnNjcmlwdGlvbikgcmV0dXJuXG5cbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdtZW1iZXJzaGlwX3VzYWdlJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICBzdWJzY3JpcHRpb25faWQ6IHN1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgICBiZW5lZml0X3R5cGU6IGJlbmVmaXRUeXBlLFxuICAgICAgICAgIHNlcnZpY2VfdHlwZTogc2VydmljZVR5cGUsXG4gICAgICAgICAgZGlzY291bnRfYXBwbGllZDogZGlzY291bnRBcHBsaWVkLFxuICAgICAgICAgIGFtb3VudF9zYXZlZDogYW1vdW50U2F2ZWQsXG4gICAgICAgIH0pXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIG1lbWJlcnNoaXAgdXNhZ2U6JywgZXJyb3IpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgdHJhY2tpbmcgbWVtYmVyc2hpcCB1c2FnZTonLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICBjb25zdCB0cmFja0ZlYXR1cmVVc2FnZSA9IGFzeW5jIChmZWF0dXJlOiAnbWF0Y2gnIHwgJ21lc3NhZ2UnIHwgJ3ByZW1pdW1fZXZlbnQnIHwgJ2xpdmVzdHJlYW0nKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBmYWxzZVxuXG4gICAgICAvLyBDaGVjayBjdXJyZW50IHVzYWdlIGxpbWl0c1xuICAgICAgaWYgKCFjYW5Vc2VGZWF0dXJlKGZlYXR1cmUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgdXNhZ2UgY291bnRzXG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgICBjb25zdCBjdXJyZW50TW9udGggPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDcpXG4gICAgICBcbiAgICAgIC8vIFN0YXJ0IGZyb20gYSBzdHJvbmdseS10eXBlZCBiYXNlbGluZSBhbmQgdGhlbiBjb3B5IGZvcndhcmQgYWxsb3dlZCBjb3VudGVyc1xuICAgICAgbGV0IHVwZGF0ZWRVc2FnZTogU3Vic2NyaXB0aW9uVXNhZ2UgPSB7XG4gICAgICAgIGRhaWx5TWF0Y2hlc1VzZWQ6IDAsXG4gICAgICAgIG1vbnRobHlNZXNzYWdlc1VzZWQ6XG4gICAgICAgICAgdXNhZ2U/Lmxhc3RSZXNldERhdGU/LnN1YnN0cmluZygwLCA3KSA9PT0gY3VycmVudE1vbnRoID8gdXNhZ2UhLm1vbnRobHlNZXNzYWdlc1VzZWQgOiAwLFxuICAgICAgICBwcmVtaXVtRXZlbnRzVXNlZDogMCxcbiAgICAgICAgbGl2ZXN0cmVhbUhvdXJzVXNlZDogMCxcbiAgICAgICAgbGFzdFJlc2V0RGF0ZTogdG9kYXksXG4gICAgICB9XG5cbiAgICAgIC8vIElmIHNhbWUgZGF5LCBjYXJyeSBmb3J3YXJkIHRvZGF5J3MgY291bnRlcnNcbiAgICAgIGlmICh1c2FnZSAmJiB1c2FnZS5sYXN0UmVzZXREYXRlID09PSB0b2RheSkge1xuICAgICAgICB1cGRhdGVkVXNhZ2UuZGFpbHlNYXRjaGVzVXNlZCA9IHVzYWdlLmRhaWx5TWF0Y2hlc1VzZWRcbiAgICAgICAgdXBkYXRlZFVzYWdlLnByZW1pdW1FdmVudHNVc2VkID0gdXNhZ2UucHJlbWl1bUV2ZW50c1VzZWRcbiAgICAgICAgdXBkYXRlZFVzYWdlLmxpdmVzdHJlYW1Ib3Vyc1VzZWQgPSB1c2FnZS5saXZlc3RyZWFtSG91cnNVc2VkXG4gICAgICB9XG5cbiAgICAgIC8vIEluY3JlbWVudCB0aGUgc3BlY2lmaWMgY291bnRlclxuICAgICAgc3dpdGNoIChmZWF0dXJlKSB7XG4gICAgICAgIGNhc2UgJ21hdGNoJzpcbiAgICAgICAgICB1cGRhdGVkVXNhZ2UuZGFpbHlNYXRjaGVzVXNlZCsrXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAnbWVzc2FnZSc6XG4gICAgICAgICAgdXBkYXRlZFVzYWdlLm1vbnRobHlNZXNzYWdlc1VzZWQrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ3ByZW1pdW1fZXZlbnQnOlxuICAgICAgICAgIHVwZGF0ZWRVc2FnZS5wcmVtaXVtRXZlbnRzVXNlZCsrXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAnbGl2ZXN0cmVhbSc6XG4gICAgICAgICAgdXBkYXRlZFVzYWdlLmxpdmVzdHJlYW1Ib3Vyc1VzZWQrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIC8vIFNhdmUgdG8gZGF0YWJhc2VcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25fdXNhZ2UnKVxuICAgICAgICAudXBzZXJ0KHtcbiAgICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLFxuICAgICAgICAgIC4uLnVwZGF0ZWRVc2FnZVxuICAgICAgICB9KVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciB0cmFja2luZyBmZWF0dXJlIHVzYWdlOicsIGVycm9yKVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICBzZXRVc2FnZSh1cGRhdGVkVXNhZ2UpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHRyYWNraW5nIGZlYXR1cmUgdXNhZ2U6JywgZXJyb3IpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBjb25zdCB2YWxpZGF0ZVN0dWRlbnRTdGF0dXMgPSBhc3luYyAoc3R1ZGVudEVtYWlsOiBzdHJpbmcsIHVuaXZlcnNpdHlJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvdmFsaWRhdGUtc3R1ZGVudCcsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZW1haWw6IHN0dWRlbnRFbWFpbCxcbiAgICAgICAgICB1bml2ZXJzaXR5SWQ6IHVuaXZlcnNpdHlJZCxcbiAgICAgICAgfSksXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGlzVmFsaWQgfSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgcmV0dXJuIGlzVmFsaWRcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciB2YWxpZGF0aW5nIHN0dWRlbnQgc3RhdHVzOicsIGVycm9yKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGZlYXR1cmUgdXNhZ2VcbiAgY29uc3QgY2FuVXNlRmVhdHVyZSA9IChmZWF0dXJlOiAnbWF0Y2gnIHwgJ21lc3NhZ2UnIHwgJ3ByZW1pdW1fZXZlbnQnIHwgJ2xpdmVzdHJlYW0nKTogYm9vbGVhbiA9PiB7XG4gICAgaWYgKHVzYWdlTGltaXRzLmhhc1VubGltaXRlZEFjY2VzcykgcmV0dXJuIHRydWVcbiAgICBpZiAoIXVzYWdlKSByZXR1cm4gdHJ1ZSAvLyBGaXJzdCB0aW1lIHVzYWdlXG5cbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCA3KVxuICAgIFxuICAgIC8vIFJlc2V0IGNvdW50ZXJzIGlmIG5lZWRlZFxuICAgIGNvbnN0IGRhaWx5UmVzZXQgPSB1c2FnZS5sYXN0UmVzZXREYXRlICE9PSB0b2RheVxuICAgIGNvbnN0IG1vbnRobHlSZXNldCA9IHVzYWdlLmxhc3RSZXNldERhdGUuc3Vic3RyaW5nKDAsIDcpICE9PSBjdXJyZW50TW9udGhcblxuICAgIHN3aXRjaCAoZmVhdHVyZSkge1xuICAgICAgY2FzZSAnbWF0Y2gnOlxuICAgICAgICBjb25zdCBkYWlseU1hdGNoZXMgPSBkYWlseVJlc2V0ID8gMCA6IHVzYWdlLmRhaWx5TWF0Y2hlc1VzZWRcbiAgICAgICAgcmV0dXJuIGRhaWx5TWF0Y2hlcyA8IHVzYWdlTGltaXRzLmRhaWx5TWF0Y2hlc1xuICAgICAgY2FzZSAnbWVzc2FnZSc6XG4gICAgICAgIGNvbnN0IG1vbnRobHlNZXNzYWdlcyA9IG1vbnRobHlSZXNldCA/IDAgOiB1c2FnZS5tb250aGx5TWVzc2FnZXNVc2VkXG4gICAgICAgIHJldHVybiBtb250aGx5TWVzc2FnZXMgPCB1c2FnZUxpbWl0cy5tb250aGx5TWVzc2FnZXNcbiAgICAgIGNhc2UgJ3ByZW1pdW1fZXZlbnQnOlxuICAgICAgICByZXR1cm4gdXNhZ2UucHJlbWl1bUV2ZW50c1VzZWQgPCB1c2FnZUxpbWl0cy5wcmVtaXVtRXZlbnRzXG4gICAgICBjYXNlICdsaXZlc3RyZWFtJzpcbiAgICAgICAgcmV0dXJuIHVzYWdlLmxpdmVzdHJlYW1Ib3Vyc1VzZWQgPCB1c2FnZUxpbWl0cy5saXZlc3RyZWFtSG91cnNcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8vIENvbXB1dGVkIHZhbHVlc1xuICBjb25zdCBoYXNBY3RpdmVTdWJzY3JpcHRpb24gPSBCb29sZWFuKFxuICAgIHN1YnNjcmlwdGlvbiAmJiBcbiAgICBzdWJzY3JpcHRpb24uc3RhdHVzID09PSAnYWN0aXZlJyAmJiBcbiAgICBzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2RfZW5kICYmIFxuICAgIG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQpID4gbmV3IERhdGUoKVxuICApXG5cbiAgY29uc3QgaXNJblRyaWFsID0gQm9vbGVhbihcbiAgICB0cmlhbCAmJiBcbiAgICAhdHJpYWwuaXNfdXNlZCAmJiBcbiAgICBuZXcgRGF0ZSh0cmlhbC50cmlhbF9lbmQpID4gbmV3IERhdGUoKVxuICApXG5cbiAgY29uc3QgdHJpYWxEYXlzUmVtYWluaW5nID0gdHJpYWwgJiYgIXRyaWFsLmlzX3VzZWQgPyBcbiAgICBNYXRoLm1heCgwLCBNYXRoLmNlaWwoKG5ldyBEYXRlKHRyaWFsLnRyaWFsX2VuZCkuZ2V0VGltZSgpIC0gbmV3IERhdGUoKS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKSkgOiBcbiAgICAwXG5cbiAgLy8gU3Vic2NyaXB0aW9uIGlzIHJlcXVpcmVkIGZvciBhbGwgdXNlcnMgZXhjZXB0IGRlbW8gdXNlcnNcbiAgY29uc3Qgc3Vic2NyaXB0aW9uUmVxdWlyZWQgPSAhYXV0aFNlcnZpY2UuaXNEZW1vVXNlcigpICYmICFoYXNBY3RpdmVTdWJzY3JpcHRpb24gJiYgIWlzSW5UcmlhbFxuXG4gIC8vIEdldCBjdXJyZW50IG1lbWJlcnNoaXAgdGllclxuICBjb25zdCBtZW1iZXJzaGlwVGllcjogJ25vbmUnIHwgJ2ZyZWUnIHwgJ2NvbW11bml0eScgfCAnYW1iYXNzYWRvcicgPSBcbiAgICBoYXNBY3RpdmVTdWJzY3JpcHRpb24gJiYgc3Vic2NyaXB0aW9uPy50aWVyID8gc3Vic2NyaXB0aW9uLnRpZXIgOiAnbm9uZSdcblxuICAvLyBOb3JtYWxpemUgdG8gYW4gZWZmZWN0aXZlIHRpZXIgZm9yIGxpbWl0cy9kaXNjb3VudHNcbiAgY29uc3QgZWZmZWN0aXZlVGllcjogJ2ZyZWUnIHwgJ2NvbW11bml0eScgfCAnYW1iYXNzYWRvcicgfCAnZmFtaWxpYScgPSBtZW1iZXJzaGlwVGllciA9PT0gJ25vbmUnID8gJ2ZyZWUnIDogbWVtYmVyc2hpcFRpZXJcblxuICAvLyBDYWxjdWxhdGUgc2VydmljZSBkaXNjb3VudCBiYXNlZCBvbiB0aWVyIC0gUG9ydHVndWVzZS1zcGVha2luZyBjb21tdW5pdHkgb3B0aW1pemVkXG4gIGNvbnN0IHNlcnZpY2VEaXNjb3VudCA9ICgoKSA9PiB7XG4gICAgc3dpdGNoIChlZmZlY3RpdmVUaWVyKSB7XG4gICAgICBjYXNlICdjb21tdW5pdHknOiByZXR1cm4gMTAgLy8gMTAlIG1lbWJlciBkaXNjb3VudFxuICAgICAgY2FzZSAnYW1iYXNzYWRvcic6IHJldHVybiAyMCAvLyAyMCUgYW1iYXNzYWRvciBkaXNjb3VudCAgXG4gICAgICBjYXNlICdmYW1pbGlhJzogcmV0dXJuIDE1IC8vIDE1JSBmYW1pbHkgZGlzY291bnRcbiAgICAgIGRlZmF1bHQ6IHJldHVybiAwXG4gICAgfVxuICB9KSgpXG5cbiAgLy8gVXNhZ2UgbGltaXRzIGJhc2VkIG9uIHRpZXIgLSBPcHRpbWl6ZWQgZm9yIFBvcnR1Z3Vlc2Utc3BlYWtpbmcgY29tbXVuaXR5IGNvbnZlcnNpb25cbiAgY29uc3QgdXNhZ2VMaW1pdHM6IFN1YnNjcmlwdGlvblVzYWdlTGltaXRzID0gKCgpID0+IHtcbiAgICBzd2l0Y2ggKGVmZmVjdGl2ZVRpZXIpIHtcbiAgICAgIGNhc2UgJ2ZyZWUnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhaWx5TWF0Y2hlczogMiwgLy8gU3RyYXRlZ2ljIGxpbWl0YXRpb24gZW5jb3VyYWdpbmcgdXBncmFkZVxuICAgICAgICAgIG1vbnRobHlNZXNzYWdlczogMywgLy8gU3RyYXRlZ2ljIGxpbWl0YXRpb24gZW5jb3VyYWdpbmcgdXBncmFkZVxuICAgICAgICAgIHByZW1pdW1FdmVudHM6IDAsXG4gICAgICAgICAgbGl2ZXN0cmVhbUhvdXJzOiAwLFxuICAgICAgICAgIGhhc1VubGltaXRlZEFjY2VzczogZmFsc2VcbiAgICAgICAgfVxuICAgICAgY2FzZSAnY29tbXVuaXR5JzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYWlseU1hdGNoZXM6IC0xLCAvLyB1bmxpbWl0ZWQgbWF0Y2hlc1xuICAgICAgICAgIG1vbnRobHlNZXNzYWdlczogLTEsIC8vIHVubGltaXRlZCBtZXNzYWdpbmdcbiAgICAgICAgICBwcmVtaXVtRXZlbnRzOiAtMSwgLy8gdW5saW1pdGVkIGNvbW11bml0eSBldmVudHMgKG5vdCBwcmVtaXVtIGV2ZW50cylcbiAgICAgICAgICBsaXZlc3RyZWFtSG91cnM6IDAsIC8vIG5vIHN0cmVhbWluZyBhY2Nlc3MgZm9yIGNvbW11bml0eSB0aWVyXG4gICAgICAgICAgaGFzVW5saW1pdGVkQWNjZXNzOiBmYWxzZVxuICAgICAgICB9XG4gICAgICBjYXNlICdhbWJhc3NhZG9yJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYWlseU1hdGNoZXM6IC0xLCAvLyB1bmxpbWl0ZWRcbiAgICAgICAgICBtb250aGx5TWVzc2FnZXM6IC0xLCAvLyB1bmxpbWl0ZWRcbiAgICAgICAgICBwcmVtaXVtRXZlbnRzOiAtMSwgLy8gdW5saW1pdGVkIGluY2x1ZGluZyBwcmVtaXVtIGV2ZW50c1xuICAgICAgICAgIGxpdmVzdHJlYW1Ib3VyczogNSwgLy8gNSBob3VycyBwZXIgbW9udGggYXMgc3RhdGVkIGluIGJlbmVmaXRzXG4gICAgICAgICAgaGFzVW5saW1pdGVkQWNjZXNzOiBmYWxzZSAvLyBMaW1pdGVkIHN0cmVhbWluZyBob3Vycywgbm90IHVubGltaXRlZFxuICAgICAgICB9XG4gICAgICBjYXNlICdmYW1pbGlhJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYWlseU1hdGNoZXM6IC0xLCAvLyB1bmxpbWl0ZWQgZm9yIGFsbCBmYW1pbHkgbWVtYmVyc1xuICAgICAgICAgIG1vbnRobHlNZXNzYWdlczogLTEsIC8vIHVubGltaXRlZCBmb3IgYWxsIGZhbWlseSBtZW1iZXJzXG4gICAgICAgICAgcHJlbWl1bUV2ZW50czogLTEsIC8vIHVubGltaXRlZCBpbmNsdWRpbmcgcHJlbWl1bSBldmVudHNcbiAgICAgICAgICBsaXZlc3RyZWFtSG91cnM6IDMsIC8vIDMgaG91cnMgcGVyIG1vbnRoIGZvciBmYW1pbHkgcGxhblxuICAgICAgICAgIGhhc1VubGltaXRlZEFjY2VzczogZmFsc2UgLy8gRmFtaWx5LWFwcHJvcHJpYXRlIGxpbWl0YXRpb25zXG4gICAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGFpbHlNYXRjaGVzOiAyLFxuICAgICAgICAgIG1vbnRobHlNZXNzYWdlczogMyxcbiAgICAgICAgICBwcmVtaXVtRXZlbnRzOiAwLFxuICAgICAgICAgIGxpdmVzdHJlYW1Ib3VyczogMCxcbiAgICAgICAgICBoYXNVbmxpbWl0ZWRBY2Nlc3M6IGZhbHNlXG4gICAgICAgIH1cbiAgICB9XG4gIH0pKClcblxuICAvLyBGZWF0dXJlIGFjY2VzcyBmdW5jdGlvbnNcbiAgY29uc3QgY2FuU2VuZE1lc3NhZ2UgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIGNhblVzZUZlYXR1cmUoJ21lc3NhZ2UnKVxuICB9XG5cbiAgY29uc3QgY2FuQ3JlYXRlTWF0Y2ggPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIGNhblVzZUZlYXR1cmUoJ21hdGNoJylcbiAgfVxuXG4gIGNvbnN0IGNhbkFjY2Vzc1ByZW1pdW1FdmVudCA9ICgpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gY2FuVXNlRmVhdHVyZSgncHJlbWl1bV9ldmVudCcpXG4gIH1cblxuICBjb25zdCBjYW5BY2Nlc3NMaXZlc3RyZWFtID0gKCk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiBjYW5Vc2VGZWF0dXJlKCdsaXZlc3RyZWFtJylcbiAgfVxuXG4gIGNvbnN0IGdldFJlbWFpbmluZ01hdGNoZXMgPSAoKTogbnVtYmVyID0+IHtcbiAgICBpZiAodXNhZ2VMaW1pdHMuaGFzVW5saW1pdGVkQWNjZXNzIHx8IHVzYWdlTGltaXRzLmRhaWx5TWF0Y2hlcyA9PT0gLTEpIHJldHVybiAtMVxuICAgIFxuICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF1cbiAgICBjb25zdCBkYWlseVVzZWQgPSB1c2FnZT8ubGFzdFJlc2V0RGF0ZSA9PT0gdG9kYXkgPyB1c2FnZS5kYWlseU1hdGNoZXNVc2VkIDogMFxuICAgIHJldHVybiBNYXRoLm1heCgwLCB1c2FnZUxpbWl0cy5kYWlseU1hdGNoZXMgLSBkYWlseVVzZWQpXG4gIH1cblxuICBjb25zdCBnZXRSZW1haW5pbmdNZXNzYWdlcyA9ICgpOiBudW1iZXIgPT4ge1xuICAgIGlmICh1c2FnZUxpbWl0cy5oYXNVbmxpbWl0ZWRBY2Nlc3MgfHwgdXNhZ2VMaW1pdHMubW9udGhseU1lc3NhZ2VzID09PSAtMSkgcmV0dXJuIC0xXG4gICAgXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCA3KVxuICAgIGNvbnN0IG1vbnRobHlVc2VkID0gdXNhZ2U/Lmxhc3RSZXNldERhdGU/LnN1YnN0cmluZygwLCA3KSA9PT0gY3VycmVudE1vbnRoID8gdXNhZ2UubW9udGhseU1lc3NhZ2VzVXNlZCA6IDBcbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgdXNhZ2VMaW1pdHMubW9udGhseU1lc3NhZ2VzIC0gbW9udGhseVVzZWQpXG4gIH1cblxuICBjb25zdCB2YWx1ZTogU3Vic2NyaXB0aW9uQ29udGV4dFR5cGUgPSB7XG4gICAgc3Vic2NyaXB0aW9uLFxuICAgIHRyaWFsLFxuICAgIHVzYWdlLFxuICAgIGlzTG9hZGluZyxcbiAgICBoYXNBY3RpdmVTdWJzY3JpcHRpb24sXG4gICAgaXNJblRyaWFsLFxuICAgIHRyaWFsRGF5c1JlbWFpbmluZyxcbiAgICBzdWJzY3JpcHRpb25SZXF1aXJlZCxcbiAgICBzdHJpcGUsXG4gICAgbWVtYmVyc2hpcFRpZXIsXG4gICAgc2VydmljZURpc2NvdW50LFxuICAgIHVzYWdlTGltaXRzLFxuICAgIGNhblNlbmRNZXNzYWdlLFxuICAgIGNhbkNyZWF0ZU1hdGNoLFxuICAgIGNhbkFjY2Vzc1ByZW1pdW1FdmVudCxcbiAgICBjYW5BY2Nlc3NMaXZlc3RyZWFtLFxuICAgIGdldFJlbWFpbmluZ01hdGNoZXMsXG4gICAgZ2V0UmVtYWluaW5nTWVzc2FnZXMsXG4gICAgY2hlY2tTdWJzY3JpcHRpb25TdGF0dXMsXG4gICAgY3JlYXRlU3Vic2NyaXB0aW9uLFxuICAgIHVwZ3JhZGVTdWJzY3JpcHRpb24sXG4gICAgY2FuY2VsU3Vic2NyaXB0aW9uLFxuICAgIHJlZGlyZWN0VG9TdWJzY3JpcHRpb24sXG4gICAgbWFya1RyaWFsQXNVc2VkLFxuICAgIHRyYWNrTWVtYmVyc2hpcFVzYWdlLFxuICAgIHRyYWNrRmVhdHVyZVVzYWdlLFxuICAgIHZhbGlkYXRlU3R1ZGVudFN0YXR1cyxcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPFN1YnNjcmlwdGlvbkNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3ZhbHVlfT5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L1N1YnNjcmlwdGlvbkNvbnRleHQuUHJvdmlkZXI+XG4gIClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVN1YnNjcmlwdGlvbigpIHtcbiAgY29uc3QgY29udGV4dCA9IHVzZUNvbnRleHQoU3Vic2NyaXB0aW9uQ29udGV4dClcbiAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcigndXNlU3Vic2NyaXB0aW9uIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBTdWJzY3JpcHRpb25Qcm92aWRlcicpXG4gIH1cbiAgcmV0dXJuIGNvbnRleHRcbn0iXSwibmFtZXMiOlsiU3Vic2NyaXB0aW9uUHJvdmlkZXIiLCJ1c2VTdWJzY3JpcHRpb24iLCJzdHJpcGVQcm9taXNlIiwibG9hZFN0cmlwZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVFJJUEVfUFVCTElTSEFCTEVfS0VZIiwiU3Vic2NyaXB0aW9uQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJ1bmRlZmluZWQiLCJjaGlsZHJlbiIsImxhbmd1YWdlIiwidCIsInVzZUxhbmd1YWdlIiwic3Vic2NyaXB0aW9uIiwic2V0U3Vic2NyaXB0aW9uIiwidXNlU3RhdGUiLCJ0cmlhbCIsInNldFRyaWFsIiwidXNhZ2UiLCJzZXRVc2FnZSIsImlzTG9hZGluZyIsInNldElzTG9hZGluZyIsInN0cmlwZSIsInNldFN0cmlwZSIsInVzZUVmZmVjdCIsImluaXRpYWxpemVTdHJpcGUiLCJzdHJpcGVJbnN0YW5jZSIsImNoZWNrVXNlclN1YnNjcmlwdGlvbiIsInVzZXIiLCJhdXRoU2VydmljZSIsImdldEN1cnJlbnRVc2VyIiwiaXNEZW1vVXNlciIsImNoZWNrU3Vic2NyaXB0aW9uU3RhdHVzIiwidW5zdWJzY3JpYmUiLCJvbkF1dGhTdGF0ZUNoYW5nZSIsImRhdGEiLCJzdWJzY3JpcHRpb25EYXRhIiwiZXJyb3IiLCJzdWJFcnJvciIsInN1cGFiYXNlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJjb2RlIiwibG9nZ2VyIiwidHJpYWxEYXRhIiwidHJpYWxFcnJvciIsImNyZWF0ZVN1YnNjcmlwdGlvbiIsInRpZXIiLCJwbGFuVHlwZSIsIkVycm9yIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVzZXJJZCIsInVzZXJFbWFpbCIsImVtYWlsIiwidXNlck5hbWUiLCJuYW1lIiwib2siLCJzZXNzaW9uSWQiLCJqc29uIiwicmVkaXJlY3RUb0NoZWNrb3V0IiwidG9hc3QiLCJjYW5jZWxTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb25JZCIsInN0cmlwZV9zdWJzY3JpcHRpb25faWQiLCJzdWNjZXNzIiwicmVkaXJlY3RUb1N1YnNjcmlwdGlvbiIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsIlJPVVRFUyIsInVwZ3JhZGVTdWJzY3JpcHRpb24iLCJuZXdUaWVyIiwibWFya1RyaWFsQXNVc2VkIiwidXBkYXRlIiwiaXNfdXNlZCIsInByZXYiLCJ0cmFja01lbWJlcnNoaXBVc2FnZSIsImJlbmVmaXRUeXBlIiwic2VydmljZVR5cGUiLCJkaXNjb3VudEFwcGxpZWQiLCJhbW91bnRTYXZlZCIsImluc2VydCIsInVzZXJfaWQiLCJzdWJzY3JpcHRpb25faWQiLCJiZW5lZml0X3R5cGUiLCJzZXJ2aWNlX3R5cGUiLCJkaXNjb3VudF9hcHBsaWVkIiwiYW1vdW50X3NhdmVkIiwidHJhY2tGZWF0dXJlVXNhZ2UiLCJmZWF0dXJlIiwiY2FuVXNlRmVhdHVyZSIsInRvZGF5IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJjdXJyZW50TW9udGgiLCJzdWJzdHJpbmciLCJ1cGRhdGVkVXNhZ2UiLCJkYWlseU1hdGNoZXNVc2VkIiwibW9udGhseU1lc3NhZ2VzVXNlZCIsImxhc3RSZXNldERhdGUiLCJwcmVtaXVtRXZlbnRzVXNlZCIsImxpdmVzdHJlYW1Ib3Vyc1VzZWQiLCJ1cHNlcnQiLCJ2YWxpZGF0ZVN0dWRlbnRTdGF0dXMiLCJzdHVkZW50RW1haWwiLCJ1bml2ZXJzaXR5SWQiLCJpc1ZhbGlkIiwidXNhZ2VMaW1pdHMiLCJoYXNVbmxpbWl0ZWRBY2Nlc3MiLCJkYWlseVJlc2V0IiwibW9udGhseVJlc2V0IiwiZGFpbHlNYXRjaGVzIiwibW9udGhseU1lc3NhZ2VzIiwicHJlbWl1bUV2ZW50cyIsImxpdmVzdHJlYW1Ib3VycyIsImhhc0FjdGl2ZVN1YnNjcmlwdGlvbiIsIkJvb2xlYW4iLCJzdGF0dXMiLCJjdXJyZW50X3BlcmlvZF9lbmQiLCJpc0luVHJpYWwiLCJ0cmlhbF9lbmQiLCJ0cmlhbERheXNSZW1haW5pbmciLCJNYXRoIiwibWF4IiwiY2VpbCIsImdldFRpbWUiLCJzdWJzY3JpcHRpb25SZXF1aXJlZCIsIm1lbWJlcnNoaXBUaWVyIiwiZWZmZWN0aXZlVGllciIsInNlcnZpY2VEaXNjb3VudCIsImNhblNlbmRNZXNzYWdlIiwiY2FuQ3JlYXRlTWF0Y2giLCJjYW5BY2Nlc3NQcmVtaXVtRXZlbnQiLCJjYW5BY2Nlc3NMaXZlc3RyZWFtIiwiZ2V0UmVtYWluaW5nTWF0Y2hlcyIsImRhaWx5VXNlZCIsImdldFJlbWFpbmluZ01lc3NhZ2VzIiwibW9udGhseVVzZWQiLCJ2YWx1ZSIsIlByb3ZpZGVyIiwiY29udGV4dCIsInVzZUNvbnRleHQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7SUFrR2dCQSxvQkFBb0I7ZUFBcEJBOztJQTJpQkFDLGVBQWU7ZUFBZkE7Ozs7K0RBM29CaUU7MEJBQzlDO2lDQUNQO3NCQUNBOzBCQUNIO3NFQUNQO3dCQUNLOytEQUNKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVuQixvREFBb0Q7QUFDcEQsTUFBTUMsZ0JBQWdCQyxJQUFBQSxvQkFBVSxFQUFDQyxRQUFRQyxHQUFHLENBQUNDLGtDQUFrQyxJQUFJO0FBZ0ZuRixNQUFNQyxvQ0FBc0JDLElBQUFBLG9CQUFhLEVBQXNDQztBQU14RSxTQUFTVCxxQkFBcUIsRUFBRVUsUUFBUSxFQUE2QjtJQUMxRSxNQUFNLEVBQUVDLFFBQVEsRUFBRUMsQ0FBQyxFQUFFLEdBQUdDLElBQUFBLDRCQUFXO0lBQ25DLE1BQU0sQ0FBQ0MsY0FBY0MsZ0JBQWdCLEdBQUdDLElBQUFBLGVBQVEsRUFBc0I7SUFDdEUsTUFBTSxDQUFDQyxPQUFPQyxTQUFTLEdBQUdGLElBQUFBLGVBQVEsRUFBMkI7SUFDN0QsTUFBTSxDQUFDRyxPQUFPQyxTQUFT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