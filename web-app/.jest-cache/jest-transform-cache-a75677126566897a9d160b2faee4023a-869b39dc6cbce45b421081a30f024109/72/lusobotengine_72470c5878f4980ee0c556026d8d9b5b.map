{"version":3,"sources":["/workspaces/LusoTown/web-app/src/lib/lusobot-engine.ts"],"sourcesContent":["/**\n * LusoBot Portuguese Cultural AI Assistant Engine\n * \n * Core AI system providing Portuguese cultural expertise, language support,\n * community navigation, and saudade emotional understanding.\n */\n\nimport { Language } from '@/i18n'\n\n// Core Types\nexport interface LusoBotMessage {\n  id: string\n  role: 'user' | 'assistant' | 'system'\n  content: string\n  timestamp: Date\n  language: Language\n  culturalContext?: CulturalContext\n  emotionalTone?: EmotionalTone\n  suggestions?: LusoBotSuggestion[]\n  metadata?: MessageMetadata\n}\n\nexport interface CulturalContext {\n  region: PortugueseRegion\n  topic: CulturalTopic\n  expertise: ExpertiseArea[]\n  confidence: number\n}\n\nexport interface EmotionalTone {\n  saudade: number // 0-1 scale\n  nostalgia: number\n  hope: number\n  community: number\n  heritage: number\n}\n\nexport interface LusoBotSuggestion {\n  type: 'event' | 'business' | 'resource' | 'community' | 'language'\n  title: string\n  description: string\n  link?: string\n  priority: 'high' | 'medium' | 'low'\n  culturalRelevance: number\n}\n\nexport interface MessageMetadata {\n  userRegion?: PortugueseRegion\n  communityLevel?: CommunityLevel\n  languageProficiency?: LanguageProficiency\n  interests?: string[]\n  mood?: UserMood\n}\n\n// Enums and Constants\nexport type PortugueseRegion = \n  | 'north' | 'center' | 'south' | 'lisbon' | 'porto'\n  | 'azores' | 'madeira' | 'brazil' | 'angola' | 'mozambique'\n  | 'diaspora_uk' | 'diaspora_us' | 'diaspora_france' | 'diaspora_other'\n\nexport type CulturalTopic = \n  | 'history' | 'traditions' | 'cuisine' | 'language' | 'fado'\n  | 'literature' | 'festivals' | 'sports' | 'religion' | 'art'\n  | 'family' | 'community' | 'diaspora' | 'business' | 'education'\n\nexport type ExpertiseArea = \n  | 'portuguese_history' | 'regional_cultures' | 'portuguese_cuisine'\n  | 'fado_music' | 'language_learning' | 'diaspora_support'\n  | 'business_culture' | 'family_traditions' | 'religious_practices'\n  | 'uk_portuguese_community' | 'immigration_support' | 'cultural_events'\n\nexport type CommunityLevel = 'newcomer' | 'active' | 'engaged' | 'leader' | 'elder'\nexport type LanguageProficiency = 'native' | 'fluent' | 'intermediate' | 'beginner' | 'learning'\nexport type UserMood = 'curious' | 'homesick' | 'excited' | 'seeking_help' | 'celebratory'\n\n// Portuguese Cultural Knowledge Base\nexport const PORTUGUESE_CULTURAL_KNOWLEDGE = {\n  // Historical Periods\n  history: {\n    discoveries: {\n      period: '15th-16th centuries',\n      keywords: ['navegações', 'descobrimentos', 'vasco da gama', 'pedro álvares cabral'],\n      significance: 'Portuguese maritime expansion and global influence',\n      cultural_impact: 'Foundation of Portuguese global identity and pride'\n    },\n    revolution_1974: {\n      period: '25 de Abril 1974',\n      keywords: ['revolução dos cravos', 'liberdade', 'democracia', 'estado novo'],\n      significance: 'End of dictatorship and beginning of modern Portugal',\n      cultural_impact: 'Symbol of peaceful change and democratic values'\n    },\n    eu_membership: {\n      period: '1986-present',\n      keywords: ['união europeia', 'modernização', 'desenvolvimento'],\n      significance: 'Portugal\\'s integration into European community',\n      cultural_impact: 'Balance between European identity and Portuguese heritage'\n    }\n  },\n\n  // Regional Cultures\n  regions: {\n    north: {\n      characteristics: ['Traditional', 'Religious', 'Rural heritage'],\n      cuisine: ['Francesinha', 'Caldo verde', 'Vinho verde'],\n      traditions: ['Festa de São João', 'Romarias', 'Trabalho comunitário'],\n      dialects: ['Mirandês influence', 'Rural expressions'],\n      music: ['Folk dances', 'Traditional songs']\n    },\n    center: {\n      characteristics: ['Academic', 'Historical', 'Balanced'],\n      cuisine: ['Leitão da Bairrada', 'Queijo da Serra', 'Ovos moles'],\n      traditions: ['Queima das Fitas', 'Festa dos Tabuleiros'],\n      dialects: ['Standard Portuguese', 'Academic language'],\n      music: ['University traditions', 'Classical influence']\n    },\n    south: {\n      characteristics: ['Warm', 'Agricultural', 'Moorish influence'],\n      cuisine: ['Cataplana', 'Migas', 'Medronho'],\n      traditions: ['Alentejo singing', 'Cork harvesting'],\n      dialects: ['Alentejo accent', 'Slower pace'],\n      music: ['Cante alentejano', 'Traditional ballads']\n    },\n    lisbon: {\n      characteristics: ['Cosmopolitan', 'Historic', 'Diverse'],\n      cuisine: ['Pastéis de nata', 'Bacalhau', 'International fusion'],\n      traditions: ['Santos Populares', 'Fado houses'],\n      dialects: ['Standard Portuguese', 'Urban slang'],\n      music: ['Fado', 'Modern Portuguese music']\n    },\n    azores: {\n      characteristics: ['Island life', 'Nature-focused', 'Community-oriented'],\n      cuisine: ['Cozido das Furnas', 'Queijo São Jorge', 'Linguiça'],\n      traditions: ['Festa do Divino Espírito Santo', 'Whaling heritage'],\n      dialects: ['Island expressions', 'Archaic terms'],\n      music: ['Chamarrita', 'Folk songs']\n    },\n    madeira: {\n      characteristics: ['Subtropical', 'Tourism-oriented', 'Agricultural'],\n      cuisine: ['Espetada', 'Bolo de mel', 'Poncha'],\n      traditions: ['Festa da Flor', 'New Year fireworks'],\n      dialects: ['Madeirense accent', 'Unique expressions'],\n      music: ['Bailinho madeirense', 'Folk traditions']\n    }\n  },\n\n  // Cuisine Knowledge\n  cuisine: {\n    staples: {\n      'bacalhau': {\n        significance: 'National fish, \"fiel amigo\" (faithful friend)',\n        preparations: ['365 ways to prepare', 'Christmas tradition', 'Identity symbol'],\n        cultural_meaning: 'Represents Portuguese ingenuity and tradition'\n      },\n      'pão': {\n        significance: 'Daily bread, center of meals',\n        varieties: ['Broa de milho', 'Pão de centeio', 'Pão alentejano'],\n        cultural_meaning: 'Hospitality and sharing'\n      },\n      'vinho': {\n        significance: 'Wine culture deeply embedded',\n        regions: ['Douro', 'Alentejo', 'Vinho Verde', 'Porto'],\n        cultural_meaning: 'Celebration, tradition, quality of life'\n      }\n    },\n    traditional_dishes: {\n      'cozido_portuguesa': 'National stew representing unity in diversity',\n      'francesinha': 'Porto\\'s hearty sandwich, local pride',\n      'pasteis_nata': 'Sweet symbol of Portuguese culinary expertise',\n      'cataplana': 'Algarve seafood celebration',\n      'bifana': 'Everyday comfort food, working-class identity'\n    },\n    food_customs: {\n      'sobremesa': 'Always room for dessert, family time extension',\n      'petiscos': 'Small plates culture, social bonding',\n      'café': 'Coffee culture, daily social ritual',\n      'jantar_familia': 'Family dinner sacred time'\n    }\n  },\n\n  // Fado and Music\n  music: {\n    fado: {\n      essence: 'Soul of Portuguese music, expression of saudade',\n      types: ['Fado de Lisboa', 'Fado de Coimbra', 'Fado vadio'],\n      themes: ['Love', 'Loss', 'Destiny', 'Homeland', 'Nostalgia'],\n      cultural_role: 'Emotional outlet, cultural identity, UNESCO heritage',\n      legendary_figures: ['Amália Rodrigues', 'Alfredo Marceneiro', 'Carlos do Carmo']\n    },\n    folk_music: {\n      'cante_alentejano': 'UNESCO heritage, group singing tradition',\n      'vira': 'Folk dance music, celebration and community',\n      'corridinho': 'Algarve folk dance, joy and festivity',\n      'chamarrita': 'Azorean folk music, island identity'\n    },\n    modern_music: {\n      evolution: 'From folk to contemporary, maintaining Portuguese soul',\n      artists: ['Mariza', 'Dulce Pontes', 'Madredeus', 'Deolinda'],\n      themes: 'Modern life with traditional emotions'\n    }\n  },\n\n  // Language and Expressions\n  language: {\n    saudade: {\n      definition: 'Untranslatable feeling of longing, missing, nostalgic love',\n      usage: 'Central to Portuguese emotional expression',\n      cultural_importance: 'Defines Portuguese character and worldview',\n      expressions: ['Tenho saudades', 'Mata saudades', 'Morrer de saudades']\n    },\n    common_expressions: {\n      'desenrascanço': 'Portuguese ability to solve problems creatively',\n      'fado': 'Fate, destiny - acceptance of life\\'s ups and downs',\n      'coração': 'Heart - central to emotional expression',\n      'família': 'Family - core value and social unit',\n      'amizade': 'Friendship - deep, lasting relationships'\n    },\n    regional_dialects: {\n      pronunciation: 'Varies significantly by region',\n      vocabulary: 'Local words and expressions',\n      formal_vs_informal: 'Portuguese hierarchy in language use'\n    }\n  }\n}\n\n// Saudade Understanding Engine\nexport class SaudadeEngine {\n  static detectSaudade(message: string, language: Language): EmotionalTone {\n    const saudadeKeywords = [\n      // Portuguese\n      'saudades', 'saudade', 'falta', 'nostalgia', 'longe', 'casa', 'família',\n      'terra', 'portugal', 'pátria', 'raízes', 'origem', 'coração',\n      // English equivalents\n      'miss', 'missing', 'homesick', 'nostalgia', 'homeland', 'roots',\n      'family', 'heritage', 'belong', 'longing'\n    ]\n\n    const communityKeywords = [\n      'comunidade', 'amigos', 'vizinhos', 'convívio', 'união',\n      'community', 'friends', 'neighbors', 'gathering', 'belonging'\n    ]\n\n    const heritageKeywords = [\n      'tradição', 'cultura', 'costumes', 'herança', 'história',\n      'tradition', 'culture', 'customs', 'heritage', 'history'\n    ]\n\n    const text = message.toLowerCase()\n    \n    let saudade = 0\n    let community = 0\n    let heritage = 0\n    let nostalgia = 0\n    let hope = 0\n\n    // Detect saudade intensity\n    saudadeKeywords.forEach(keyword => {\n      if (text.includes(keyword)) {\n        saudade += 0.2\n        nostalgia += 0.15\n      }\n    })\n\n    // Detect community longing\n    communityKeywords.forEach(keyword => {\n      if (text.includes(keyword)) {\n        community += 0.25\n        hope += 0.1\n      }\n    })\n\n    // Detect heritage connection\n    heritageKeywords.forEach(keyword => {\n      if (text.includes(keyword)) {\n        heritage += 0.3\n        hope += 0.15\n      }\n    })\n\n    // Context-based adjustments\n    if (text.includes('sozinho') || text.includes('alone')) {\n      saudade += 0.3\n      community += 0.2\n    }\n\n    if (text.includes('festa') || text.includes('celebration')) {\n      hope += 0.4\n      community += 0.3\n    }\n\n    return {\n      saudade: Math.min(saudade, 1),\n      nostalgia: Math.min(nostalgia, 1),\n      hope: Math.min(hope, 1),\n      community: Math.min(community, 1),\n      heritage: Math.min(heritage, 1)\n    }\n  }\n\n  static generateSaudadeResponse(tone: EmotionalTone, language: Language): string {\n    if (tone.saudade > 0.6) {\n      return language === 'pt' \n        ? \"Compreendo essa saudade profunda que sentes. É algo muito português, essa capacidade de amar intensamente mesmo à distância. A nossa comunidade está aqui para te acolher.\"\n        : \"I understand that deep saudade you're feeling. It's something very Portuguese, this ability to love intensely even from a distance. Our community is here to embrace you.\"\n    }\n\n    if (tone.nostalgia > 0.5) {\n      return language === 'pt'\n        ? \"A nostalgia é doce e amarga ao mesmo tempo, não é? Faz parte de quem somos. Que tal partilharmos algumas memórias ou tradições que te fazem sentir mais próximo de casa?\"\n        : \"Nostalgia is sweet and bitter at the same time, isn't it? It's part of who we are. How about sharing some memories or traditions that make you feel closer to home?\"\n    }\n\n    if (tone.community > 0.5) {\n      return language === 'pt'\n        ? \"O sentido de comunidade é fundamental para nós, portugueses. Há sempre espaço para mais uma pessoa na nossa mesa e no nosso coração.\"\n        : \"The sense of community is fundamental for us Portuguese. There's always room for one more person at our table and in our hearts.\"\n    }\n\n    return language === 'pt'\n      ? \"Estou aqui para te ajudar a navegar tanto as emoções como a vida prática na comunidade de falantes de português.\"\n      : \"I'm here to help you navigate both emotions and practical life in the Portuguese-speaking community.\"\n  }\n}\n\n// LusoBot AI Response Engine\nexport class LusoBotEngine {\n  private static knowledge = PORTUGUESE_CULTURAL_KNOWLEDGE\n  private static saudadeEngine = SaudadeEngine\n\n  static async generateResponse(\n    message: string,\n    context: MessageMetadata,\n    language: Language\n  ): Promise<LusoBotMessage> {\n    // Detect emotional tone\n    const emotionalTone = this.saudadeEngine.detectSaudade(message, language)\n    \n    // Identify cultural context\n    const culturalContext = this.identifyCulturalContext(message, language)\n    \n    // Generate appropriate response\n    const response = await this.generateContextualResponse(\n      message,\n      culturalContext,\n      emotionalTone,\n      context,\n      language\n    )\n    \n    // Generate helpful suggestions\n    const suggestions = this.generateSuggestions(\n      culturalContext,\n      emotionalTone,\n      context,\n      language\n    )\n\n    return {\n      id: `lusobot_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      role: 'assistant',\n      content: response,\n      timestamp: new Date(),\n      language,\n      culturalContext,\n      emotionalTone,\n      suggestions,\n      metadata: context\n    }\n  }\n\n  private static identifyCulturalContext(message: string, language: Language): CulturalContext {\n    const text = message.toLowerCase()\n    let region: PortugueseRegion = 'diaspora_uk'\n    let topic: CulturalTopic = 'community'\n    let expertise: ExpertiseArea[] = []\n    let confidence = 0.5\n\n    // Detect regional references\n    if (text.includes('norte') || text.includes('porto') || text.includes('minho')) {\n      region = 'north'\n      confidence += 0.3\n    } else if (text.includes('centro') || text.includes('coimbra') || text.includes('beira')) {\n      region = 'center'\n      confidence += 0.3\n    } else if (text.includes('sul') || text.includes('alentejo') || text.includes('algarve')) {\n      region = 'south'\n      confidence += 0.3\n    } else if (text.includes('lisboa') || text.includes('lisbon')) {\n      region = 'lisbon'\n      confidence += 0.3\n    } else if (text.includes('açores') || text.includes('azores')) {\n      region = 'azores'\n      confidence += 0.3\n    } else if (text.includes('madeira')) {\n      region = 'madeira'\n      confidence += 0.3\n    }\n\n    // Detect topic areas\n    if (text.includes('comida') || text.includes('food') || text.includes('receita') || text.includes('recipe')) {\n      topic = 'cuisine'\n      expertise.push('portuguese_cuisine')\n      confidence += 0.4\n    } else if (text.includes('fado') || text.includes('música') || text.includes('music')) {\n      topic = 'fado'\n      expertise.push('fado_music')\n      confidence += 0.4\n    } else if (text.includes('história') || text.includes('history')) {\n      topic = 'history'\n      expertise.push('portuguese_history')\n      confidence += 0.4\n    } else if (text.includes('língua') || text.includes('language') || text.includes('portuguese')) {\n      topic = 'language'\n      expertise.push('language_learning')\n      confidence += 0.4\n    } else if (text.includes('evento') || text.includes('event') || text.includes('festa')) {\n      topic = 'festivals'\n      expertise.push('cultural_events')\n      confidence += 0.3\n    } else if (text.includes('negócio') || text.includes('business') || text.includes('trabalho')) {\n      topic = 'business'\n      expertise.push('business_culture')\n      confidence += 0.3\n    }\n\n    return {\n      region,\n      topic,\n      expertise,\n      confidence: Math.min(confidence, 1)\n    }\n  }\n\n  private static async generateContextualResponse(\n    message: string,\n    culturalContext: CulturalContext,\n    emotionalTone: EmotionalTone,\n    userContext: MessageMetadata,\n    language: Language\n  ): Promise<string> {\n    // Handle high saudade/emotional content first\n    if (emotionalTone.saudade > 0.5 || emotionalTone.nostalgia > 0.5) {\n      const emotionalResponse = this.saudadeEngine.generateSaudadeResponse(emotionalTone, language)\n      return emotionalResponse\n    }\n\n    // Generate topic-specific responses\n    switch (culturalContext.topic) {\n      case 'cuisine':\n        return this.generateCuisineResponse(message, culturalContext, language)\n      \n      case 'fado':\n        return this.generateFadoResponse(message, culturalContext, language)\n      \n      case 'history':\n        return this.generateHistoryResponse(message, culturalContext, language)\n      \n      case 'language':\n        return this.generateLanguageResponse(message, culturalContext, language)\n      \n      case 'festivals':\n        return this.generateFestivalResponse(message, culturalContext, language)\n      \n      case 'business':\n        return this.generateBusinessResponse(message, culturalContext, language)\n      \n      case 'community':\n      default:\n        return this.generateCommunityResponse(message, culturalContext, language)\n    }\n  }\n\n  private static generateCuisineResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    const text = message.toLowerCase()\n    \n    if (text.includes('bacalhau') || text.includes('cod')) {\n      return language === 'pt'\n        ? \"Ah, o nosso fiel amigo! O bacalhau é muito mais que comida - é tradição, é identidade. Dizem que há 365 maneiras de o preparar, uma para cada dia do ano. Que tipo de bacalhau gostas mais? Bacalhau à Brás, à Gomes de Sá, ou talvez com natas?\"\n        : \"Ah, our faithful friend! Codfish is much more than food - it's tradition, it's identity. They say there are 365 ways to prepare it, one for each day of the year. What type of bacalhau do you prefer? Bacalhau à Brás, à Gomes de Sá, or perhaps with cream?\"\n    }\n\n    if (text.includes('pastéis de nata') || text.includes('pastel de nata')) {\n      return language === 'pt'\n        ? \"Os pastéis de nata são a nossa doce embaixada pelo mundo! Nasceram em Belém, mas conquistaram corações globalmente. Em Londres, já experimentaste os do Nata & Co ou os da Café de Nata? Nunca são iguais aos originais de Belém, mas matam as saudades.\"\n        : \"Pastéis de nata are our sweet embassy to the world! Born in Belém, they've conquered hearts globally. In London, have you tried those from Nata & Co or Café de Nata? They're never quite like the originals from Belém, but they help with the saudades.\"\n    }\n\n    // Regional cuisine responses\n    if (context.region === 'north') {\n      return language === 'pt'\n        ? \"A cozinha do Norte é robusta e calorosa, como a nossa gente! Francesinha, caldo verde, broa de milho... comida que aquece o coração e a alma. Tens algum prato nortenho de que tenhas especial saudade?\"\n        : \"Northern cuisine is robust and warming, like our people! Francesinha, caldo verde, corn bread... food that warms the heart and soul. Is there any northern dish you particularly miss?\"\n    }\n\n    return language === 'pt'\n      ? \"A nossa gastronomia é uma viagem pelas regiões e pela história. Cada prato conta uma história, cada sabor traz memórias. Em que posso ajudar-te a matar as saudades culinárias?\"\n      : \"Our gastronomy is a journey through regions and history. Each dish tells a story, each flavor brings memories. How can I help you satisfy your culinary saudades?\"\n  }\n\n  private static generateFadoResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"O fado é a nossa alma cantada, o espelho da saudade portuguesa. Desde Amália Rodrigues até Mariza, o fado evolui mas mantém sempre essa capacidade única de tocar o coração. Em Londres, há casas de fado onde podes ouvir essa música que nos define. Conheces alguma fadista favorita?\"\n      : \"Fado is our sung soul, the mirror of Portuguese saudade. From Amália Rodrigues to Mariza, fado evolves but always maintains that unique ability to touch the heart. In London, there are fado houses where you can hear this music that defines us. Do you have a favorite fadista?\"\n  }\n\n  private static generateHistoryResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"A nossa história é épica - das navegações que abriram o mundo ao 25 de Abril que nos trouxe a liberdade. Somos um povo pequeno que fez coisas grandes. Que período da história portuguesa te interessa mais? Os Descobrimentos? A Revolução dos Cravos? A entrada na União Europeia?\"\n      : \"Our history is epic - from the navigations that opened the world to April 25th that brought us freedom. We are a small people who did great things. Which period of Portuguese history interests you most? The Discoveries? The Carnation Revolution? Joining the European Union?\"\n  }\n\n  private static generateLanguageResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"A língua portuguesa é música, é poesia, é a nossa forma única de ver o mundo. Tens dificuldades com algum aspeto específico? Gostarias de aprender expressões típicas? Ou talvez queiras praticar a conversação? Estou aqui para te ajudar a sentires-te mais à vontade com a nossa bela língua.\"\n      : \"The Portuguese language is music, poetry, our unique way of seeing the world. Are you having difficulties with any specific aspect? Would you like to learn typical expressions? Or perhaps practice conversation? I'm here to help you feel more comfortable with our beautiful language.\"\n  }\n\n  private static generateFestivalResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"As nossas festas são momentos de união, tradição e alegria! Desde os Santos Populares em junho até ao Natal em família, cada celebração tem a sua magia. Em Londres, a comunidade de falantes de português organiza eventos lindos. Queres saber sobre festivais tradicionais ou eventos atuais da comunidade?\"\n      : \"Our festivals are moments of unity, tradition and joy! From Santos Populares in June to Christmas with family, each celebration has its magic. In London, the Portuguese-speaking community organizes beautiful events. Want to know about traditional festivals or current community events?\"\n  }\n\n  private static generateBusinessResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"A cultura empresarial portuguesa valoriza as relações pessoais, a confiança e o respeito mútuo. No Reino Unido, muitos empresários portugueses destacam-se pela criatividade e pelo 'desenrascanço'. Como posso ajudar-te no teu percurso profissional ou empresarial?\"\n      : \"Portuguese business culture values personal relationships, trust and mutual respect. In the United Kingdom, many Portuguese entrepreneurs stand out for their creativity and 'desenrascanço'. How can I help you in your professional or business journey?\"\n  }\n\n  private static generateCommunityResponse(\n    message: string,\n    context: CulturalContext,\n    language: Language\n  ): string {\n    return language === 'pt'\n      ? \"A comunidade de falantes de português no Reino Unido é forte, acolhedora e sempre pronta a ajudar. Seja para encontrar produtos portugueses, eventos culturais, ou simplesmente para um café e uma conversa, estamos todos ligados pela mesma herança. Como posso ajudar-te a sentires-te mais integrado na nossa comunidade?\"\n      : \"The Portuguese-speaking community in the United Kingdom is strong, welcoming and always ready to help. Whether to find Portuguese products, cultural events, or simply for a coffee and conversation, we're all connected by the same heritage. How can I help you feel more integrated into our community?\"\n  }\n\n  private static generateSuggestions(\n    culturalContext: CulturalContext,\n    emotionalTone: EmotionalTone,\n    userContext: MessageMetadata,\n    language: Language\n  ): LusoBotSuggestion[] {\n    const suggestions: LusoBotSuggestion[] = []\n\n    // High saudade - suggest community connections\n    if (emotionalTone.saudade > 0.5) {\n      suggestions.push({\n        type: 'community',\n        title: language === 'pt' ? 'Encontros Portugueses em Londres' : 'Portuguese Meetups in London',\n        description: language === 'pt' \n          ? 'Conecta-te com outros portugueses na tua área'\n          : 'Connect with other Portuguese people in your area',\n        link: '/events?category=cultural',\n        priority: 'high',\n        culturalRelevance: 0.9\n      })\n    }\n\n    // Cuisine interest - suggest restaurants and events\n    if (culturalContext.topic === 'cuisine') {\n      suggestions.push({\n        type: 'business',\n        title: language === 'pt' ? 'Restaurantes Portugueses' : 'Portuguese Restaurants',\n        description: language === 'pt' \n          ? 'Descobre sabores de casa em Londres'\n          : 'Discover flavors from home in London',\n        link: '/directory?category=restaurants',\n        priority: 'high',\n        culturalRelevance: 0.8\n      })\n\n      suggestions.push({\n        type: 'event',\n        title: language === 'pt' ? 'Aulas de Culinária Portuguesa' : 'Portuguese Cooking Classes',\n        description: language === 'pt' \n          ? 'Aprende a fazer pratos tradicionais'\n          : 'Learn to make traditional dishes',\n        link: '/events?type=cooking',\n        priority: 'medium',\n        culturalRelevance: 0.7\n      })\n    }\n\n    // Language learning support\n    if (culturalContext.topic === 'language' || userContext.languageProficiency === 'learning') {\n      suggestions.push({\n        type: 'language',\n        title: language === 'pt' ? 'Intercâmbio de Idiomas' : 'Language Exchange',\n        description: language === 'pt' \n          ? 'Pratica português com nativos'\n          : 'Practice Portuguese with natives',\n        link: '/language-exchange',\n        priority: 'high',\n        culturalRelevance: 0.8\n      })\n    }\n\n    // Business networking\n    if (culturalContext.topic === 'business') {\n      suggestions.push({\n        type: 'community',\n        title: language === 'pt' ? 'Networking Empresarial LusoTown' : 'LusoTown Business Networking',\n        description: language === 'pt' \n          ? 'Conecta-te com empresários portugueses'\n          : 'Connect with Portuguese entrepreneurs',\n        link: '/business-networking',\n        priority: 'high',\n        culturalRelevance: 0.8\n      })\n    }\n\n    // Cultural events for heritage connection\n    if (emotionalTone.heritage > 0.4) {\n      suggestions.push({\n        type: 'event',\n        title: language === 'pt' ? 'Eventos Culturais Portugueses' : 'Portuguese Cultural Events',\n        description: language === 'pt' \n          ? 'Celebra a nossa cultura e tradições'\n          : 'Celebrate our culture and traditions',\n        link: '/cultural-calendar',\n        priority: 'medium',\n        culturalRelevance: 0.9\n      })\n    }\n\n    return suggestions.sort((a, b) => {\n      // Sort by priority and cultural relevance\n      const priorityWeight = { high: 3, medium: 2, low: 1 }\n      const aScore = priorityWeight[a.priority] + a.culturalRelevance\n      const bScore = priorityWeight[b.priority] + b.culturalRelevance\n      return bScore - aScore\n    }).slice(0, 4) // Return top 4 suggestions\n  }\n}\n\n// Chat Session Manager\nexport class LusoBotSession {\n  private messages: LusoBotMessage[] = []\n  private userContext: MessageMetadata\n  private language: Language\n\n  constructor(userContext: MessageMetadata, language: Language = 'en') {\n    this.userContext = userContext\n    this.language = language\n    \n    // Add welcome message\n    this.addWelcomeMessage()\n  }\n\n  private addWelcomeMessage() {\n    const welcomeMessage: LusoBotMessage = {\n      id: `welcome_${  Date.now()}`,\n      role: 'assistant',\n      content: this.language === 'pt' \n        ? \"Olá! Sou o LusoBot, o teu assistente cultural português. Estou aqui para te ajudar com tudo relacionado com a nossa cultura, tradições, comunidade em Londres, e claro, para compreender e apoiar as tuas saudades. Como posso ajudar-te hoje?\"\n        : \"Hello! I'm LusoBot, your Portuguese cultural assistant. I'm here to help you with everything related to our culture, traditions, community in London, and of course, to understand and support your saudades. How can I help you today?\",\n      timestamp: new Date(),\n      language: this.language,\n      culturalContext: {\n        region: 'diaspora_uk',\n        topic: 'community',\n        expertise: ['uk_portuguese_community', 'cultural_events', 'diaspora_support'],\n        confidence: 1.0\n      },\n      emotionalTone: {\n        saudade: 0,\n        nostalgia: 0,\n        hope: 0.8,\n        community: 0.9,\n        heritage: 0.7\n      }\n    }\n\n    this.messages.push(welcomeMessage)\n  }\n\n  async sendMessage(content: string): Promise<LusoBotMessage> {\n    // Add user message\n    const userMessage: LusoBotMessage = {\n      id: `user_${  Date.now()}`,\n      role: 'user',\n      content,\n      timestamp: new Date(),\n      language: this.language,\n      metadata: this.userContext\n    }\n    this.messages.push(userMessage)\n\n    // Generate bot response\n    const botResponse = await LusoBotEngine.generateResponse(\n      content,\n      this.userContext,\n      this.language\n    )\n    this.messages.push(botResponse)\n\n    return botResponse\n  }\n\n  getMessages(): LusoBotMessage[] {\n    return [...this.messages]\n  }\n\n  updateUserContext(context: Partial<MessageMetadata>) {\n    this.userContext = { ...this.userContext, ...context }\n  }\n\n  setLanguage(language: Language) {\n    this.language = language\n  }\n\n  exportConversation(): string {\n    return JSON.stringify({\n      timestamp: new Date().toISOString(),\n      language: this.language,\n      userContext: this.userContext,\n      messages: this.messages\n    }, null, 2)\n  }\n}"],"names":["LusoBotEngine","LusoBotSession","PORTUGUESE_CULTURAL_KNOWLEDGE","SaudadeEngine","history","discoveries","period","keywords","significance","cultural_impact","revolution_1974","eu_membership","regions","north","characteristics","cuisine","traditions","dialects","music","center","south","lisbon","azores","madeira","staples","preparations","cultural_meaning","varieties","traditional_dishes","food_customs","fado","essence","types","themes","cultural_role","legendary_figures","folk_music","modern_music","evolution","artists","language","saudade","definition","usage","cultural_importance","expressions","common_expressions","regional_dialects","pronunciation","vocabulary","formal_vs_informal","detectSaudade","message","saudadeKeywords","communityKeywords","heritageKeywords","text","toLowerCase","community","heritage","nostalgia","hope","forEach","keyword","includes","Math","min","generateSaudadeResponse","tone","knowledge","saudadeEngine","generateResponse","context","emotionalTone","culturalContext","identifyCulturalContext","response","generateContextualResponse","suggestions","generateSuggestions","id","Date","now","random","toString","substr","role","content","timestamp","metadata","region","topic","expertise","confidence","push","userContext","emotionalResponse","generateCuisineResponse","generateFadoResponse","generateHistoryResponse","generateLanguageResponse","generateFestivalResponse","generateBusinessResponse","generateCommunityResponse","type","title","description","link","priority","culturalRelevance","languageProficiency","sort","a","b","priorityWeight","high","medium","low","aScore","bScore","slice","constructor","messages","addWelcomeMessage","welcomeMessage","sendMessage","userMessage","botResponse","getMessages","updateUserContext","setLanguage","exportConversation","JSON","stringify","toISOString"],"mappings":"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"}