37cedebe99b77f7fce0ecdceba106e31
"use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    AuthService: function() {
        return AuthService;
    },
    authService: function() {
        return authService;
    },
    getCurrentUser: function() {
        return getCurrentUser;
    },
    isAdmin: function() {
        return isAdmin;
    },
    isAuthenticated: function() {
        return isAuthenticated;
    },
    isDemoUser: function() {
        return isDemoUser;
    },
    logout: function() {
        return logout;
    },
    useAuthState: function() {
        return useAuthState;
    }
});
const _supabase = require("./supabase");
const _profileImages = require("./profileImages");
const _errorHandling = require("./errorHandling");
const _credentials = require("../config/credentials");
// Map Supabase profile to User interface
function mapProfileToUser(profile, supabaseUser) {
    return {
        id: profile.id,
        email: profile.email,
        name: profile.first_name + (profile.last_name ? ` ${profile.last_name}` : ""),
        role: (0, _credentials.isAdminEmail)(profile.email) ? "admin" : "user",
        membershipTier: profile.membership_tier,
        profileImage: profile.profile_picture_url || (0, _profileImages.getImageWithFallback)("default-user"),
        joinedDate: new Date(profile.created_at).toISOString().split("T")[0],
        interests: [],
        favoriteEvents: [],
        location: profile.location || ""
    };
}
class AuthService {
    static getInstance() {
        if (!AuthService.instance) {
            AuthService.instance = new AuthService();
            AuthService.instance.initializeAuthListener();
        }
        return AuthService.instance;
    }
    initializeAuthListener() {
        // Check for existing demo session on initialization
        this.loadDemoSessionIfExists();
        // Listen for auth state changes from Supabase
        _supabase.supabase.auth.onAuthStateChange(async (event, session)=>{
            if (event === "SIGNED_IN" && session?.user) {
                await this.loadUserProfile(session.user);
            } else if (event === "SIGNED_OUT") {
                this.currentUser = null;
                this.notifyAuthStateChange(null);
            }
        });
        // Try to load current session on initialization
        this.loadCurrentSession();
    }
    async loadCurrentSession() {
        try {
            const { data: { session }, error } = await _supabase.supabase.auth.getSession();
            if (error) throw error;
            if (session?.user) {
                await this.loadUserProfile(session.user);
            }
        } catch (error) {
            console.error("Error loading current session:", error);
        }
    }
    // Demo authentication methods
    isDemoLogin(email, password) {
        return (0, _credentials.validateDemoCredentials)(email, password);
    }
    createDemoUser() {
        return {
            id: _credentials.DEMO_CONFIG.userId,
            email: _credentials.DEMO_CONFIG.email,
            name: "Maria Silva",
            role: "user",
            membershipTier: "premium",
            profileImage: "/profiles/default-avatar.svg",
            joinedDate: "2024-01-15",
            interests: [
                "Cultural Events",
                "Lusophone Food",
                "Language Exchange",
                "Fado Music",
                "Lusophone Literature"
            ],
            favoriteEvents: [
                "event-1",
                "event-3",
                "event-5"
            ],
            location: "Camden, London"
        };
    }
    async handleDemoLogin() {
        try {
            // Simulate loading delay for realistic experience
            await new Promise((resolve)=>setTimeout(resolve, 1500));
            const demoUser = this.createDemoUser();
            // Store demo session in localStorage for persistence
            if (typeof window !== "undefined") {
                _errorHandling.safeLocalStorage.setJSON("lusotown_demo_session", {
                    user: demoUser,
                    timestamp: Date.now()
                });
            }
            this.currentUser = demoUser;
            this.notifyAuthStateChange(demoUser);
            return {
                success: true,
                user: demoUser
            };
        } catch (error) {
            console.error("Demo login error:", error);
            return {
                success: false,
                error: "Demo login failed"
            };
        }
    }
    loadDemoSessionIfExists() {
        if (typeof window === "undefined") return;
        const sessionData = _errorHandling.safeLocalStorage.getJSON("lusotown_demo_session");
        if (sessionData) {
            // Check if session is still valid (24 hours)
            const twentyFourHours = 24 * 60 * 60 * 1000;
            if (Date.now() - sessionData.timestamp < twentyFourHours) {
                this.currentUser = sessionData.user;
                this.notifyAuthStateChange(sessionData.user);
            } else {
                // Clear expired session
                _errorHandling.safeLocalStorage.removeItem("lusotown_demo_session");
            }
        }
    }
    clearDemoSession() {
        if (typeof window !== "undefined") {
            _errorHandling.safeLocalStorage.removeItem("lusotown_demo_session");
        }
    }
    async loadUserProfile(supabaseUser) {
        try {
            // Get the user's profile from the profiles table
            const { data: profile, error } = await _supabase.supabase.from("profiles").select("*").eq("id", supabaseUser.id).single();
            if (error) {
                console.error("Error loading user profile:", error);
                return null;
            }
            if (profile) {
                const user = mapProfileToUser(profile, supabaseUser);
                this.currentUser = user;
                this.notifyAuthStateChange(user);
                return user;
            }
        } catch (error) {
            console.error("Error in loadUserProfile:", error);
        }
        return null;
    }
    notifyAuthStateChange(user) {
        this.authStateListeners.forEach((listener)=>listener(user));
    }
    onAuthStateChange(handler) {
        this.authStateListeners.push(handler);
        // Return unsubscribe function
        return ()=>{
            this.authStateListeners = this.authStateListeners.filter((listener)=>listener !== handler);
        };
    }
    async login(email, password) {
        try {
            // Check if this is demo login
            if (this.isDemoLogin(email, password)) {
                return await this.handleDemoLogin();
            }
            // Regular Supabase authentication
            const { data, error } = await _supabase.supabase.auth.signInWithPassword({
                email: email.trim(),
                password: password
            });
            if (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
            if (data.user) {
                const user = await this.loadUserProfile(data.user);
                if (user) {
                    return {
                        success: true,
                        user
                    };
                } else {
                    return {
                        success: false,
                        error: "Failed to load user profile"
                    };
                }
            }
            return {
                success: false,
                error: "Unknown authentication error"
            };
        } catch (error) {
            console.error("Login error:", error);
            return {
                success: false,
                error: "An unexpected error occurred"
            };
        }
    }
    async signup(email, password, userData) {
        try {
            const { data, error } = await _supabase.supabase.auth.signUp({
                email: email.trim(),
                password: password,
                options: {
                    data: {
                        first_name: userData.firstName,
                        last_name: userData.lastName || ""
                    }
                }
            });
            if (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
            if (data.user) {
                // The profile will be created automatically by the database trigger
                // We'll wait a moment for it to be created, then load it
                await new Promise((resolve)=>setTimeout(resolve, 1000));
                const user = await this.loadUserProfile(data.user);
                if (user) {
                    return {
                        success: true,
                        user
                    };
                } else {
                    return {
                        success: true,
                        error: "Account created. Please check your email to verify your account."
                    };
                }
            }
            return {
                success: false,
                error: "Unknown signup error"
            };
        } catch (error) {
            console.error("Signup error:", error);
            return {
                success: false,
                error: "An unexpected error occurred"
            };
        }
    }
    async logout() {
        try {
            // Handle demo session logout
            if (this.currentUser?.id === _credentials.DEMO_CONFIG.userId) {
                this.clearDemoSession();
                this.currentUser = null;
                this.notifyAuthStateChange(null);
                return;
            }
            // Regular Supabase logout
            const { error } = await _supabase.supabase.auth.signOut();
            if (error) throw error;
            this.currentUser = null;
            this.notifyAuthStateChange(null);
        } catch (error) {
            console.error("Logout error:", error);
            throw error;
        }
    }
    getCurrentUser() {
        return this.currentUser;
    }
    isAuthenticated() {
        return this.currentUser !== null;
    }
    isDemoUser() {
        return this.currentUser?.id === _credentials.DEMO_CONFIG.userId;
    }
    isAdmin() {
        const user = this.getCurrentUser();
        return user?.role === "admin";
    }
    async updateFavorites(eventId, action) {
        const user = this.getCurrentUser();
        if (!user) return;
        // Update local state
        if (action === "add" && !user.favoriteEvents.includes(eventId)) {
            user.favoriteEvents.push(eventId);
        } else if (action === "remove") {
            user.favoriteEvents = user.favoriteEvents.filter((id)=>id !== eventId);
        }
        // Implement database update for favorite events
        try {
            // Update localStorage for immediate UI feedback
            localStorage.setItem("lusotown-user", JSON.stringify(user));
            // Update database (would require Supabase integration)
            // await supabase
            //   .from('user_favorite_events')
            //   .upsert({ user_id: user.id, event_id: eventId, is_favorite: action === 'add' })
            console.log(`${action} favorite event ${eventId} for user ${user.id}`);
        } catch (error) {
            console.error("Error updating favorites:", error);
        }
    }
    async updateProfile(updates) {
        const user = this.getCurrentUser();
        if (!user) throw new Error("No user logged in");
        try {
            // Map User interface updates to Profile table updates
            const profileUpdates = {};
            if (updates.name) {
                const nameParts = updates.name.split(" ");
                profileUpdates.first_name = nameParts[0];
                if (nameParts.length > 1) {
                    profileUpdates.last_name = nameParts.slice(1).join(" ");
                }
            }
            if (updates.location) profileUpdates.location = updates.location;
            if (updates.membershipTier) profileUpdates.membership_tier = updates.membershipTier;
            if (updates.profileImage) profileUpdates.profile_picture_url = updates.profileImage;
            // Update the profile in Supabase
            const { error } = await _supabase.supabase.from("profiles").update({
                ...profileUpdates,
                updated_at: new Date().toISOString()
            }).eq("id", user.id);
            if (error) throw error;
            // Update local user state
            Object.assign(user, updates);
            this.notifyAuthStateChange(user);
        } catch (error) {
            console.error("Error updating profile:", error);
            throw error;
        }
    }
    async resetPassword(email) {
        try {
            const { error } = await _supabase.supabase.auth.resetPasswordForEmail(email);
            if (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
            return {
                success: true
            };
        } catch (error) {
            console.error("Password reset error:", error);
            return {
                success: false,
                error: "An unexpected error occurred"
            };
        }
    }
    constructor(){
        this.currentUser = null;
        this.authStateListeners = [];
    }
}
const authService = AuthService.getInstance();
const getCurrentUser = ()=>authService.getCurrentUser();
const isAuthenticated = ()=>authService.isAuthenticated();
const isDemoUser = ()=>authService.isDemoUser();
const isAdmin = ()=>authService.isAdmin();
const logout = ()=>authService.logout();
const useAuthState = (callback)=>{
    return authService.onAuthStateChange(callback);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL0x1c29Ub3duL3dlYi1hcHAvc3JjL2xpYi9hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgeyBzdXBhYmFzZSwgdHlwZSBQcm9maWxlIH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlXCI7XG5pbXBvcnQgeyBnZXRJbWFnZVdpdGhGYWxsYmFjayB9IGZyb20gXCJAL2xpYi9wcm9maWxlSW1hZ2VzXCI7XG5pbXBvcnQgeyBVc2VyIGFzIFN1cGFiYXNlVXNlciB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcbmltcG9ydCB7XG4gIHNhZmVBc3luYyxcbiAgc2FmZUxvY2FsU3RvcmFnZSxcbiAgTHVzb1Rvd25FcnJvcixcbiAgRXJyb3JUeXBlLFxufSBmcm9tIFwiQC9saWIvZXJyb3JIYW5kbGluZ1wiO1xuaW1wb3J0IHsgREVNT19DT05GSUcsIEFETUlOX0NPTkZJRywgdmFsaWRhdGVEZW1vQ3JlZGVudGlhbHMsIGlzQWRtaW5FbWFpbCB9IGZyb20gXCJAL2NvbmZpZy9jcmVkZW50aWFsc1wiO1xuXG4vLyBVc2VyIGludGVyZmFjZSBmb3IgdGhlIGFwcGxpY2F0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFVzZXIge1xuICBpZDogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHJvbGU6IFwidXNlclwiIHwgXCJhZG1pblwiO1xuICBtZW1iZXJzaGlwVGllcjogXCJmcmVlXCIgfCBcImNvcmVcIiB8IFwicHJlbWl1bVwiO1xuICBwcm9maWxlSW1hZ2U/OiBzdHJpbmc7XG4gIGpvaW5lZERhdGU6IHN0cmluZztcbiAgaW50ZXJlc3RzOiBzdHJpbmdbXTtcbiAgZmF2b3JpdGVFdmVudHM6IHN0cmluZ1tdO1xuICBsb2NhdGlvbjogc3RyaW5nO1xufVxuXG4vLyBBdXRoIHN0YXRlIGNoYW5nZSBsaXN0ZW5lciB0eXBlXG5leHBvcnQgdHlwZSBBdXRoU3RhdGVDaGFuZ2VIYW5kbGVyID0gKHVzZXI6IFVzZXIgfCBudWxsKSA9PiB2b2lkO1xuXG4vLyBNYXAgU3VwYWJhc2UgcHJvZmlsZSB0byBVc2VyIGludGVyZmFjZVxuZnVuY3Rpb24gbWFwUHJvZmlsZVRvVXNlcihwcm9maWxlOiBQcm9maWxlLCBzdXBhYmFzZVVzZXI6IFN1cGFiYXNlVXNlcik6IFVzZXIge1xuICByZXR1cm4ge1xuICAgIGlkOiBwcm9maWxlLmlkLFxuICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgIG5hbWU6XG4gICAgICBwcm9maWxlLmZpcnN0X25hbWUgKyAocHJvZmlsZS5sYXN0X25hbWUgPyBgICR7cHJvZmlsZS5sYXN0X25hbWV9YCA6IFwiXCIpLFxuICAgIHJvbGU6IGlzQWRtaW5FbWFpbChwcm9maWxlLmVtYWlsKSA/IFwiYWRtaW5cIiA6IFwidXNlclwiLCAvLyBBZG1pbiBjaGVjayB2aWEgc2VjdXJlIGNvbmZpZ1xuICAgIG1lbWJlcnNoaXBUaWVyOiBwcm9maWxlLm1lbWJlcnNoaXBfdGllcixcbiAgICBwcm9maWxlSW1hZ2U6XG4gICAgICBwcm9maWxlLnByb2ZpbGVfcGljdHVyZV91cmwgfHwgZ2V0SW1hZ2VXaXRoRmFsbGJhY2soXCJkZWZhdWx0LXVzZXJcIiksXG4gICAgam9pbmVkRGF0ZTogbmV3IERhdGUocHJvZmlsZS5jcmVhdGVkX2F0KS50b0lTT1N0cmluZygpLnNwbGl0KFwiVFwiKVswXSxcbiAgICBpbnRlcmVzdHM6IFtdLCAvLyBXaWxsIGJlIHBvcHVsYXRlZCBmcm9tIHVzZXJfaW50ZXJlc3RzIHRhYmxlIGlmIG5lZWRlZFxuICAgIGZhdm9yaXRlRXZlbnRzOiBbXSwgLy8gV2lsbCBiZSBwb3B1bGF0ZWQgZnJvbSB1c2VyIGZhdm9yaXRlRXZlbnRzIGlmIG5lZWRlZFxuICAgIGxvY2F0aW9uOiBwcm9maWxlLmxvY2F0aW9uIHx8IFwiXCIsXG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBBdXRoU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBBdXRoU2VydmljZTtcbiAgcHJpdmF0ZSBjdXJyZW50VXNlcjogVXNlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGF1dGhTdGF0ZUxpc3RlbmVyczogQXV0aFN0YXRlQ2hhbmdlSGFuZGxlcltdID0gW107XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IEF1dGhTZXJ2aWNlIHtcbiAgICBpZiAoIUF1dGhTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBBdXRoU2VydmljZS5pbnN0YW5jZSA9IG5ldyBBdXRoU2VydmljZSgpO1xuICAgICAgQXV0aFNlcnZpY2UuaW5zdGFuY2UuaW5pdGlhbGl6ZUF1dGhMaXN0ZW5lcigpO1xuICAgIH1cbiAgICByZXR1cm4gQXV0aFNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVBdXRoTGlzdGVuZXIoKSB7XG4gICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGRlbW8gc2Vzc2lvbiBvbiBpbml0aWFsaXphdGlvblxuICAgIHRoaXMubG9hZERlbW9TZXNzaW9uSWZFeGlzdHMoKTtcblxuICAgIC8vIExpc3RlbiBmb3IgYXV0aCBzdGF0ZSBjaGFuZ2VzIGZyb20gU3VwYWJhc2VcbiAgICBzdXBhYmFzZS5hdXRoLm9uQXV0aFN0YXRlQ2hhbmdlKGFzeW5jIChldmVudCwgc2Vzc2lvbikgPT4ge1xuICAgICAgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9JTlwiICYmIHNlc3Npb24/LnVzZXIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkVXNlclByb2ZpbGUoc2Vzc2lvbi51c2VyKTtcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiU0lHTkVEX09VVFwiKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICB0aGlzLm5vdGlmeUF1dGhTdGF0ZUNoYW5nZShudWxsKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFRyeSB0byBsb2FkIGN1cnJlbnQgc2Vzc2lvbiBvbiBpbml0aWFsaXphdGlvblxuICAgIHRoaXMubG9hZEN1cnJlbnRTZXNzaW9uKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRDdXJyZW50U2Vzc2lvbigpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgICAgZXJyb3IsXG4gICAgICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKCk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuXG4gICAgICBpZiAoc2Vzc2lvbj8udXNlcikge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRVc2VyUHJvZmlsZShzZXNzaW9uLnVzZXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBjdXJyZW50IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvLyBEZW1vIGF1dGhlbnRpY2F0aW9uIG1ldGhvZHNcbiAgcHJpdmF0ZSBpc0RlbW9Mb2dpbihlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHZhbGlkYXRlRGVtb0NyZWRlbnRpYWxzKGVtYWlsLCBwYXNzd29yZCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURlbW9Vc2VyKCk6IFVzZXIge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogREVNT19DT05GSUcudXNlcklkLFxuICAgICAgZW1haWw6IERFTU9fQ09ORklHLmVtYWlsLFxuICAgICAgbmFtZTogXCJNYXJpYSBTaWx2YVwiLFxuICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICBtZW1iZXJzaGlwVGllcjogXCJwcmVtaXVtXCIsXG4gICAgICBwcm9maWxlSW1hZ2U6IFwiL3Byb2ZpbGVzL2RlZmF1bHQtYXZhdGFyLnN2Z1wiLFxuICAgICAgam9pbmVkRGF0ZTogXCIyMDI0LTAxLTE1XCIsXG4gICAgICBpbnRlcmVzdHM6IFtcbiAgICAgICAgXCJDdWx0dXJhbCBFdmVudHNcIixcbiAgICAgICAgXCJMdXNvcGhvbmUgRm9vZFwiLFxuICAgICAgICBcIkxhbmd1YWdlIEV4Y2hhbmdlXCIsXG4gICAgICAgIFwiRmFkbyBNdXNpY1wiLFxuICAgICAgICBcIkx1c29waG9uZSBMaXRlcmF0dXJlXCIsXG4gICAgICBdLFxuICAgICAgZmF2b3JpdGVFdmVudHM6IFtcImV2ZW50LTFcIiwgXCJldmVudC0zXCIsIFwiZXZlbnQtNVwiXSxcbiAgICAgIGxvY2F0aW9uOiBcIkNhbWRlbiwgTG9uZG9uXCIsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRGVtb0xvZ2luKCk6IFByb21pc2U8e1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgdXNlcj86IFVzZXI7XG4gICAgZXJyb3I/OiBzdHJpbmc7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU2ltdWxhdGUgbG9hZGluZyBkZWxheSBmb3IgcmVhbGlzdGljIGV4cGVyaWVuY2VcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDE1MDApKTtcblxuICAgICAgY29uc3QgZGVtb1VzZXIgPSB0aGlzLmNyZWF0ZURlbW9Vc2VyKCk7XG5cbiAgICAgIC8vIFN0b3JlIGRlbW8gc2Vzc2lvbiBpbiBsb2NhbFN0b3JhZ2UgZm9yIHBlcnNpc3RlbmNlXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBzYWZlTG9jYWxTdG9yYWdlLnNldEpTT04oXCJsdXNvdG93bl9kZW1vX3Nlc3Npb25cIiwge1xuICAgICAgICAgIHVzZXI6IGRlbW9Vc2VyLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBkZW1vVXNlcjtcbiAgICAgIHRoaXMubm90aWZ5QXV0aFN0YXRlQ2hhbmdlKGRlbW9Vc2VyKTtcblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXNlcjogZGVtb1VzZXIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkRlbW8gbG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJEZW1vIGxvZ2luIGZhaWxlZFwiIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBsb2FkRGVtb1Nlc3Npb25JZkV4aXN0cygpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xuXG4gICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBzYWZlTG9jYWxTdG9yYWdlLmdldEpTT048e1xuICAgICAgdXNlcjogVXNlcjtcbiAgICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICAgIH0+KFwibHVzb3Rvd25fZGVtb19zZXNzaW9uXCIpO1xuICAgIGlmIChzZXNzaW9uRGF0YSkge1xuICAgICAgLy8gQ2hlY2sgaWYgc2Vzc2lvbiBpcyBzdGlsbCB2YWxpZCAoMjQgaG91cnMpXG4gICAgICBjb25zdCB0d2VudHlGb3VySG91cnMgPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuICAgICAgaWYgKERhdGUubm93KCkgLSBzZXNzaW9uRGF0YS50aW1lc3RhbXAgPCB0d2VudHlGb3VySG91cnMpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHNlc3Npb25EYXRhLnVzZXI7XG4gICAgICAgIHRoaXMubm90aWZ5QXV0aFN0YXRlQ2hhbmdlKHNlc3Npb25EYXRhLnVzZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2xlYXIgZXhwaXJlZCBzZXNzaW9uXG4gICAgICAgIHNhZmVMb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImx1c290b3duX2RlbW9fc2Vzc2lvblwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsZWFyRGVtb1Nlc3Npb24oKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHNhZmVMb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImx1c290b3duX2RlbW9fc2Vzc2lvblwiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRVc2VyUHJvZmlsZShcbiAgICBzdXBhYmFzZVVzZXI6IFN1cGFiYXNlVXNlclxuICApOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCB0aGUgdXNlcidzIHByb2ZpbGUgZnJvbSB0aGUgcHJvZmlsZXMgdGFibGVcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwicHJvZmlsZXNcIilcbiAgICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgICAgLmVxKFwiaWRcIiwgc3VwYWJhc2VVc2VyLmlkKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyB1c2VyIHByb2ZpbGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9maWxlKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBtYXBQcm9maWxlVG9Vc2VyKHByb2ZpbGUsIHN1cGFiYXNlVXNlcik7XG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICB0aGlzLm5vdGlmeUF1dGhTdGF0ZUNoYW5nZSh1c2VyKTtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBsb2FkVXNlclByb2ZpbGU6XCIsIGVycm9yKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIG5vdGlmeUF1dGhTdGF0ZUNoYW5nZSh1c2VyOiBVc2VyIHwgbnVsbCkge1xuICAgIHRoaXMuYXV0aFN0YXRlTGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih1c2VyKSk7XG4gIH1cblxuICBvbkF1dGhTdGF0ZUNoYW5nZShoYW5kbGVyOiBBdXRoU3RhdGVDaGFuZ2VIYW5kbGVyKTogKCkgPT4gdm9pZCB7XG4gICAgdGhpcy5hdXRoU3RhdGVMaXN0ZW5lcnMucHVzaChoYW5kbGVyKTtcblxuICAgIC8vIFJldHVybiB1bnN1YnNjcmliZSBmdW5jdGlvblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB0aGlzLmF1dGhTdGF0ZUxpc3RlbmVycyA9IHRoaXMuYXV0aFN0YXRlTGlzdGVuZXJzLmZpbHRlcihcbiAgICAgICAgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lciAhPT0gaGFuZGxlclxuICAgICAgKTtcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgbG9naW4oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyB1c2VyPzogVXNlcjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGRlbW8gbG9naW5cbiAgICAgIGlmICh0aGlzLmlzRGVtb0xvZ2luKGVtYWlsLCBwYXNzd29yZCkpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuaGFuZGxlRGVtb0xvZ2luKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlZ3VsYXIgU3VwYWJhc2UgYXV0aGVudGljYXRpb25cbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgICAgZW1haWw6IGVtYWlsLnRyaW0oKSxcbiAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEudXNlcikge1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5sb2FkVXNlclByb2ZpbGUoZGF0YS51c2VyKTtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1c2VyIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2FkIHVzZXIgcHJvZmlsZVwiIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVua25vd24gYXV0aGVudGljYXRpb24gZXJyb3JcIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkXCIgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzaWdudXAoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICAgIHVzZXJEYXRhOiB7IGZpcnN0TmFtZTogc3RyaW5nOyBsYXN0TmFtZT86IHN0cmluZyB9XG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyB1c2VyPzogVXNlcjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25VcCh7XG4gICAgICAgIGVtYWlsOiBlbWFpbC50cmltKCksXG4gICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IHVzZXJEYXRhLmZpcnN0TmFtZSxcbiAgICAgICAgICAgIGxhc3RfbmFtZTogdXNlckRhdGEubGFzdE5hbWUgfHwgXCJcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEudXNlcikge1xuICAgICAgICAvLyBUaGUgcHJvZmlsZSB3aWxsIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSBieSB0aGUgZGF0YWJhc2UgdHJpZ2dlclxuICAgICAgICAvLyBXZSdsbCB3YWl0IGEgbW9tZW50IGZvciBpdCB0byBiZSBjcmVhdGVkLCB0aGVuIGxvYWQgaXRcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xuXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmxvYWRVc2VyUHJvZmlsZShkYXRhLnVzZXIpO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVzZXIgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOlxuICAgICAgICAgICAgICBcIkFjY291bnQgY3JlYXRlZC4gUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC5cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmtub3duIHNpZ251cCBlcnJvclwiIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWdudXAgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkXCIgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2dvdXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSBkZW1vIHNlc3Npb24gbG9nb3V0XG4gICAgICBpZiAodGhpcy5jdXJyZW50VXNlcj8uaWQgPT09IERFTU9fQ09ORklHLnVzZXJJZCkge1xuICAgICAgICB0aGlzLmNsZWFyRGVtb1Nlc3Npb24oKTtcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgIHRoaXMubm90aWZ5QXV0aFN0YXRlQ2hhbmdlKG51bGwpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlZ3VsYXIgU3VwYWJhc2UgbG9nb3V0XG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25PdXQoKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG5cbiAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgdGhpcy5ub3RpZnlBdXRoU3RhdGVDaGFuZ2UobnVsbCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dvdXQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGdldEN1cnJlbnRVc2VyKCk6IFVzZXIgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlcjtcbiAgfVxuXG4gIGlzQXV0aGVudGljYXRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlciAhPT0gbnVsbDtcbiAgfVxuXG4gIGlzRGVtb1VzZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXI/LmlkID09PSBERU1PX0NPTkZJRy51c2VySWQ7XG4gIH1cblxuICBpc0FkbWluKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHVzZXIgPSB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgcmV0dXJuIHVzZXI/LnJvbGUgPT09IFwiYWRtaW5cIjtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUZhdm9yaXRlcyhcbiAgICBldmVudElkOiBzdHJpbmcsXG4gICAgYWN0aW9uOiBcImFkZFwiIHwgXCJyZW1vdmVcIlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB1c2VyID0gdGhpcy5nZXRDdXJyZW50VXNlcigpO1xuICAgIGlmICghdXNlcikgcmV0dXJuO1xuXG4gICAgLy8gVXBkYXRlIGxvY2FsIHN0YXRlXG4gICAgaWYgKGFjdGlvbiA9PT0gXCJhZGRcIiAmJiAhdXNlci5mYXZvcml0ZUV2ZW50cy5pbmNsdWRlcyhldmVudElkKSkge1xuICAgICAgdXNlci5mYXZvcml0ZUV2ZW50cy5wdXNoKGV2ZW50SWQpO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZVwiKSB7XG4gICAgICB1c2VyLmZhdm9yaXRlRXZlbnRzID0gdXNlci5mYXZvcml0ZUV2ZW50cy5maWx0ZXIoKGlkKSA9PiBpZCAhPT0gZXZlbnRJZCk7XG4gICAgfVxuXG4gICAgLy8gSW1wbGVtZW50IGRhdGFiYXNlIHVwZGF0ZSBmb3IgZmF2b3JpdGUgZXZlbnRzXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVwZGF0ZSBsb2NhbFN0b3JhZ2UgZm9yIGltbWVkaWF0ZSBVSSBmZWVkYmFja1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJsdXNvdG93bi11c2VyXCIsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcblxuICAgICAgLy8gVXBkYXRlIGRhdGFiYXNlICh3b3VsZCByZXF1aXJlIFN1cGFiYXNlIGludGVncmF0aW9uKVxuICAgICAgLy8gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC8vICAgLmZyb20oJ3VzZXJfZmF2b3JpdGVfZXZlbnRzJylcbiAgICAgIC8vICAgLnVwc2VydCh7IHVzZXJfaWQ6IHVzZXIuaWQsIGV2ZW50X2lkOiBldmVudElkLCBpc19mYXZvcml0ZTogYWN0aW9uID09PSAnYWRkJyB9KVxuXG4gICAgICBjb25zb2xlLmxvZyhgJHthY3Rpb259IGZhdm9yaXRlIGV2ZW50ICR7ZXZlbnRJZH0gZm9yIHVzZXIgJHt1c2VyLmlkfWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgZmF2b3JpdGVzOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlUHJvZmlsZSh1cGRhdGVzOiBQYXJ0aWFsPFVzZXI+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdXNlciA9IHRoaXMuZ2V0Q3VycmVudFVzZXIoKTtcbiAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcihcIk5vIHVzZXIgbG9nZ2VkIGluXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIE1hcCBVc2VyIGludGVyZmFjZSB1cGRhdGVzIHRvIFByb2ZpbGUgdGFibGUgdXBkYXRlc1xuICAgICAgY29uc3QgcHJvZmlsZVVwZGF0ZXM6IFBhcnRpYWw8UHJvZmlsZT4gPSB7fTtcblxuICAgICAgaWYgKHVwZGF0ZXMubmFtZSkge1xuICAgICAgICBjb25zdCBuYW1lUGFydHMgPSB1cGRhdGVzLm5hbWUuc3BsaXQoXCIgXCIpO1xuICAgICAgICBwcm9maWxlVXBkYXRlcy5maXJzdF9uYW1lID0gbmFtZVBhcnRzWzBdO1xuICAgICAgICBpZiAobmFtZVBhcnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBwcm9maWxlVXBkYXRlcy5sYXN0X25hbWUgPSBuYW1lUGFydHMuc2xpY2UoMSkuam9pbihcIiBcIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHVwZGF0ZXMubG9jYXRpb24pIHByb2ZpbGVVcGRhdGVzLmxvY2F0aW9uID0gdXBkYXRlcy5sb2NhdGlvbjtcbiAgICAgIGlmICh1cGRhdGVzLm1lbWJlcnNoaXBUaWVyKVxuICAgICAgICBwcm9maWxlVXBkYXRlcy5tZW1iZXJzaGlwX3RpZXIgPSB1cGRhdGVzLm1lbWJlcnNoaXBUaWVyO1xuICAgICAgaWYgKHVwZGF0ZXMucHJvZmlsZUltYWdlKVxuICAgICAgICBwcm9maWxlVXBkYXRlcy5wcm9maWxlX3BpY3R1cmVfdXJsID0gdXBkYXRlcy5wcm9maWxlSW1hZ2U7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgcHJvZmlsZSBpbiBTdXBhYmFzZVxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJwcm9maWxlc1wiKVxuICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAuLi5wcm9maWxlVXBkYXRlcyxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5lcShcImlkXCIsIHVzZXIuaWQpO1xuXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuXG4gICAgICAvLyBVcGRhdGUgbG9jYWwgdXNlciBzdGF0ZVxuICAgICAgT2JqZWN0LmFzc2lnbih1c2VyLCB1cGRhdGVzKTtcbiAgICAgIHRoaXMubm90aWZ5QXV0aFN0YXRlQ2hhbmdlKHVzZXIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVzZXRQYXNzd29yZChcbiAgICBlbWFpbDogc3RyaW5nXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgucmVzZXRQYXNzd29yZEZvckVtYWlsKGVtYWlsKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXNzd29yZCByZXNldCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWRcIiB9O1xuICAgIH1cbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgYXV0aFNlcnZpY2UgPSBBdXRoU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4vLyBDb252ZW5pZW5jZSBleHBvcnRzIGZvciBjb21tb24gYXV0aCBvcGVyYXRpb25zXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudFVzZXIgPSAoKSA9PiBhdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpO1xuZXhwb3J0IGNvbnN0IGlzQXV0aGVudGljYXRlZCA9ICgpID0+IGF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpO1xuZXhwb3J0IGNvbnN0IGlzRGVtb1VzZXIgPSAoKSA9PiBhdXRoU2VydmljZS5pc0RlbW9Vc2VyKCk7XG5leHBvcnQgY29uc3QgaXNBZG1pbiA9ICgpID0+IGF1dGhTZXJ2aWNlLmlzQWRtaW4oKTtcbmV4cG9ydCBjb25zdCBsb2dvdXQgPSAoKSA9PiBhdXRoU2VydmljZS5sb2dvdXQoKTtcblxuLy8gSG9vay1saWtlIGZ1bmN0aW9uIGZvciBhdXRoIHN0YXRlIGNoYW5nZXMgKGZvciBSZWFjdCBjb21wb25lbnRzKVxuZXhwb3J0IGNvbnN0IHVzZUF1dGhTdGF0ZSA9IChjYWxsYmFjazogQXV0aFN0YXRlQ2hhbmdlSGFuZGxlcikgPT4ge1xuICByZXR1cm4gYXV0aFNlcnZpY2Uub25BdXRoU3RhdGVDaGFuZ2UoY2FsbGJhY2spO1xufTtcbiJdLCJuYW1lcyI6WyJBdXRoU2VydmljZSIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJpc0FkbWluIiwiaXNBdXRoZW50aWNhdGVkIiwiaXNEZW1vVXNlciIsImxvZ291dCIsInVzZUF1dGhTdGF0ZSIsIm1hcFByb2ZpbGVUb1VzZXIiLCJwcm9maWxlIiwic3VwYWJhc2VVc2VyIiwiaWQiLCJlbWFpbCIsIm5hbWUiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwicm9sZSIsImlzQWRtaW5FbWFpbCIsIm1lbWJlcnNoaXBUaWVyIiwibWVtYmVyc2hpcF90aWVyIiwicHJvZmlsZUltYWdlIiwicHJvZmlsZV9waWN0dXJlX3VybCIsImdldEltYWdlV2l0aEZhbGxiYWNrIiwiam9pbmVkRGF0ZSIsIkRhdGUiLCJjcmVhdGVkX2F0IiwidG9JU09TdHJpbmciLCJzcGxpdCIsImludGVyZXN0cyIsImZhdm9yaXRlRXZlbnRzIiwibG9jYXRpb24iLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiaW5pdGlhbGl6ZUF1dGhMaXN0ZW5lciIsImxvYWREZW1vU2Vzc2lvbklmRXhpc3RzIiwic3VwYWJhc2UiLCJhdXRoIiwib25BdXRoU3RhdGVDaGFuZ2UiLCJldmVudCIsInNlc3Npb24iLCJ1c2VyIiwibG9hZFVzZXJQcm9maWxlIiwiY3VycmVudFVzZXIiLCJub3RpZnlBdXRoU3RhdGVDaGFuZ2UiLCJsb2FkQ3VycmVudFNlc3Npb24iLCJkYXRhIiwiZXJyb3IiLCJnZXRTZXNzaW9uIiwiY29uc29sZSIsImlzRGVtb0xvZ2luIiwicGFzc3dvcmQiLCJ2YWxpZGF0ZURlbW9DcmVkZW50aWFscyIsImNyZWF0ZURlbW9Vc2VyIiwiREVNT19DT05GSUciLCJ1c2VySWQiLCJoYW5kbGVEZW1vTG9naW4iLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJkZW1vVXNlciIsIndpbmRvdyIsInNhZmVMb2NhbFN0b3JhZ2UiLCJzZXRKU09OIiwidGltZXN0YW1wIiwibm93Iiwic3VjY2VzcyIsInNlc3Npb25EYXRhIiwiZ2V0SlNPTiIsInR3ZW50eUZvdXJIb3VycyIsInJlbW92ZUl0ZW0iLCJjbGVhckRlbW9TZXNzaW9uIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiYXV0aFN0YXRlTGlzdGVuZXJzIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiaGFuZGxlciIsInB1c2giLCJmaWx0ZXIiLCJsb2dpbiIsInNpZ25JbldpdGhQYXNzd29yZCIsInRyaW0iLCJtZXNzYWdlIiwic2lnbnVwIiwidXNlckRhdGEiLCJzaWduVXAiLCJvcHRpb25zIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJzaWduT3V0IiwidXBkYXRlRmF2b3JpdGVzIiwiZXZlbnRJZCIsImFjdGlvbiIsImluY2x1ZGVzIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2ciLCJ1cGRhdGVQcm9maWxlIiwidXBkYXRlcyIsIkVycm9yIiwicHJvZmlsZVVwZGF0ZXMiLCJuYW1lUGFydHMiLCJsZW5ndGgiLCJzbGljZSIsImpvaW4iLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwiT2JqZWN0IiwiYXNzaWduIiwicmVzZXRQYXNzd29yZCIsInJlc2V0UGFzc3dvcmRGb3JFbWFpbCIsImNhbGxiYWNrIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0lBZ0RhQSxXQUFXO2VBQVhBOztJQThYQUMsV0FBVztlQUFYQTs7SUFHQUMsY0FBYztlQUFkQTs7SUFHQUMsT0FBTztlQUFQQTs7SUFGQUMsZUFBZTtlQUFmQTs7SUFDQUMsVUFBVTtlQUFWQTs7SUFFQUMsTUFBTTtlQUFOQTs7SUFHQUMsWUFBWTtlQUFaQTs7OzBCQXRiMEI7K0JBQ0Y7K0JBTzlCOzZCQUMwRTtBQW1CakYseUNBQXlDO0FBQ3pDLFNBQVNDLGlCQUFpQkMsT0FBZ0IsRUFBRUMsWUFBMEI7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