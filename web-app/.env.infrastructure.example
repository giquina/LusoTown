# Infrastructure Optimization Environment Variables
# LusoTown Portuguese-speaking Community Platform
# Copy this file to .env.local and configure with your actual values

# ========================================
# DATABASE CONFIGURATION (PostgreSQL + PostGIS)
# ========================================

# Primary Database Connection (Supabase)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=lusotown_portuguese_community
DB_USER=postgres
DB_PASSWORD=your_secure_password_here

# Database Connection Pool Configuration
DB_POOL_MIN=5
DB_POOL_MAX=25
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_CONNECTION_TIMEOUT=5000
DB_POOL_STATEMENT_TIMEOUT=30000
DB_POOL_QUERY_TIMEOUT=30000

# Database SSL Configuration (Production)
DB_SSL_MODE=prefer
DB_SSL_REJECT_UNAUTHORIZED=false

# PostGIS Configuration
POSTGIS_ENABLED=true
POSTGIS_VERSION=3.3
GEOGRAPHY_COLUMNS=true

# Database Application Settings
DB_APPLICATION_NAME=LusoTown-Portuguese-Community
DB_SEARCH_PATH=public,extensions
DB_TIMEZONE=Europe/Lisbon

# ========================================
# REDIS CACHE CONFIGURATION
# ========================================

# Redis Connection (Primary)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_DB=0

# Redis Connection URL (Alternative to individual settings)
REDIS_URL=redis://localhost:6379

# Upstash Redis (Serverless - Production Alternative)
UPSTASH_REDIS_REST_URL=https://your-redis-instance.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_upstash_token_here

# Redis Configuration
REDIS_TTL_DEFAULT=300
REDIS_TTL_PORTUGUESE_EVENTS=300
REDIS_TTL_PORTUGUESE_BUSINESSES=1800
REDIS_TTL_CULTURAL_MATCHES=900
REDIS_TTL_USER_SESSIONS=86400
REDIS_TTL_API_RESPONSES=600

# Redis Performance Settings
REDIS_MAX_RETRIES=3
REDIS_RETRY_DELAY=1000
REDIS_CONNECTION_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=5000

# Cache Compression
REDIS_ENABLE_COMPRESSION=true
REDIS_COMPRESSION_THRESHOLD=1024

# ========================================
# QUERY OPTIMIZATION CONFIGURATION
# ========================================

# Query Optimizer Settings
QUERY_OPTIMIZER_ENABLED=true
QUERY_PROFILING_ENABLED=true
QUERY_CACHE_PLANS=true
QUERY_AUTO_INDEXING=true
QUERY_PORTUGUESE_TEXT_OPTIMIZATION=true
QUERY_PARALLEL_ENABLED=true

# Query Performance Thresholds
SLOW_QUERY_THRESHOLD=200
MAX_QUERY_EXECUTION_TIME=5000
QUERY_PERFORMANCE_MONITORING=true

# Portuguese-Specific Optimization
PORTUGUESE_CONTENT_OPTIMIZATION=true
GEOLOCATION_OPTIMIZATION=true
CULTURAL_COMPATIBILITY_OPTIMIZATION=true

# ========================================
# PERFORMANCE MONITORING CONFIGURATION
# ========================================

# Monitoring Settings
PERFORMANCE_MONITORING_ENABLED=true
INFRASTRUCTURE_METRICS_ENABLED=true
QUERY_PERFORMANCE_LOGGING=true
CACHE_PERFORMANCE_LOGGING=true

# Metrics Collection
METRICS_COLLECTION_INTERVAL=30000
METRICS_RETENTION_DAYS=30
PERFORMANCE_LOG_LEVEL=info

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
INFRASTRUCTURE_HEALTH_MONITORING=true

# ========================================
# RATE LIMITING CONFIGURATION
# ========================================

# Rate Limiting Backend Storage
RATE_LIMIT_STORAGE=redis
RATE_LIMIT_PREFIX=lusotown:ratelimit

# Endpoint-Specific Rate Limits (requests per minute)
RATE_LIMIT_BUSINESS_DIRECTORY=50
RATE_LIMIT_EVENTS=100
RATE_LIMIT_MATCHING=30
RATE_LIMIT_MONITORING=10
RATE_LIMIT_API_DEFAULT=100

# Rate Limiting Windows (milliseconds)
RATE_LIMIT_WINDOW_BUSINESS_DIRECTORY=60000
RATE_LIMIT_WINDOW_EVENTS=60000
RATE_LIMIT_WINDOW_MATCHING=60000
RATE_LIMIT_WINDOW_MONITORING=60000

# Rate Limiting Security
RATE_LIMIT_SKIP_ON_ERROR=false
RATE_LIMIT_SKIP_SUCCESS_RESPONSES=false
RATE_LIMIT_TRUSTED_IPS=127.0.0.1,::1

# ========================================
# GEOLOCATION & SPATIAL CONFIGURATION
# ========================================

# PostGIS Spatial Settings
SPATIAL_REFERENCE_SYSTEM=4326
DEFAULT_SEARCH_RADIUS_KM=10
MAX_SEARCH_RADIUS_KM=50

# London Geographic Configuration
LONDON_CENTER_LAT=51.5074
LONDON_CENTER_LNG=-0.1278
UK_BOUNDING_BOX_NORTH=58.6350
UK_BOUNDING_BOX_SOUTH=49.9590
UK_BOUNDING_BOX_EAST=1.7680
UK_BOUNDING_BOX_WEST=-8.1820

# Geocoding Service Configuration
GEOCODING_SERVICE=postcodes.io
GEOCODING_API_KEY=optional_api_key_here
GEOCODING_CACHE_TTL=86400

# ========================================
# CULTURAL OPTIMIZATION CONFIGURATION
# ========================================

# Portuguese Language Settings
DEFAULT_LANGUAGE=pt
SUPPORTED_LANGUAGES=pt,en
PORTUGUESE_TEXT_SEARCH_CONFIG=portuguese
PORTUGUESE_DICTIONARY=portuguese

# Cultural Content Configuration
CULTURAL_COMPATIBILITY_THRESHOLD=0.7
CULTURAL_MATCH_LIMIT=20
CULTURAL_CELEBRATIONS_CACHE_TTL=3600

# PALOP Nations Support
PALOP_NATIONS_ENABLED=true
PALOP_CULTURAL_WEIGHT=0.9
BRAZILIAN_CULTURAL_WEIGHT=1.0
PORTUGUESE_CULTURAL_WEIGHT=1.0

# ========================================
# CACHING STRATEGIES CONFIGURATION
# ========================================

# Cache Warming
CACHE_WARMING_ENABLED=true
CACHE_WARMING_ON_STARTUP=true
CACHE_WARMUP_BATCH_SIZE=100

# Cache Invalidation
CACHE_INVALIDATION_ENABLED=true
CACHE_TAG_BASED_INVALIDATION=true
CACHE_AUTOMATIC_CLEANUP=true

# Cache Refresh Strategies
CACHE_REFRESH_THRESHOLD_PERCENTAGE=20
CACHE_BACKGROUND_REFRESH=true
CACHE_STALE_WHILE_REVALIDATE=true

# Content-Specific Caching
CACHE_PORTUGUESE_EVENTS_AGGRESSIVE=true
CACHE_BUSINESS_DIRECTORY_LONG_TTL=true
CACHE_CULTURAL_MATCHES_MODERATE_TTL=true

# ========================================
# CONNECTION POOL OPTIMIZATION
# ========================================

# Pool Scaling Configuration
CONNECTION_POOL_SCALE_WITH_LOAD=true
CONNECTION_POOL_PEAK_HOURS_MAX=40
CONNECTION_POOL_OFF_PEAK_MIN=10

# Connection Pool Health
CONNECTION_POOL_HEALTH_CHECK=true
CONNECTION_POOL_METRICS_ENABLED=true
CONNECTION_POOL_AUTO_RECONNECT=true

# Portuguese Community Specific Pools
PORTUGUESE_BUSINESS_POOL_SIZE=15
PORTUGUESE_EVENTS_POOL_SIZE=10
CULTURAL_MATCHING_POOL_SIZE=8

# ========================================
# BACKGROUND PROCESSING CONFIGURATION
# ========================================

# Background Job Configuration
BACKGROUND_JOBS_ENABLED=true
JOB_QUEUE_BACKEND=redis
JOB_PROCESSING_CONCURRENCY=5

# Portuguese Community Jobs
CULTURAL_COMPATIBILITY_JOBS=true
CACHE_WARMING_JOBS=true
PERFORMANCE_ANALYSIS_JOBS=true
DATABASE_MAINTENANCE_JOBS=true

# Job Scheduling
COMPATIBILITY_CALCULATION_SCHEDULE=0 2 * * *
CACHE_WARMUP_SCHEDULE=0 */6 * * *
PERFORMANCE_ANALYSIS_SCHEDULE=0 1 * * *
DATABASE_CLEANUP_SCHEDULE=0 3 * * 0

# ========================================
# DEVELOPMENT & TESTING CONFIGURATION
# ========================================

# Development Mode
NODE_ENV=development
DEBUG_PERFORMANCE=true
DEBUG_QUERIES=true
DEBUG_CACHE=true

# Test Database Configuration
TEST_DB_HOST=localhost
TEST_DB_NAME=lusotown_test
TEST_REDIS_DB=1

# Performance Testing
LOAD_TEST_MODE=false
BENCHMARK_MODE=false
PERFORMANCE_PROFILING=true

# Mock Services (Development)
MOCK_GEOCODING_SERVICE=false
MOCK_REDIS_CACHE=false
MOCK_BACKGROUND_JOBS=false

# ========================================
# SECURITY CONFIGURATION
# ========================================

# Database Security
DB_ENABLE_SSL=true
DB_SSL_CERT_PATH=/path/to/cert.pem
DB_SSL_KEY_PATH=/path/to/key.pem
DB_SSL_CA_PATH=/path/to/ca.pem

# Redis Security
REDIS_TLS_ENABLED=true
REDIS_AUTH_REQUIRED=true

# API Security
API_SECURITY_HEADERS=true
API_CORS_ENABLED=true
API_CSRF_PROTECTION=true

# Infrastructure Security
INFRASTRUCTURE_ACCESS_TOKEN=your_secure_token_here
MONITORING_API_KEY=your_monitoring_key_here

# ========================================
# LOGGING & OBSERVABILITY
# ========================================

# Logging Configuration
LOG_LEVEL=info
LOG_FORMAT=json
LOG_PORTUGUESE_CONTEXT=true

# Performance Logging
LOG_SLOW_QUERIES=true
LOG_CACHE_MISSES=true
LOG_CONNECTION_POOL_EVENTS=true

# Structured Logging
LOG_INCLUDE_CULTURAL_CONTEXT=true
LOG_INCLUDE_PERFORMANCE_METRICS=true
LOG_INCLUDE_USER_CONTEXT=false

# External Logging Services
LOGGING_SERVICE=console
SENTRY_DSN=your_sentry_dsn_here
DATADOG_API_KEY=your_datadog_key_here

# ========================================
# FEATURE FLAGS
# ========================================

# Infrastructure Features
FEATURE_CONNECTION_POOLING=true
FEATURE_REDIS_CACHING=true
FEATURE_QUERY_OPTIMIZATION=true
FEATURE_PERFORMANCE_MONITORING=true

# Portuguese Community Features
FEATURE_CULTURAL_MATCHING=true
FEATURE_GEOLOCATION_SEARCH=true
FEATURE_BILINGUAL_SEARCH=true
FEATURE_PORTUGUESE_TEXT_OPTIMIZATION=true

# Advanced Features
FEATURE_AUTO_INDEXING=true
FEATURE_CACHE_WARMING=true
FEATURE_BACKGROUND_OPTIMIZATION=true
FEATURE_PREDICTIVE_CACHING=false

# ========================================
# PRODUCTION OVERRIDES
# ========================================

# Production Database (Override in production .env)
# DATABASE_URL=postgresql://user:pass@host:5432/db
# REDIS_URL=redis://user:pass@host:6379

# Production Scaling
# DB_POOL_MAX=50
# REDIS_MAX_CONNECTIONS=100
# PERFORMANCE_MONITORING_SAMPLE_RATE=0.1

# Production Security
# DB_SSL_MODE=require
# REDIS_TLS_ENABLED=true
# API_RATE_LIMITING_STRICT=true

# Production Performance
# CACHE_COMPRESSION_ENABLED=true
# QUERY_PLAN_CACHE_SIZE=1000
# BACKGROUND_JOB_WORKERS=10